{"version":3,"sources":["../src/table_handler.js"],"names":["define","Ajax","Fragment","Notification","Templates","Debouncer","OverrideModal","UserPreference","TableHandler","cardElement","contextId","elementId","fragmentValue","hoursFilter","quizId","overridden","rowPreference","sortValue","searchElement","id","methodName","getTable","quiz","hours","sortValueTable","page","search","document","getElementById","value","trim","tableElement","spinner","getElementsByClassName","tableBody","values","hoursahead","hoursbehind","sortArray","split","sortOn","direction","sorton","params","JSON","stringify","classList","remove","loadFragment","done","response","js","innerHTML","runTemplateJS","add","tableEventListeners","fail","exception","Error","debounceTable","debouncer","tableSort","event","preventDefault","linkUrl","URL","target","closest","href","targetSortBy","searchParams","get","targetSortOrder","call","methodname","args","tableid","preference","then","tableHide","hideArray","links","querySelectorAll","targetAction","targetColumn","action","column","indexOf","i","hideLinkUrl","length","tableReset","tableSearch","key","ctrlKey","tableSearchReset","tableSearchInputElement","focus","tableSearchRowSet","tagName","toLowerCase","rows","dataset","metric","setUserPreference","tableNav","tableSortButtonAction","element","sort","parentNode","getElementsByTagName","tableNavElement","tableCardElement","resetLink","overrideLinks","disabledLinks","addEventListener","triggerOverrideModal","forEach","navElement","userid","substring","includes","elements","pop","displayModalForm","init","context","tableElementId","tableFragmentValue","tableRowPreference","tableSearchElement","tableId","tableMethodName"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Table handler JS module.\n *\n * @package    local_assessfreq\n * @copyright  2020 Guillermo Gomez <guillermogomez@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @module     local_assessfreq/table_handler\n */\ndefine([\n    'core/ajax',\n    'core/fragment',\n    'core/notification',\n    'core/templates',\n    'local_assessfreq/debouncer',\n    'local_assessfreq/override_modal',\n    'local_assessfreq/user_preferences'\n], function(Ajax, Fragment, Notification, Templates, Debouncer, OverrideModal, UserPreference) {\n\n    /**\n     * Module level variables.\n     */\n    var TableHandler = {};\n\n    var cardElement;\n    var contextId;\n    var elementId;\n    var fragmentValue;\n    var hoursFilter;\n    var quizId = 0;\n    var overridden = false;\n    var rowPreference;\n    var sortValue;\n    var searchElement;\n\n    /**\n     * Table id variable.\n     *\n     * @type {string}\n     */\n    var id;\n\n    /**\n     * Table method name variable.\n     *\n     * @type {string}\n     */\n    var methodName;\n\n    /**\n     * Display the table that contains all the students in the exam as well as their attempts.\n     *\n     * @param {int} quiz The Quiz Id.\n     * @param {array|null} hours Array with hour ahead or behind preference.\n     * @param {string|null} sortValueTable Sort preference.\n     * @param {int|string|null} page Page number.\n     */\n    TableHandler.getTable = function(quiz, hours = null, sortValueTable = null, page) {\n        if (typeof page === \"undefined\" || overridden === true) {\n            page = 0;\n        }\n\n        overridden = false;\n\n        let search = document.getElementById(searchElement).value.trim();\n        let tableElement = document.getElementById(elementId);\n        let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n        let tableBody = tableElement.getElementsByClassName('table-body')[0];\n        let values = {'search': search, 'page': page};\n\n        // Add values to Object depending on dashboard type.\n        if (quiz > 0) {\n            quizId = quiz;\n            values.quiz = quizId;\n        }\n        if (hours) {\n            hoursFilter = hours;\n            values.hoursahead = hoursFilter[0];\n            values.hoursbehind = hoursFilter[1];\n        }\n        if (sortValueTable) {\n            sortValue = sortValueTable;\n            let sortArray = sortValue.split('_');\n            let sortOn = sortArray[0];\n            let direction = sortArray[1];\n            values.sorton = sortOn;\n            values.direction = direction;\n        }\n\n        let params = {'data': JSON.stringify(values)};\n\n        spinner.classList.remove('hide'); // Show spinner if not already shown.\n        Fragment.loadFragment('local_assessfreq', fragmentValue, contextId, params)\n            .done((response, js) => {\n                tableBody.innerHTML = response;\n                if (js) {\n                    Templates.runTemplateJS(js); // Magic call the initialises JS from template included in response template HTML.\n                }\n                spinner.classList.add('hide');\n                TableHandler.tableEventListeners(); // Re-add table event listeners.\n\n            }).fail(() => {\n            Notification.exception(new Error('Failed to update table.'));\n        });\n    };\n\n    /**\n     * This stops the ajax method that updates the table from being updated\n     * while the user is still checking options.\n     *\n     */\n    const debounceTable = Debouncer.debouncer(() => {\n        TableHandler.getTable(quizId, hoursFilter, sortValue);\n    }, 750);\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSort = function(event) {\n        event.preventDefault();\n\n        let sortArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const targetSortBy = linkUrl.searchParams.get('tsort');\n        let targetSortOrder = linkUrl.searchParams.get('tdir');\n\n        // We want to flip the clicked column.\n        if (targetSortOrder === '') {\n            targetSortOrder = \"4\";\n        }\n\n        sortArray[targetSortBy] = targetSortOrder;\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'sortby',\n                values: JSON.stringify(sortArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableHide = function(event) {\n        event.preventDefault();\n\n        let hideArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const tableElement = document.getElementById(elementId);\n        const links = tableElement.querySelectorAll('a');\n        let targetAction;\n        let targetColumn;\n        let action;\n        let column;\n\n        if (linkUrl.search.indexOf('thide') !== -1) {\n            targetAction = 'hide';\n            targetColumn = linkUrl.searchParams.get('thide');\n        } else {\n            targetAction = 'show';\n            targetColumn = linkUrl.searchParams.get('tshow');\n        }\n\n        for (let i = 0; i < links.length; i++) {\n            let hideLinkUrl = new URL(links[i].href);\n            if (hideLinkUrl.search.indexOf('thide') !== -1) {\n                action = 'hide';\n                column = hideLinkUrl.searchParams.get('thide');\n            } else {\n                action = 'show';\n                column = hideLinkUrl.searchParams.get('tshow');\n            }\n\n            if (action === 'show') {\n                hideArray[column] = 1;\n            }\n\n        }\n\n        hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'collapse',\n                values: JSON.stringify(hideArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the reset click event from the table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableReset = function(event) {\n        event.preventDefault();\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'reset',\n                values: JSON.stringify({})\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the search events from the student table.\n     *\n     */\n    TableHandler.tableSearch = function(event) {\n        if (event.key === 'Meta' || event.ctrlKey) {\n            return false;\n        }\n\n        if (event.target.value.length === 0 || event.target.value.length > 2) {\n            debounceTable();\n        }\n    };\n\n    /**\n     * Process the search reset click event from the student table.\n     *\n     */\n    TableHandler.tableSearchReset = function() {\n        let tableSearchInputElement = document.getElementById(searchElement);\n        tableSearchInputElement.value = '';\n        tableSearchInputElement.focus();\n        TableHandler.getTable(quizId, hoursFilter, sortValue);\n    };\n\n    /**\n     * Process the row set event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSearchRowSet = function(event) {\n        event.preventDefault();\n        if (event.target.tagName.toLowerCase() === 'a') {\n            let rows = event.target.dataset.metric;\n            UserPreference.setUserPreference(rowPreference, rows)\n                .then(() => {\n                    TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n                })\n                .fail(() => {\n                    Notification.exception(new Error('Failed to update user preference: rows'));\n                });\n        }\n    };\n\n    /**\n     * Process the nav event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableNav = function(event) {\n        event.preventDefault();\n\n        const linkUrl = new URL(event.target.closest('a').href);\n        const page = linkUrl.searchParams.get('page');\n\n        if (page) {\n            TableHandler.getTable(quizId, hoursFilter, sortValue, page);\n        }\n    };\n\n    /**\n     * Get and process the selected assessment metric from the dropdown for the heatmap display,\n     * and update the corresponding user preference.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSortButtonAction = function(event) {\n        event.preventDefault();\n        var element = event.target;\n\n        if (element.tagName.toLowerCase() === 'a' && element.dataset.sort !== sortValue) {\n            sortValue = element.dataset.sort;\n\n            let links = element.parentNode.getElementsByTagName('a');\n            for (let i = 0; i < links.length; i++) {\n                links[i].classList.remove('active');\n            }\n\n            element.classList.add('active');\n\n            // Save selection as a user preference.\n            UserPreference.setUserPreference('local_assessfreq_quiz_table_inprogress_sort_preference', sortValue);\n\n            debounceTable(); // Call function to update table.\n\n        }\n    };\n\n    /**\n     * Re-add event listeners when the student table is updated.\n     */\n    TableHandler.tableEventListeners = function() {\n        const tableElement = document.getElementById(elementId);\n        let tableNavElement;\n        if (cardElement) {\n            const tableCardElement = document.getElementById(cardElement);\n            const links = tableElement.querySelectorAll('a');\n            const resetLink = tableElement.getElementsByClassName('resettable');\n            const overrideLinks = tableElement.getElementsByClassName('action-icon override');\n            const disabledLinks = tableElement.getElementsByClassName('action-icon disabled');\n            tableNavElement = tableCardElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n\n            for (let i = 0; i < links.length; i++) {\n                let linkUrl = new URL(links[i].href);\n                if (linkUrl.search.indexOf('thide') !== -1 || linkUrl.search.indexOf('tshow') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableHide);\n                } else if (linkUrl.search.indexOf('tsort') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableSort);\n                }\n\n            }\n\n            if (resetLink.length > 0) {\n                resetLink[0].addEventListener('click', TableHandler.tableReset);\n            }\n\n            for (let i = 0; i < overrideLinks.length; i++) {\n                overrideLinks[i].addEventListener('click', TableHandler.triggerOverrideModal);\n            }\n\n            for (let i = 0; i < disabledLinks.length; i++) {\n                disabledLinks[i].addEventListener('click', (event) => {\n                    event.preventDefault();\n                });\n            }\n        } else {\n            tableNavElement = tableElement.querySelectorAll('nav');\n        }\n\n        tableNavElement.forEach((navElement) => {\n            navElement.addEventListener('click', TableHandler.tableNav);\n        });\n    };\n\n    /**\n     * Trigger the override modal form. Thin wrapper to add extra data to click event.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.triggerOverrideModal = function(event) {\n        event.preventDefault();\n        let userid = event.target.closest('a').id.substring(25);\n        if (userid.includes('-')) {\n            let elements = userid.split('-');\n            quizId = elements.pop();\n            userid = elements.pop();\n        }\n\n        OverrideModal.displayModalForm(quizId, userid, hoursFilter);\n    };\n\n    /**\n     * Initialise method for table handler.\n     *\n     * @param {int} quiz The quiz id.\n     * @param {int} context The context id.\n     * @param {string} tableCardElement The table card element.\n     * @param {string} tableElementId The table element id.\n     * @param {string} tableFragmentValue The table fragment value.\n     * @param {string} tableRowPreference The table row preference.\n     * @param {string} tableSearchElement The table search element.\n     * @param {string|null} tableId The table id.\n     * @param {string|null} tableMethodName The table method name.\n     */\n    TableHandler.init = function(quiz,\n                                 context,\n                                 tableCardElement,\n                                 tableElementId,\n                                 tableFragmentValue,\n                                 tableRowPreference,\n                                 tableSearchElement,\n                                 tableId = null,\n                                 tableMethodName = null) {\n        quizId = quiz;\n        contextId = context;\n        cardElement = tableCardElement;\n        elementId = tableElementId;\n        fragmentValue = tableFragmentValue;\n        rowPreference = tableRowPreference;\n        searchElement = tableSearchElement;\n        id = tableId;\n        methodName = tableMethodName;\n    };\n\n    return TableHandler;\n});\n"],"file":"table_handler.min.js"}