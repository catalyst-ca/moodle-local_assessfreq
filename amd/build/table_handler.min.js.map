{"version":3,"sources":["../src/table_handler.js"],"names":["define","Ajax","Fragment","Notification","Templates","UserPreference","OverrideModal","Debouncer","TableHandler","quizId","contextId","elementId","cardElement","SearchElement","rowPreference","dashboardType","fragmentValue","hoursFilter","sortValue","getTable","page","search","document","getElementById","value","trim","tableElement","spinner","getElementsByClassName","tableBody","values","sortarray","split","sorton","direction","hoursahead","hoursbehind","quiz","params","JSON","stringify","classList","remove","loadFragment","done","response","js","innerHTML","runTemplateJS","add","tableEventListeners","fail","exception","Error","debounceTable","debouncer","tableSort","event","preventDefault","sortArray","linkUrl","URL","target","closest","href","targetSortBy","searchParams","get","targetSortOrder","call","methodname","args","tableid","preference","then","tableHide","hideArray","links","querySelectorAll","targetAction","targetColumn","action","column","indexOf","i","hideLinkUrl","length","tableReset","tableSearch","key","ctrlKey","tableSearchReset","tableSearchInputElement","focus","tableSearchRowSet","tagName","toLowerCase","rows","dataset","metric","setUserPreference","tableNav","tableSortButtonAction","element","sort","parentNode","getElementsByTagName","tableNavElement","tableCardElement","resetlink","overrideLinks","disabledLinks","addEventListener","triggerOverrideModal","forEach","navElement","userid","id","substring","displayModalForm","init","context","tableDashboardType","tableElementId","tableSearchElement","tableRowPreference","tableFragmentValue","tableHoursFilter","tableSortValue"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Table handler JS module.\n *\n * @package    local_assessfreq\n * @copyright  2020 Guillermo Gomez <guillermogomez@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @module     local_assessfreq/table_handler\n */\ndefine([\n    'core/ajax',\n    'core/fragment',\n    'core/notification',\n    'core/templates',\n    'local_assessfreq/user_preferences',\n    'local_assessfreq/override_modal',\n    'local_assessfreq/debouncer',\n], function(Ajax, Fragment, Notification, Templates, UserPreference, OverrideModal, Debouncer) {\n\n    /**\n     * Module level variables.\n     */\n    var TableHandler = {};\n    var quizId;\n    var contextId;\n    var elementId;\n    var cardElement;\n    var SearchElement;\n    var rowPreference;\n    var dashboardType;\n    var fragmentValue;\n    var hoursFilter;\n    var sortValue;\n\n    /**\n     * Display the table that contains all the students in the exam as well as their attempts.\n     *\n     */\n    TableHandler.getTable = function(page) {\n        if (typeof page === \"undefined\") {\n            page = 0;\n        }\n\n        let search = document.getElementById(SearchElement).value.trim();\n        let tableElement = document.getElementById(elementId);\n        let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n        let tableBody = tableElement.getElementsByClassName('table-body')[0];\n        let values = {'search': search, 'page': page};\n\n        // Add values to Object depending on dashboard type.\n        if (dashboardType === 'inprogress') {\n            let sortarray = sortValue.split('_');\n            let sorton = sortarray[0];\n            let direction = sortarray[1];\n            values.sorton = sorton;\n            values.direction = direction;\n            values.hoursahead = hoursFilter[0];\n            values.hoursbehind = hoursFilter[1];\n        } else if (dashboardType === 'quiz') {\n            values.quiz = quizId;\n        } else if (dashboardType === 'student') {\n            values.hoursahead = hoursFilter[0];\n            values.hoursbehind = hoursFilter[1];\n        }\n        let params = {'data': JSON.stringify(values)};\n\n        spinner.classList.remove('hide'); // Show spinner if not already shown.\n        Fragment.loadFragment('local_assessfreq', fragmentValue, contextId, params)\n            .done((response, js) => {\n                tableBody.innerHTML = response;\n                if (dashboardType === 'inprogress') {\n                    Templates.runTemplateJS(js); // Magic call the initialises JS from template included in response template HTML.\n                }\n                spinner.classList.add('hide');\n                TableHandler.tableEventListeners(); // Re-add table event listeners.\n\n            }).fail(() => {\n            Notification.exception(new Error('Failed to update table.'));\n        });\n    };\n\n    /**\n     * This stops the ajax method that updates the table from being updated\n     * while the user is still checking options.\n     *\n     */\n    const debounceTable = Debouncer.debouncer(() => {\n        TableHandler.getTable();\n    }, 750);\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSort = function(event) {\n        event.preventDefault();\n\n        let sortArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const targetSortBy = linkUrl.searchParams.get('tsort');\n        let targetSortOrder = linkUrl.searchParams.get('tdir');\n\n        // We want to flip the clicked column.\n        if (targetSortOrder === '') {\n            targetSortOrder = \"4\";\n        }\n\n        sortArray[targetSortBy] = targetSortOrder;\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'sortby',\n                values: JSON.stringify(sortArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableHide = function(event) {\n        event.preventDefault();\n\n        let hideArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const tableElement = document.getElementById(elementId);\n        const links = tableElement.querySelectorAll('a');\n        let targetAction;\n        let targetColumn;\n        let action;\n        let column;\n\n        if (linkUrl.search.indexOf('thide') !== -1) {\n            targetAction = 'hide';\n            targetColumn = linkUrl.searchParams.get('thide');\n        } else {\n            targetAction = 'show';\n            targetColumn = linkUrl.searchParams.get('tshow');\n        }\n\n        for (let i = 0; i < links.length; i++) {\n            let hideLinkUrl = new URL(links[i].href);\n            if (hideLinkUrl.search.indexOf('thide') !== -1) {\n                action = 'hide';\n                column = hideLinkUrl.searchParams.get('thide');\n            } else {\n                action = 'show';\n                column = hideLinkUrl.searchParams.get('tshow');\n            }\n\n            if (action === 'show') {\n                hideArray[column] = 1;\n            }\n\n        }\n\n        hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'collapse',\n                values: JSON.stringify(hideArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the reset click event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableReset = function(event) {\n        event.preventDefault();\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'reset',\n                values: JSON.stringify({})\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the search events from the student table.\n     *\n     */\n    TableHandler.tableSearch = function(event) {\n        if (event.key === 'Meta' || event.ctrlKey) {\n            return false;\n        }\n\n        if (event.target.value.length === 0 || event.target.value.length > 2) {\n            debounceTable();\n        }\n    };\n\n    /**\n     * Process the search reset click event from the student table.\n     *\n     */\n    TableHandler.tableSearchReset = function() {\n        let tableSearchInputElement = document.getElementById(SearchElement);\n        tableSearchInputElement.value = '';\n        tableSearchInputElement.focus();\n        TableHandler.getTable();\n    };\n\n    /**\n     * Process the row set event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSearchRowSet = function(event) {\n        event.preventDefault();\n        if (event.target.tagName.toLowerCase() === 'a') {\n            let rows = event.target.dataset.metric;\n            UserPreference.setUserPreference(rowPreference, rows)\n                .then(() => {\n                    TableHandler.getTable(); // Reload the table.\n                })\n                .fail(() => {\n                    Notification.exception(new Error('Failed to update user preference: rows'));\n                });\n        }\n    };\n\n    /**\n     * Process the nav event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableNav = function(event) {\n        event.preventDefault();\n\n        const linkUrl = new URL(event.target.closest('a').href);\n        const page = linkUrl.searchParams.get('page');\n\n        if (page) {\n            TableHandler.getTable(page);\n        }\n    };\n\n    /**\n     * Get and process the selected assessment metric from the dropdown for the heatmap display,\n     * and update the corresponding user preference.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSortButtonAction = function(event) {\n        event.preventDefault();\n        var element = event.target;\n\n        if (element.tagName.toLowerCase() === 'a' && element.dataset.sort !== sortValue) {\n            sortValue = element.dataset.sort;\n\n            let links = element.parentNode.getElementsByTagName('a');\n            for (let i = 0; i < links.length; i++) {\n                links[i].classList.remove('active');\n            }\n\n            element.classList.add('active');\n\n            // Save selection as a user preference.\n            UserPreference.setUserPreference('local_assessfreq_quiz_table_inprogress_sort_preference', sortValue);\n\n            debounceTable(); // Call function to update table.\n\n        }\n    };\n\n    /**\n     * Re-add event listeners when the student table is updated.\n     */\n    TableHandler.tableEventListeners = function() {\n        const tableElement = document.getElementById(elementId);\n        let tableNavElement;\n\n        if (dashboardType === 'inprogress') {\n            // Quiz in progress dashboard only requires to get the navigation element.\n            tableNavElement = tableElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n        } else if (dashboardType === 'quiz' || dashboardType === 'student') {\n            const tableCardElement = document.getElementById(cardElement);\n            const links = tableElement.querySelectorAll('a');\n            const resetlink = tableElement.getElementsByClassName('resettable');\n            const overrideLinks = tableElement.getElementsByClassName('action-icon override');\n            const disabledLinks = tableElement.getElementsByClassName('action-icon disabled');\n            tableNavElement = tableCardElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n\n            for (let i = 0; i < links.length; i++) {\n                let linkUrl = new URL(links[i].href);\n                if (linkUrl.search.indexOf('thide') !== -1 || linkUrl.search.indexOf('tshow') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableHide);\n                } else if (linkUrl.search.indexOf('tsort') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableSort);\n                }\n\n            }\n\n            if (resetlink.length > 0) {\n                resetlink[0].addEventListener('click', TableHandler.tableReset);\n            }\n\n            for (let i = 0; i < overrideLinks.length; i++) {\n                overrideLinks[i].addEventListener('click', TableHandler.triggerOverrideModal);\n            }\n\n            for (let i = 0; i < disabledLinks.length; i++) {\n                disabledLinks[i].addEventListener('click', (event) => {\n                    event.preventDefault();\n                });\n            }\n        }\n\n        tableNavElement.forEach((navElement) => {\n            navElement.addEventListener('click', TableHandler.tableNav);\n        });\n    };\n\n    /**\n     * Trigger the override modal form. Thin wrapper to add extra data to click event.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.triggerOverrideModal = function(event) {\n        event.preventDefault();\n        const userid = event.target.closest('a').id.substring(25);\n\n        OverrideModal.displayModalForm(quizId, userid);\n    };\n\n    /**\n     * Initialise method for table handler.\n     *\n     * @param {int} quiz The quiz id.\n     * @param {int} context The context id.\n     * @param {string} tableDashboardType The dashboard type to handle (inprogress, quiz or student).\n     * @param {string} tableElementId The table element id.\n     * @param {string} tableCardElement The table card element.\n     * @param {string} tableSearchElement The table search element.\n     * @param {string} tableRowPreference The table row preference.\n     * @param {string} tableFragmentValue The table fragment value.\n     * @param {array|null} tableHoursFilter Array with hour ahead or behind preference.\n     * @param {string|null} tableSortValue The table sort preference.\n     */\n    TableHandler.init = function(quiz,\n                                 context,\n                                 tableDashboardType,\n                                 tableElementId,\n                                 tableCardElement,\n                                 tableSearchElement,\n                                 tableRowPreference,\n                                 tableFragmentValue,\n                                 tableHoursFilter = null,\n                                 tableSortValue = null) {\n        quizId = quiz;\n        contextId = context;\n        dashboardType = tableDashboardType;\n        elementId = tableElementId;\n        cardElement = tableCardElement;\n        SearchElement = tableSearchElement;\n        rowPreference = tableRowPreference;\n        fragmentValue = tableFragmentValue;\n        hoursFilter = tableHoursFilter;\n        sortValue = tableSortValue;\n    };\n\n    return TableHandler;\n});\n"],"file":"table_handler.min.js"}