{"version":3,"sources":["../src/table_handler.js"],"names":["define","$","Ajax","Fragment","Notification","Templates","Debouncer","OverrideModal","UserPreference","TableHandler","activeOptionsElement","cardElement","contextId","elementId","fragmentValue","hoursFilter","quizId","overridden","rowPreference","sortValue","searchElement","id","methodName","getTable","quiz","hours","sortValueTable","page","search","document","getElementById","value","trim","tableElement","spinner","getElementsByClassName","tableBody","values","hoursahead","hoursbehind","sortArray","split","sortOn","direction","sorton","params","JSON","stringify","classList","remove","loadFragment","done","response","js","innerHTML","runTemplateJS","add","tooltip","tableEventListeners","fail","exception","Error","debounceTable","debouncer","tableSort","event","preventDefault","linkUrl","URL","target","closest","href","targetSortBy","searchParams","get","targetSortOrder","call","methodname","args","tableid","preference","then","tableHide","hideArray","links","querySelectorAll","targetAction","targetColumn","action","column","indexOf","i","hideLinkUrl","length","tableReset","tableSearch","key","ctrlKey","tableSearchReset","tableSearchInputElement","focus","tableSearchRowSet","tagName","toLowerCase","rows","dataset","metric","activeoptions","setUserPreference","tableNav","tableSortButtonAction","element","sort","parentNode","getElementsByTagName","tableNavElement","tableCardElement","resetLink","overrideLinks","disabledLinks","addEventListener","triggerOverrideModal","forEach","navElement","userid","substring","includes","elements","pop","displayModalForm","init","context","tableElementId","tableFragmentValue","tableRowPreference","tableSearchElement","tableId","tableMethodName","tableActiveOptions"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Table handler JS module.\n *\n * @package    local_assessfreq\n * @copyright  2020 Guillermo Gomez <guillermogomez@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @module     local_assessfreq/table_handler\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/fragment',\n    'core/notification',\n    'core/templates',\n    'local_assessfreq/debouncer',\n    'local_assessfreq/override_modal',\n    'local_assessfreq/user_preferences'\n], function($, Ajax, Fragment, Notification, Templates, Debouncer, OverrideModal, UserPreference) {\n\n    /**\n     * Module level variables.\n     */\n    var TableHandler = {};\n\n    var activeOptionsElement;\n    var cardElement;\n    var contextId;\n    var elementId;\n    var fragmentValue;\n    var hoursFilter;\n    var quizId = 0;\n    var overridden = false;\n    var rowPreference;\n    var sortValue;\n    var searchElement;\n\n    /**\n     * Table id variable.\n     *\n     * @type {string}\n     */\n    var id;\n\n    /**\n     * Table method name variable.\n     *\n     * @type {string}\n     */\n    var methodName;\n\n    /**\n     * Display the table that contains all the students in the exam as well as their attempts.\n     *\n     * @param {int} quiz The Quiz Id.\n     * @param {array|null} hours Array with hour ahead or behind preference.\n     * @param {string|null} sortValueTable Sort preference.\n     * @param {int|string|null} page Page number.\n     */\n    TableHandler.getTable = function(quiz, hours = null, sortValueTable = null, page) {\n        if (typeof page === \"undefined\" || overridden === true) {\n            page = 0;\n        }\n\n        overridden = false;\n\n        let search = document.getElementById(searchElement).value.trim();\n        let tableElement = document.getElementById(elementId);\n        let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n        let tableBody = tableElement.getElementsByClassName('table-body')[0];\n        let values = {'search': search, 'page': page};\n\n        // Add values to Object depending on dashboard type.\n        if (quiz > 0) {\n            quizId = quiz;\n            values.quiz = quizId;\n        }\n        if (hours) {\n            hoursFilter = hours;\n            values.hoursahead = hoursFilter[0];\n            values.hoursbehind = hoursFilter[1];\n        }\n        if (sortValueTable) {\n            sortValue = sortValueTable;\n            let sortArray = sortValue.split('_');\n            let sortOn = sortArray[0];\n            let direction = sortArray[1];\n            values.sorton = sortOn;\n            values.direction = direction;\n        }\n\n        let params = {'data': JSON.stringify(values)};\n\n        spinner.classList.remove('hide'); // Show spinner if not already shown.\n        Fragment.loadFragment('local_assessfreq', fragmentValue, contextId, params)\n            .done((response, js) => {\n                tableBody.innerHTML = response;\n                if (js) {\n                    Templates.runTemplateJS(js); // Magic call the initialises JS from template included in response template HTML.\n                }\n                spinner.classList.add('hide');\n                $('[data-toggle=\"tooltip\"]').tooltip();\n                TableHandler.tableEventListeners(); // Re-add table event listeners.\n\n            }).fail(() => {\n            Notification.exception(new Error('Failed to update table.'));\n        });\n    };\n\n    /**\n     * This stops the ajax method that updates the table from being updated\n     * while the user is still checking options.\n     *\n     */\n    const debounceTable = Debouncer.debouncer(() => {\n        TableHandler.getTable(quizId, hoursFilter, sortValue);\n    }, 750);\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSort = function(event) {\n        event.preventDefault();\n\n        let sortArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const targetSortBy = linkUrl.searchParams.get('tsort');\n        let targetSortOrder = linkUrl.searchParams.get('tdir');\n\n        // We want to flip the clicked column.\n        if (targetSortOrder === '') {\n            targetSortOrder = \"4\";\n        }\n\n        sortArray[targetSortBy] = targetSortOrder;\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'sortby',\n                values: JSON.stringify(sortArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableHide = function(event) {\n        event.preventDefault();\n\n        let hideArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const tableElement = document.getElementById(elementId);\n        const links = tableElement.querySelectorAll('a');\n        let targetAction;\n        let targetColumn;\n        let action;\n        let column;\n\n        if (linkUrl.search.indexOf('thide') !== -1) {\n            targetAction = 'hide';\n            targetColumn = linkUrl.searchParams.get('thide');\n        } else {\n            targetAction = 'show';\n            targetColumn = linkUrl.searchParams.get('tshow');\n        }\n\n        for (let i = 0; i < links.length; i++) {\n            let hideLinkUrl = new URL(links[i].href);\n            if (hideLinkUrl.search.indexOf('thide') !== -1) {\n                action = 'hide';\n                column = hideLinkUrl.searchParams.get('thide');\n            } else {\n                action = 'show';\n                column = hideLinkUrl.searchParams.get('tshow');\n            }\n\n            if (action === 'show') {\n                hideArray[column] = 1;\n            }\n\n        }\n\n        hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'collapse',\n                values: JSON.stringify(hideArray)\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the reset click event from the table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableReset = function(event) {\n        event.preventDefault();\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: methodName,\n            args: {\n                tableid: id,\n                preference: 'reset',\n                values: JSON.stringify({})\n            },\n        }])[0].then(() => {\n            TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the search events from the student table.\n     *\n     */\n    TableHandler.tableSearch = function(event) {\n        if (event.key === 'Meta' || event.ctrlKey) {\n            return false;\n        }\n\n        if (event.target.value.length === 0 || event.target.value.length > 2) {\n            debounceTable();\n        }\n    };\n\n    /**\n     * Process the search reset click event from the student table.\n     *\n     */\n    TableHandler.tableSearchReset = function() {\n        let tableSearchInputElement = document.getElementById(searchElement);\n        tableSearchInputElement.value = '';\n        tableSearchInputElement.focus();\n        TableHandler.getTable(quizId, hoursFilter, sortValue);\n    };\n\n    /**\n     * Process the row set event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSearchRowSet = function(event) {\n        event.preventDefault();\n        if (event.target.tagName.toLowerCase() === 'a') {\n            let rows = event.target.dataset.metric;\n            let activeoptions = document.getElementById(activeOptionsElement)\n                .getElementsByClassName('active');\n\n            // Fix active classes.\n            for (var i = 0; i < activeoptions.length; i++) {\n                activeoptions[i].classList.remove('active');\n            }\n            event.target.classList.add('active');\n\n            UserPreference.setUserPreference(rowPreference, rows)\n                .then(() => {\n                    TableHandler.getTable(quizId, hoursFilter, sortValue); // Reload the table.\n                })\n                .fail(() => {\n                    Notification.exception(new Error('Failed to update user preference: rows'));\n                });\n        }\n    };\n\n    /**\n     * Process the nav event from the student table.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableNav = function(event) {\n        event.preventDefault();\n\n        const linkUrl = new URL(event.target.closest('a').href);\n        const page = linkUrl.searchParams.get('page');\n\n        if (page) {\n            TableHandler.getTable(quizId, hoursFilter, sortValue, page);\n        }\n    };\n\n    /**\n     * Get and process the selected assessment metric from the dropdown for the heatmap display,\n     * and update the corresponding user preference.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.tableSortButtonAction = function(event) {\n        event.preventDefault();\n        var element = event.target;\n\n        if (element.tagName.toLowerCase() === 'a' && element.dataset.sort !== sortValue) {\n            sortValue = element.dataset.sort;\n\n            let links = element.parentNode.getElementsByTagName('a');\n            for (let i = 0; i < links.length; i++) {\n                links[i].classList.remove('active');\n            }\n\n            element.classList.add('active');\n\n            // Save selection as a user preference.\n            UserPreference.setUserPreference('local_assessfreq_quiz_table_inprogress_sort_preference', sortValue);\n\n            debounceTable(); // Call function to update table.\n\n        }\n    };\n\n    /**\n     * Re-add event listeners when the student table is updated.\n     */\n    TableHandler.tableEventListeners = function() {\n        const tableElement = document.getElementById(elementId);\n        let tableNavElement;\n        if (cardElement) {\n            const tableCardElement = document.getElementById(cardElement);\n            const links = tableElement.querySelectorAll('a');\n            const resetLink = tableElement.getElementsByClassName('resettable');\n            const overrideLinks = tableElement.getElementsByClassName('action-icon override');\n            const disabledLinks = tableElement.getElementsByClassName('action-icon disabled');\n            tableNavElement = tableCardElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n\n            for (let i = 0; i < links.length; i++) {\n                let linkUrl = new URL(links[i].href);\n                if (linkUrl.search.indexOf('thide') !== -1 || linkUrl.search.indexOf('tshow') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableHide);\n                } else if (linkUrl.search.indexOf('tsort') !== -1) {\n                    links[i].addEventListener('click', TableHandler.tableSort);\n                }\n\n            }\n\n            if (resetLink.length > 0) {\n                resetLink[0].addEventListener('click', TableHandler.tableReset);\n            }\n\n            for (let i = 0; i < overrideLinks.length; i++) {\n                overrideLinks[i].addEventListener('click', TableHandler.triggerOverrideModal);\n            }\n\n            for (let i = 0; i < disabledLinks.length; i++) {\n                disabledLinks[i].addEventListener('click', (event) => {\n                    event.preventDefault();\n                });\n            }\n        } else {\n            tableNavElement = tableElement.querySelectorAll('nav');\n        }\n\n        tableNavElement.forEach((navElement) => {\n            navElement.addEventListener('click', TableHandler.tableNav);\n        });\n    };\n\n    /**\n     * Trigger the override modal form. Thin wrapper to add extra data to click event.\n     *\n     * @param {Event} event The triggered event for the element.\n     */\n    TableHandler.triggerOverrideModal = function(event) {\n        event.preventDefault();\n        let userid = event.target.closest('a').id.substring(25);\n        if (userid.includes('-')) {\n            let elements = userid.split('-');\n            quizId = elements.pop();\n            userid = elements.pop();\n        }\n\n        OverrideModal.displayModalForm(quizId, userid, hoursFilter);\n    };\n\n    /**\n     * Initialise method for table handler.\n     *\n     * @param {int} quiz The quiz id.\n     * @param {int} context The context id.\n     * @param {string} tableCardElement The table card element.\n     * @param {string} tableElementId The table element id.\n     * @param {string} tableFragmentValue The table fragment value.\n     * @param {string} tableRowPreference The table row preference.\n     * @param {string} tableSearchElement The table search element.\n     * @param {string|null} tableId The table id.\n     * @param {string|null} tableMethodName The table method name.\n     * @param {string} tableActiveOptions The table active option element.\n     */\n    TableHandler.init = function(quiz,\n                                 context,\n                                 tableCardElement,\n                                 tableElementId,\n                                 tableFragmentValue,\n                                 tableRowPreference,\n                                 tableSearchElement,\n                                 tableId = null,\n                                 tableMethodName = null,\n                                 tableActiveOptions = null) {\n        quizId = quiz;\n        contextId = context;\n        cardElement = tableCardElement;\n        elementId = tableElementId;\n        fragmentValue = tableFragmentValue;\n        rowPreference = tableRowPreference;\n        searchElement = tableSearchElement;\n        id = tableId;\n        methodName = tableMethodName;\n        activeOptionsElement = tableActiveOptions;\n    };\n\n    return TableHandler;\n});\n"],"file":"table_handler.min.js"}