{"version":3,"sources":["../src/table_handler.js"],"names":["cardElement","contextId","elementId","fragmentValue","hoursFilter","quizId","overridden","rowPreference","sortValue","searchElement","id","methodName","getTable","quiz","hours","sortValueTable","page","search","document","getElementById","value","trim","tableElement","spinner","getElementsByClassName","tableBody","values","hoursahead","hoursbehind","sortArray","split","sortOn","direction","sorton","params","JSON","stringify","classList","remove","Fragment","loadFragment","done","response","js","innerHTML","Templates","runTemplateJS","add","tableEventListeners","fail","Notification","exception","Error","debounceTable","Debouncer","debouncer","tableSort","event","preventDefault","linkUrl","URL","target","closest","href","targetSortBy","searchParams","get","targetSortOrder","Ajax","call","methodname","args","tableid","preference","then","tableHide","hideArray","links","querySelectorAll","targetAction","targetColumn","action","column","indexOf","i","hideLinkUrl","length","tableReset","tableSearch","key","ctrlKey","tableSearchReset","tableSearchInputElement","focus","tableSearchRowSet","tagName","toLowerCase","rows","dataset","metric","UserPreference","setUserPreference","tableNav","tableSortButtonAction","element","sort","parentNode","getElementsByTagName","tableNavElement","tableCardElement","resetLink","overrideLinks","disabledLinks","addEventListener","triggerOverrideModal","forEach","navElement","userid","substring","includes","elements","pop","OverrideModal","displayModalForm","init","context","tableElementId","tableFragmentValue","tableRowPreference","tableSearchElement","tableId","tableMethodName"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Table handler JS module.\n *\n * @module     local_assessfreq/table_handler\n * @package    local_assessfreq\n * @copyright  2020 Guillermo Gomez <guillermogomez@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Fragment from 'core/fragment';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport * as Debouncer from 'local_assessfreq/debouncer';\nimport OverrideModal from 'local_assessfreq/override_modal';\nimport * as UserPreference from 'local_assessfreq/user_preferences';\n\n/**\n * Module level variables.\n */\nlet cardElement;\nlet contextId;\nlet elementId;\nlet fragmentValue;\nlet hoursFilter;\nlet quizId = 0;\nlet overridden = false;\nlet rowPreference;\nlet sortValue;\nlet searchElement;\n\n/**\n * Table id variable.\n *\n * @type {string}\n */\nlet id;\n\n/**\n * Table method name variable.\n *\n * @type {string}\n */\nlet methodName;\n\n/**\n * Display the table that contains all the students in the exam as well as their attempts.\n *\n * @param {int} quiz The Quiz Id.\n * @param {array|null} hours Array with hour ahead or behind preference.\n * @param {string|null} sortValueTable Sort preference.\n * @param {int|string|null} page Page number.\n */\nexport const getTable = (quiz, hours = null, sortValueTable = null, page) => {\n    if (typeof page === \"undefined\" || overridden === true) {\n        page = 0;\n    }\n\n    overridden = false;\n\n    let search = document.getElementById(searchElement).value.trim();\n    let tableElement = document.getElementById(elementId);\n    let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n    let tableBody = tableElement.getElementsByClassName('table-body')[0];\n    let values = {'search': search, 'page': page};\n\n    // Add values to Object depending on dashboard type.\n    if (quiz > 0) {\n        quizId = quiz;\n        values.quiz = quizId;\n    }\n    if (hours) {\n        hoursFilter = hours;\n        values.hoursahead = hoursFilter[0];\n        values.hoursbehind = hoursFilter[1];\n    }\n    if (sortValueTable) {\n        sortValue = sortValueTable;\n        let sortArray = sortValue.split('_');\n        let sortOn = sortArray[0];\n        let direction = sortArray[1];\n        values.sorton = sortOn;\n        values.direction = direction;\n    }\n\n    let params = {'data': JSON.stringify(values)};\n\n    spinner.classList.remove('hide'); // Show spinner if not already shown.\n    Fragment.loadFragment('local_assessfreq', fragmentValue, contextId, params)\n        .done((response, js) => {\n            tableBody.innerHTML = response;\n            if (js) {\n                Templates.runTemplateJS(js); // Magic call the initialises JS from template included in response template HTML.\n            }\n            spinner.classList.add('hide');\n            tableEventListeners(); // Re-add table event listeners.\n\n        }).fail(() => {\n        Notification.exception(new Error('Failed to update table.'));\n    });\n};\n\n/**\n * This stops the ajax method that updates the table from being updated\n * while the user is still checking options.\n *\n */\nconst debounceTable = Debouncer.debouncer(() => {\n    getTable(quizId, hoursFilter, sortValue);\n}, 750);\n\n/**\n * Process the sort click events from the student table.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst tableSort = (event) => {\n    event.preventDefault();\n\n    let sortArray = {};\n    const linkUrl = new URL(event.target.closest('a').href);\n    const targetSortBy = linkUrl.searchParams.get('tsort');\n    let targetSortOrder = linkUrl.searchParams.get('tdir');\n\n    // We want to flip the clicked column.\n    if (targetSortOrder === '') {\n        targetSortOrder = \"4\";\n    }\n\n    sortArray[targetSortBy] = targetSortOrder;\n\n    // Set option via ajax.\n    Ajax.call([{\n        methodname: methodName,\n        args: {\n            tableid: id,\n            preference: 'sortby',\n            values: JSON.stringify(sortArray)\n        },\n    }])[0].then(() => {\n        getTable(quizId, hoursFilter, sortValue); // Reload the table.\n    });\n\n};\n\n/**\n * Process the sort click events from the student table.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst tableHide = (event) => {\n    event.preventDefault();\n\n    let hideArray = {};\n    const linkUrl = new URL(event.target.closest('a').href);\n    const tableElement = document.getElementById(elementId);\n    const links = tableElement.querySelectorAll('a');\n    let targetAction;\n    let targetColumn;\n    let action;\n    let column;\n\n    if (linkUrl.search.indexOf('thide') !== -1) {\n        targetAction = 'hide';\n        targetColumn = linkUrl.searchParams.get('thide');\n    } else {\n        targetAction = 'show';\n        targetColumn = linkUrl.searchParams.get('tshow');\n    }\n\n    for (let i = 0; i < links.length; i++) {\n        let hideLinkUrl = new URL(links[i].href);\n        if (hideLinkUrl.search.indexOf('thide') !== -1) {\n            action = 'hide';\n            column = hideLinkUrl.searchParams.get('thide');\n        } else {\n            action = 'show';\n            column = hideLinkUrl.searchParams.get('tshow');\n        }\n\n        if (action === 'show') {\n            hideArray[column] = 1;\n        }\n\n    }\n\n    hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n    // Set option via ajax.\n    Ajax.call([{\n        methodname: methodName,\n        args: {\n            tableid: id,\n            preference: 'collapse',\n            values: JSON.stringify(hideArray)\n        },\n    }])[0].then(() => {\n        getTable(quizId, hoursFilter, sortValue); // Reload the table.\n    });\n\n};\n\n/**\n * Process the reset click event from the table.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst tableReset = (event) => {\n    event.preventDefault();\n\n    // Set option via ajax.\n    Ajax.call([{\n        methodname: methodName,\n        args: {\n            tableid: id,\n            preference: 'reset',\n            values: JSON.stringify({})\n        },\n    }])[0].then(() => {\n        getTable(quizId, hoursFilter, sortValue); // Reload the table.\n    });\n\n};\n\n/**\n * Process the search events from the student table.\n *\n */\nexport const tableSearch = (event) => {\n    if (event.key === 'Meta' || event.ctrlKey) {\n        return false;\n    }\n\n    if (event.target.value.length === 0 || event.target.value.length > 2) {\n        debounceTable();\n    }\n};\n\n/**\n * Process the search reset click event from the student table.\n *\n */\nexport const tableSearchReset = () => {\n    let tableSearchInputElement = document.getElementById(searchElement);\n    tableSearchInputElement.value = '';\n    tableSearchInputElement.focus();\n    getTable(quizId, hoursFilter, sortValue);\n};\n\n/**\n * Process the row set event from the student table.\n *\n * @param {Event} event The triggered event for the element.\n */\nexport const tableSearchRowSet = (event) => {\n    event.preventDefault();\n    if (event.target.tagName.toLowerCase() === 'a') {\n        let rows = event.target.dataset.metric;\n        UserPreference.setUserPreference(rowPreference, rows)\n            .then(() => {\n                getTable(quizId, hoursFilter, sortValue); // Reload the table.\n            })\n            .fail(() => {\n                Notification.exception(new Error('Failed to update user preference: rows'));\n            });\n    }\n};\n\n/**\n * Process the nav event from the student table.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst tableNav = (event) => {\n    event.preventDefault();\n\n    const linkUrl = new URL(event.target.closest('a').href);\n    const page = linkUrl.searchParams.get('page');\n\n    if (page) {\n        getTable(quizId, hoursFilter, sortValue, page);\n    }\n};\n\n/**\n * Get and process the selected assessment metric from the dropdown for the heatmap display,\n * and update the corresponding user preference.\n *\n * @param {Event} event The triggered event for the element.\n */\nexport const tableSortButtonAction = (event) => {\n    event.preventDefault();\n    var element = event.target;\n\n    if (element.tagName.toLowerCase() === 'a' && element.dataset.sort !== sortValue) {\n        sortValue = element.dataset.sort;\n\n        let links = element.parentNode.getElementsByTagName('a');\n        for (let i = 0; i < links.length; i++) {\n            links[i].classList.remove('active');\n        }\n\n        element.classList.add('active');\n\n        // Save selection as a user preference.\n        UserPreference.setUserPreference('local_assessfreq_quiz_table_inprogress_sort_preference', sortValue);\n\n        debounceTable(); // Call function to update table.\n\n    }\n};\n\n/**\n * Re-add event listeners when the student table is updated.\n */\nconst tableEventListeners = () => {\n    const tableElement = document.getElementById(elementId);\n    let tableNavElement;\n    if (cardElement) {\n        const tableCardElement = document.getElementById(cardElement);\n        const links = tableElement.querySelectorAll('a');\n        const resetLink = tableElement.getElementsByClassName('resettable');\n        const overrideLinks = tableElement.getElementsByClassName('action-icon override');\n        const disabledLinks = tableElement.getElementsByClassName('action-icon disabled');\n        tableNavElement = tableCardElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n\n        for (let i = 0; i < links.length; i++) {\n            let linkUrl = new URL(links[i].href);\n            if (linkUrl.search.indexOf('thide') !== -1 || linkUrl.search.indexOf('tshow') !== -1) {\n                links[i].addEventListener('click', tableHide);\n            } else if (linkUrl.search.indexOf('tsort') !== -1) {\n                links[i].addEventListener('click', tableSort);\n            }\n\n        }\n\n        if (resetLink.length > 0) {\n            resetLink[0].addEventListener('click', tableReset);\n        }\n\n        for (let i = 0; i < overrideLinks.length; i++) {\n            overrideLinks[i].addEventListener('click', triggerOverrideModal);\n        }\n\n        for (let i = 0; i < disabledLinks.length; i++) {\n            disabledLinks[i].addEventListener('click', (event) => {\n                event.preventDefault();\n            });\n        }\n    } else {\n        tableNavElement = tableElement.querySelectorAll('nav');\n    }\n\n    tableNavElement.forEach((navElement) => {\n        navElement.addEventListener('click', tableNav);\n    });\n};\n\n/**\n * Trigger the override modal form. Thin wrapper to add extra data to click event.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst triggerOverrideModal = (event) => {\n    event.preventDefault();\n    let userid = event.target.closest('a').id.substring(25);\n    if (userid.includes('-')) {\n        let elements = userid.split('-');\n        quizId = elements.pop();\n        userid = elements.pop();\n    }\n\n    OverrideModal.displayModalForm(quizId, userid, hoursFilter);\n};\n\n/**\n * Initialise method for table handler.\n *\n * @param {int} quiz The quiz id.\n * @param {int} context The context id.\n * @param {string} tableCardElement The table card element.\n * @param {string} tableElementId The table element id.\n * @param {string} tableFragmentValue The table fragment value.\n * @param {string} tableRowPreference The table row preference.\n * @param {string} tableSearchElement The table search element.\n * @param {string|null} tableId The table id.\n * @param {string|null} tableMethodName The table method name.\n */\nexport const init = (quiz,\n                     context,\n                     tableCardElement,\n                     tableElementId,\n                     tableFragmentValue,\n                     tableRowPreference,\n                     tableSearchElement,\n                     tableId = null,\n                     tableMethodName = null) => {\n    quizId = quiz;\n    contextId = context;\n    cardElement = tableCardElement;\n    elementId = tableElementId;\n    fragmentValue = tableFragmentValue;\n    rowPreference = tableRowPreference;\n    searchElement = tableSearchElement;\n    id = tableId;\n    methodName = tableMethodName;\n};\n"],"file":"table_handler.min.js"}