define ("local_assessfreq/dashboard_quiz",["core/ajax","core/notification","core/str","core/templates","local_assessfreq/chart_data","local_assessfreq/form_modal","local_assessfreq/override_modal","local_assessfreq/table_handler","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g,h,i,j){var k={},l="",m,n=0,o=60,p,q=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],r=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,b=document.getElementById("local-assessfreq-period-progress");if(!0===a){clearInterval(p);p=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(p){return}p=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/o;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(p);p=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);s(n);r()}},1e3)},s=function(f){n=f;var g=document.getElementById("local-assessfreq-quiz-title");g.innerHTML=l;a.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:f}}])[0].then(function(a){var f=JSON.parse(a),i=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),j=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),k=document.getElementById("local-assessfreq-quiz-summary-card"),l=k.getElementsByClassName("overlay-icon-container")[0],m=document.getElementById("local-assessfreq-quiz-table"),o=document.getElementById("local-assessfreq-period-container"),p=document.getElementById("local-assessfreq-quiz-student-table-search"),q=document.getElementById("local-assessfreq-quiz-student-table-search-reset"),s=document.getElementById("local-assessfreq-quiz-student-table-rows"),t=document.createElement("a");t.href=f.url;t.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";g.innerHTML=f.name+"&nbsp;";g.appendChild(t);var u=new URL(window.location.href),v=u.origin+u.pathname+"?id="+n;history.pushState({},"",v);c.get_string("dashboard:quiztitle","local_assessfreq",{quiz:f.name,course:f.courseshortname}).then(function(a){document.title=a}).catch(function(){b.exception(new Error("Failed to load string: dashboard:quiztitle"))});d.render("local_assessfreq/quiz-summary-card-content",f).done(function(a){l.classList.add("hide");var b=document.getElementById("local-assessfreq-quiz-summary-card-content");d.replaceNodeContents(b,a,"")}).fail(function(){b.exception(new Error("Failed to load quiz summary template."))});i.classList.remove("hide");j.classList.remove("hide");m.classList.remove("hide");o.classList.remove("hide");e.getCardCharts(n);h.getTable(n);r();p.addEventListener("keyup",h.tableSearch);p.addEventListener("paste",h.tableSearch);q.addEventListener("click",h.tableSearchReset);s.addEventListener("click",h.tableSearchRowSet)}).fail(function(){b.exception(new Error("Failed to get quiz data"))})},t=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"===b.closest("button").id){r(!0);s(n)}else if("a"===b.tagName.toLowerCase()){o=b.dataset.period;r(!0);i.setUserPreference("local_assessfreq_quiz_refresh_preference",o)}},u=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({quiz:n,call:b})};j.zoomGraph(a,c,"get_quiz_chart")};k.init=function(a,d){m=a;f.init(a,s);j.init(a);g.init(a,s);h.init(n,m,"local-assessfreq-quiz-student-table","local-assessfreq-quiz-table","get_student_table","local_assessfreq_quiz_table_rows_preference","local-assessfreq-quiz-student-table-search");e.init(q,a,"get_quiz_chart","local_assessfreq/chart");c.get_string("loadingquiztitle","local_assessfreq").then(function(a){l=a}).catch(function(){b.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<d){n=d;s(d)}});i.getUserPreference("local_assessfreq_quiz_refresh_preference").then(function(a){o=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){b.exception(new Error("Failed to get use preference: refresh"))});var k=document.getElementById("local-assessfreq-period-container");k.addEventListener("click",t);var p=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");p.addEventListener("click",u);var r=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");r.addEventListener("click",u)};return k});
//# sourceMappingURL=dashboard_quiz.min.js.map
