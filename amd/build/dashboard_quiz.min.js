define ("local_assessfreq/dashboard_quiz",["jquery","local_assessfreq/form_modal","core/ajax","core/notification","core/str","core/fragment","core/templates","local_assessfreq/zoom_modal","local_assessfreq/override_modal"],function(a,b,c,d,e,f,g,h,i){var j={},k="",l,m=0,n=60,o,p=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],q=function(a,b){return c.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:a,value:b}]}}])[0]},r=function(a){return c.call([{methodname:"local_assessfreq_get_user_preferences",args:{name:a}}])[0]},s=function debouncer(a,b){var c;return function(){for(var d=arguments.length,e=Array(d),f=0;f<d;f++){e[f]=arguments[f]}var g=function(){clearTimeout(c);a.apply(void 0,e)};clearTimeout(c);c=setTimeout(g,b)}}(function(){D()},750),t=function(a){var b=document.getElementById("local-assessfreq-period-progress");if(!0==a){clearInterval(o);o=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(o){return}o=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/n;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(o);o=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);E(m);t()}},1e3)},u=function(){p.forEach(function(a){var b=document.getElementById(a.cardId),c=b.getElementsByClassName("overlay-icon-container")[0],h=b.getElementsByClassName("chart-body")[0],i={data:JSON.stringify({quiz:m,call:a.call})};c.classList.remove("hide");f.loadFragment("local_assessfreq","get_quiz_chart",l,i).done(function(b){var f=JSON.parse(b);if(!0==f.hasdata){var i={withtable:!0,chartdata:JSON.stringify(f.chart),aspect:a.aspect};g.render("local_assessfreq/chart",i).done(function(a,b){c.classList.add("hide");g.replaceNodeContents(h,a,b)}).fail(function(){d.exception(new Error("Failed to load chart template."))})}else{e.get_string("nodata","local_assessfreq").then(function(a){var b=document.createElement("h3");b.innerHTML=a;h.innerHTML=b.outerHTML;c.classList.add("hide")}).catch(function(){d.exception(new Error("Failed to load string: nodata"))})}}).fail(function(){d.exception(new Error("Failed to load card."))})})},v=function(a){a.preventDefault();var b={},d=new URL(a.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(!f){f="4"}b[e]=f;c.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(b)}}])[0].then(function(){D()})},w=function(a){a.preventDefault();var b={},d=new URL(a.target.closest("a").href),e=document.getElementById("local-assessfreq-quiz-table"),f=e.querySelectorAll("a"),g,h,j,k;if(-1!==d.search.indexOf("thide")){g="hide";h=d.searchParams.get("thide")}else{g="show";h=d.searchParams.get("tshow")}for(var l=0,i;l<f.length;l++){i=new URL(f[l].href);if(-1!==i.search.indexOf("thide")){j="hide";k=i.searchParams.get("thide")}else{j="show";k=i.searchParams.get("tshow")}if("show"===j){b[k]=1}}b[h]="hide"===g?1:0;c.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(b)}}])[0].then(function(){D()})},x=function(a){a.preventDefault();c.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){D()})},y=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){s()}},z=function(){var a=document.getElementById("local-assessfreq-quiz-student-table-search");a.value="";a.focus();D()},A=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById("local-assessfreq-quiz-student-table-rows-filter").getElementsByClassName("active"),e=0;e<c.length;e++){c[e].classList.remove("active")}a.target.classList.add("active");q("local_assessfreq_quiz_table_rows_preference",b).then(function(){D()}).fail(function(){d.exception(new Error("Failed to update user preference: rows"))})}},B=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){D(c)}},C=function(){for(var a=document.getElementById("local-assessfreq-quiz-table"),b=document.getElementById("local-assessfreq-quiz-student-table"),c=a.querySelectorAll("a"),d=a.getElementsByClassName("resettable"),e=a.getElementsByClassName("action-icon override"),f=a.getElementsByClassName("action-icon disabled"),g=b.querySelectorAll("nav"),h=0,j;h<c.length;h++){j=new URL(c[h].href);if(-1!==j.search.indexOf("thide")||-1!==j.search.indexOf("tshow")){c[h].addEventListener("click",w)}else if(-1!==j.search.indexOf("tsort")){c[h].addEventListener("click",v)}}if(0<d.length){d[0].addEventListener("click",x)}for(var k=0;k<e.length;k++){e[k].addEventListener("click",H)}for(var l=0;l<f.length;l++){f[l].addEventListener("click",function(a){a.preventDefault()})}g.forEach(function(a){a.addEventListener("click",B)})},D=function(b){if("undefined"==typeof b){b=0}var c=document.getElementById("local-assessfreq-quiz-student-table-search").value.trim(),e=document.getElementById("local-assessfreq-quiz-table"),g=e.getElementsByClassName("overlay-icon-container")[0],h=e.getElementsByClassName("table-body")[0],i={data:JSON.stringify({quiz:m,search:c,page:b})};g.classList.remove("hide");f.loadFragment("local_assessfreq","get_student_table",l,i).done(function(b){h.innerHTML=b;g.classList.add("hide");C();a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){d.exception(new Error("Failed to update table."))})},E=function(b){m=b;var f=document.getElementById("local-assessfreq-quiz-title");f.innerHTML=k;c.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:b}}])[0].then(function(b){var c=JSON.parse(b),h=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),i=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),j=document.getElementById("local-assessfreq-quiz-summary-card"),k=j.getElementsByClassName("overlay-icon-container")[0],l=document.getElementById("local-assessfreq-quiz-table"),n=document.getElementById("local-assessfreq-period-container"),o=document.getElementById("local-assessfreq-quiz-student-table-search"),p=document.getElementById("local-assessfreq-quiz-student-table-search-reset"),q=document.getElementById("local-assessfreq-quiz-student-table-rows"),r=document.createElement("a");r.href=c.url;r.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";f.innerHTML=c.name+"&nbsp;";f.appendChild(r);var s=new URL(window.location.href),v=s.origin+s.pathname+"?id="+m;history.pushState({},"",v);e.get_string("dashboard:quiztitle","local_assessfreq",{quiz:c.name,course:c.courseshortname}).then(function(a){document.title=a}).catch(function(){d.exception(new Error("Failed to load string: dashboard:quiztitle"))});g.render("local_assessfreq/quiz-summary-card-content",c).done(function(b){k.classList.add("hide");var c=document.getElementById("local-assessfreq-quiz-summary-card-content");g.replaceNodeContents(c,b,"");a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){d.exception(new Error("Failed to load quiz summary template."))});h.classList.remove("hide");i.classList.remove("hide");l.classList.remove("hide");n.classList.remove("hide");u();D();t();o.addEventListener("keyup",y);o.addEventListener("paste",y);p.addEventListener("click",z);q.addEventListener("click",A);a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){d.exception(new Error("Failed to get quiz data"))})},F=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"==b.closest("button").id){t(!0);E(m)}else if("a"===b.tagName.toLowerCase()){var c=document.getElementById("local-assessfreq-period-container"),d=c.getElementsByClassName("dropdown-toggle")[0];d.textContent=b.innerHTML;for(var e=c.getElementsByClassName("active"),f=0;f<e.length;f++){e[f].classList.remove("active")}b.classList.add("active");n=b.dataset.period;t(!0);q("local_assessfreq_quiz_refresh_preference",n)}},G=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({quiz:m,call:b})};h.zoomGraph(a,c,"get_quiz_chart")},H=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);i.displayModalForm(m,b)};j.init=function(a,c){l=a;b.init(a,E);h.init(a);i.init(a,E);e.get_string("loadingquiztitle","local_assessfreq").then(function(a){k=a}).catch(function(){d.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<c){m=c;E(c)}});r("local_assessfreq_quiz_refresh_preference").then(function(a){n=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){d.exception(new Error("Failed to get use preference: refresh"))});var f=document.getElementById("local-assessfreq-period-container");f.addEventListener("click",F);var g=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");g.addEventListener("click",G);var j=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");j.addEventListener("click",G)};return j});
//# sourceMappingURL=dashboard_quiz.min.js.map
