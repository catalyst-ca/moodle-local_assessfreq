function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_assessfreq/dashboard_quiz",["exports","core/ajax","core/notification","core/str","core/templates","local_assessfreq/chart_data","local_assessfreq/form_modal","local_assessfreq/override_modal","local_assessfreq/table_handler","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=n(b);c=n(c);d=m(d);e=n(e);f=m(f);g=m(g);h=n(h);i=m(i);j=m(j);k=m(k);function l(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;l=function(){return a};return a}function m(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=l();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function n(a){return a&&a.__esModule?a:{default:a}}var o="",p,q=0,r=60,s,t=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],u=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,b=document.getElementById("local-assessfreq-period-progress");if(!0===a){clearInterval(s);s=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(s){return}s=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/r;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(s);s=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);v(q);u()}},1e3)},v=function(a){q=a;var g=document.getElementById("local-assessfreq-quiz-title");g.innerHTML=o;b.default.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:a}}])[0].then(function(a){var b=JSON.parse(a),h=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),j=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),k=document.getElementById("local-assessfreq-quiz-summary-card"),l=k.getElementsByClassName("overlay-icon-container")[0],m=document.getElementById("local-assessfreq-quiz-table"),n=document.getElementById("local-assessfreq-period-container"),o=document.getElementById("local-assessfreq-quiz-student-table-search"),p=document.getElementById("local-assessfreq-quiz-student-table-search-reset"),r=document.getElementById("local-assessfreq-quiz-student-table-rows"),s=document.createElement("a");s.href=b.url;s.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";g.innerHTML=b.name+"&nbsp;";g.appendChild(s);var t=new URL(window.location.href),v=t.origin+t.pathname+"?id="+q;history.pushState({},"",v);d.get_string("dashboard:quiztitle","local_assessfreq",{quiz:b.name,course:b.courseshortname}).then(function(a){document.title=a}).catch(function(){c.default.exception(new Error("Failed to load string: dashboard:quiztitle"))});e.default.render("local_assessfreq/quiz-summary-card-content",b).done(function(a){l.classList.add("hide");var b=document.getElementById("local-assessfreq-quiz-summary-card-content");e.default.replaceNodeContents(b,a,"")}).fail(function(){c.default.exception(new Error("Failed to load quiz summary template."))});h.classList.remove("hide");j.classList.remove("hide");m.classList.remove("hide");n.classList.remove("hide");f.getCardCharts(q);i.getTable(q);u();o.addEventListener("keyup",i.tableSearch);o.addEventListener("paste",i.tableSearch);p.addEventListener("click",i.tableSearchReset);r.addEventListener("click",i.tableSearchRowSet)}).fail(function(){c.default.exception(new Error("Failed to get quiz data"))})},w=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"===b.closest("button").id){u(!0);v(q)}else if("a"===b.tagName.toLowerCase()){r=b.dataset.period;u(!0);j.setUserPreference("local_assessfreq_quiz_refresh_preference",r)}},x=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({quiz:q,call:b})};k.zoomGraph(a,c,"get_quiz_chart")},y=function(a,b){p=a;g.init(a,v);k.init(a);h.default.init(a,v);i.init(q,p,"local-assessfreq-quiz-student-table","local-assessfreq-quiz-table","get_student_table","local_assessfreq_quiz_table_rows_preference","local-assessfreq-quiz-student-table-search","local_assessfreq_student_table","local_assessfreq_set_table_preference");f.init(t,a,"get_quiz_chart","local_assessfreq/chart");d.get_string("loadingquiztitle","local_assessfreq").then(function(a){o=a}).catch(function(){c.default.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<b){q=b;v(b)}});j.getUserPreference("local_assessfreq_quiz_refresh_preference").then(function(a){r=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){c.default.exception(new Error("Failed to get use preference: refresh"))});var e=document.getElementById("local-assessfreq-period-container");e.addEventListener("click",w);var l=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");l.addEventListener("click",x);var m=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");m.addEventListener("click",x)};a.init=y});
//# sourceMappingURL=dashboard_quiz.min.js.map
