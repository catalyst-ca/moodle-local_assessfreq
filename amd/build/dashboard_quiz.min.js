define ("local_assessfreq/dashboard_quiz",["jquery","core/ajax","core/notification","core/str","core/templates","local_assessfreq/chart_data","local_assessfreq/form_modal","local_assessfreq/override_modal","local_assessfreq/table_handler","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g,h,i,j,k){var l={},m="",n,o=0,p=60,q,r=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],s=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,b=document.getElementById("local-assessfreq-period-progress");if(!0===a){clearInterval(q);q=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(q){return}q=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/p;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(q);q=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);t(o);s()}},1e3)},t=function(g){o=g;var h=document.getElementById("local-assessfreq-quiz-title");h.innerHTML=m;b.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:g}}])[0].then(function(b){var g=JSON.parse(b),j=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),k=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),l=document.getElementById("local-assessfreq-quiz-summary-card"),m=l.getElementsByClassName("overlay-icon-container")[0],n=document.getElementById("local-assessfreq-quiz-table"),p=document.getElementById("local-assessfreq-period-container"),q=document.getElementById("local-assessfreq-quiz-student-table-search"),r=document.getElementById("local-assessfreq-quiz-student-table-search-reset"),t=document.getElementById("local-assessfreq-quiz-student-table-rows"),u=document.createElement("a");u.href=g.url;u.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";h.innerHTML=g.name+"&nbsp;";h.appendChild(u);var v=new URL(window.location.href),w=v.origin+v.pathname+"?id="+o;history.pushState({},"",w);d.get_string("dashboard:quiztitle","local_assessfreq",{quiz:g.name,course:g.courseshortname}).then(function(a){document.title=a}).catch(function(){c.exception(new Error("Failed to load string: dashboard:quiztitle"))});e.render("local_assessfreq/quiz-summary-card-content",g).done(function(b){m.classList.add("hide");var c=document.getElementById("local-assessfreq-quiz-summary-card-content");e.replaceNodeContents(c,b,"");a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){c.exception(new Error("Failed to load quiz summary template."))});j.classList.remove("hide");k.classList.remove("hide");n.classList.remove("hide");p.classList.remove("hide");f.getCardCharts(o);i.getTable(o);s();q.addEventListener("keyup",i.tableSearch);q.addEventListener("paste",i.tableSearch);r.addEventListener("click",i.tableSearchReset);t.addEventListener("click",i.tableSearchRowSet);a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){c.exception(new Error("Failed to get quiz data"))})},u=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"===b.closest("button").id){s(!0);t(o)}else if("a"===b.tagName.toLowerCase()){var c=document.getElementById("local-assessfreq-period-container"),d=c.getElementsByClassName("dropdown-toggle")[0];d.textContent=b.innerHTML;for(var e=c.getElementsByClassName("active"),f=0;f<e.length;f++){e[f].classList.remove("active")}b.classList.add("active");p=b.dataset.period;s(!0);j.setUserPreference("local_assessfreq_quiz_refresh_preference",p)}},v=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({quiz:o,call:b})};k.zoomGraph(a,c,"get_quiz_chart")};l.init=function(a,b){n=a;g.init(a,t);k.init(a);h.init(a,t);i.init(o,n,"local-assessfreq-quiz-student-table","local-assessfreq-quiz-table","get_student_table","local_assessfreq_quiz_table_rows_preference","local-assessfreq-quiz-student-table-search","local_assessfreq_student_table","local_assessfreq_set_table_preference","local-assessfreq-quiz-student-table-rows-filter");f.init(r,a,"get_quiz_chart","local_assessfreq/chart");d.get_string("loadingquiztitle","local_assessfreq").then(function(a){m=a}).catch(function(){c.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<b){o=b;t(b)}});j.getUserPreference("local_assessfreq_quiz_refresh_preference").then(function(a){p=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){c.exception(new Error("Failed to get use preference: refresh"))});var e=document.getElementById("local-assessfreq-period-container");e.addEventListener("click",u);var l=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");l.addEventListener("click",v);var q=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");q.addEventListener("click",v)};return l});
//# sourceMappingURL=dashboard_quiz.min.js.map
