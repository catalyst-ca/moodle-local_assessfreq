define ("local_assessfreq/dashboard_quiz",["local_assessfreq/form_modal","core/ajax","core/notification","core/str","core/fragment","core/templates","local_assessfreq/zoom_modal","local_assessfreq/override_modal"],function(a,b,c,d,e,f,g,h){var i={},j="",k,l=0,m=60,n,o=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],p=function(a,c){return b.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:a,value:c}]}}])[0]},q=function(a){return b.call([{methodname:"core_user_get_user_preferences",args:{name:a}}])[0]},r=function(a){var b=document.getElementById("local-assessfreq-period-progress");if(!0==a){clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(n){return}n=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/m;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);B(l);r()}},1e3)},s=function(){o.forEach(function(a){var b=document.getElementById(a.cardId),g=b.getElementsByClassName("overlay-icon-container")[0],h=b.getElementsByClassName("chart-body")[0],i={data:JSON.stringify({quiz:l,call:a.call})};g.classList.remove("hide");e.loadFragment("local_assessfreq","get_quiz_chart",k,i).done(function(b){var e=JSON.parse(b);if(!0==e.hasdata){var i={withtable:!0,chartdata:JSON.stringify(e.chart),aspect:a.aspect};f.render("local_assessfreq/chart",i).done(function(a,b){g.classList.add("hide");f.replaceNodeContents(h,a,b)}).fail(function(){c.exception(new Error("Failed to load chart template."))})}else{d.get_string("nodata","local_assessfreq").then(function(a){var b=document.createElement("h3");b.innerHTML=a;h.innerHTML=b.outerHTML;g.classList.add("hide")}).catch(function(){c.exception(new Error("Failed to load string: nodata"))})}}).fail(function(){c.exception(new Error("Failed to load card."))})})},t=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){A()})},u=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=document.getElementById("local-assessfreq-quiz-table"),f=e.querySelectorAll("a"),g,h,j,k;if(-1!==d.search.indexOf("thide")){g="hide";h=d.searchParams.get("thide")}else{g="show";h=d.searchParams.get("tshow")}for(var l=0,i;l<f.length;l++){i=new URL(f[l].href);if(-1!==i.search.indexOf("thide")){j="hide";k=i.searchParams.get("thide")}else{j="show";k=i.searchParams.get("tshow")}if("show"===j){c[k]=1}}c[h]="hide"===g?1:0;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){A()})},v=function(a){a.preventDefault();b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){A()})},w=function(a){if(2<a.target.value.length){A(a.target.value)}if(0==a.target.value.length){A()}},x=function(){var a=document.getElementById("local-assessfreq-quiz-student-table-search");a.value="";a.focus();A()},y=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;p("local_assessfreq_quiz_table_rows_preference",b).then(function(){A()}).fail(function(){c.exception(new Error("Failed to update user preference: rows"))})}},z=function(){for(var a=document.getElementById("local-assessfreq-quiz-table"),b=a.querySelectorAll("a"),c=a.getElementsByClassName("resettable"),d=a.getElementsByClassName("action-icon override"),e=a.getElementsByClassName("action-icon disabled"),f=0,g;f<b.length;f++){g=new URL(b[f].href);if(-1!==g.search.indexOf("thide")||-1!==g.search.indexOf("tshow")){b[f].addEventListener("click",u)}else if(-1!==g.search.indexOf("tsort")){b[f].addEventListener("click",t)}}if(0<c.length){c[0].addEventListener("click",v)}for(var h=0;h<d.length;h++){d[h].addEventListener("click",E)}for(var j=0;j<e.length;j++){e[j].addEventListener("click",function(a){a.preventDefault()})}},A=function(a){if("undefined"==typeof a){a=""}var b=document.getElementById("local-assessfreq-quiz-table"),d=b.getElementsByClassName("overlay-icon-container")[0],f=b.getElementsByClassName("table-body")[0],g={data:JSON.stringify({quiz:l,search:a})};d.classList.remove("hide");e.loadFragment("local_assessfreq","get_student_table",k,g).done(function(a){f.innerHTML=a;d.classList.add("hide");z()}).fail(function(){c.exception(new Error("Failed to update table."))})},B=function(a){l=a;var d=document.getElementById("local-assessfreq-quiz-title");d.innerHTML=j;b.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:a}}])[0].then(function(a){var b=JSON.parse(a),c=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),e=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),f=document.getElementById("local-assessfreq-quiz-summary-card"),g=f.getElementsByClassName("overlay-icon-container")[0],h=document.getElementById("local-assessfreq-quiz-table"),i=document.getElementById("local-assessfreq-period-container"),j=document.getElementById("local-assessfreq-quiz-student-table-search"),k=document.getElementById("local-assessfreq-quiz-student-table-search-reset"),m=document.getElementById("local-assessfreq-quiz-student-table-rows"),n=document.createElement("a");n.href=b.url;n.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";d.innerHTML=b.name+"&nbsp;";d.appendChild(n);var o=new URL(window.location.href),p=o.origin+o.pathname+"?id="+l;history.pushState({},"",p);document.getElementById("quiz-time-open").innerHTML=b.timeopen;document.getElementById("quiz-time-close").innerHTML=b.timeclose;document.getElementById("quiz-time-limit").innerHTML=b.timelimit;document.getElementById("quiz-time-earlyopen").innerHTML=b.earlyopen;document.getElementById("quiz-time-lateclose").innerHTML=b.lateclose;document.getElementById("quiz-participants").innerHTML=b.participants;document.getElementById("quiz-participants-override").innerHTML=b.overrideparticipants;document.getElementById("quiz-question-number").innerHTML=b.questioncount;document.getElementById("quiz-question-types").innerHTML=b.typecount;c.classList.remove("hide");e.classList.remove("hide");h.classList.remove("hide");i.classList.remove("hide");g.classList.add("hide");s();A();r();j.addEventListener("keyup",w);j.addEventListener("paste",w);k.addEventListener("click",x);m.addEventListener("click",y)}).fail(function(){c.exception(new Error("Failed to get quiz data"))})},C=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"==b.closest("button").id){r(!0);B(l)}else if("a"===b.tagName.toLowerCase()){m=b.dataset.period;r(!0);p("local_assessfreq_quiz_refresh_preference",m)}},D=function(a){var b=a.target.parentElement.dataset.call,c={data:JSON.stringify({quiz:l,call:b})};g.zoomGraph(a,c,"get_quiz_chart")},E=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);h.displayModalForm(l,b)};i.init=function(b,e){k=b;a.init(b,B);g.init(b);h.init(b,B);d.get_string("loadingquiztitle","local_assessfreq").then(function(a){j=a}).catch(function(){c.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<e){l=e;B(e)}});q("local_assessfreq_quiz_refresh_preference").then(function(a){window.console.log(a.preferences[0].value);m=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){c.exception(new Error("Failed to get use preference: refresh"))});var f=document.getElementById("local-assessfreq-period-container");f.addEventListener("click",C);var i=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");i.addEventListener("click",D);var n=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");n.addEventListener("click",D)};return i});
//# sourceMappingURL=dashboard_quiz.min.js.map
