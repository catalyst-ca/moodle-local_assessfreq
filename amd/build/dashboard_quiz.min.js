define ("local_assessfreq/dashboard_quiz",["core/ajax","core/fragment","core/templates","core/notification","local_assessfreq/calendar","core/str","core/modal_factory","local_assessfreq/modal_large","local_assessfreq/dayview"],function(a,b,c,d,e,f,g,h,i){var j={},k,l,m,n,o,p="",q="",r,s=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}],t=function(b,c){a.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:b,value:c}]}}])[0].fail(function(){d.exception(new Error("Failed to update user preference"))})},u=function(){s.forEach(function(a){var e=document.getElementById(a.cardId),f=e.getElementsByClassName("overlay-icon-container")[0],g=e.getElementsByClassName("chart-body")[0],h={data:JSON.stringify({year:l,call:a.call})};f.classList.remove("hide");b.loadFragment("local_assessfreq","get_chart",k,h).done(function(a){c.render("core/chart",{withtable:!0,chartdata:a}).done(function(a,b){f.classList.add("hide");c.replaceNodeContents(g,a,b)}).fail(function(){d.exception(new Error("Failed to load chart template."))})}).fail(function(){d.exception(new Error("Failed to load card year filter"))})})},v=function(a){var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=l){l=b.dataset.year;t("local_assessfreq_overview_year_preference",l);var c=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=l;u()}},w=function(){clearTimeout(o);o=setTimeout(A(),750)},x=function(a){var b=a.target;if("td"===b.tagName.toLowerCase()&&"true"==b.dataset.event){i.display(b.dataset.date)}},y=function(){var a=JSON.parse(q),b=parseInt(a.year),c=a.metric,f=a.modules,g=document.getElementById("local-assessfreq-report-heatmap"),h=g.getElementsByClassName("overlay-icon-container")[0];h.classList.remove("hide");e.generate(b,0,11,c,f).then(function(a){var b=document.getElementById("local-assessfreq-report-heatmap-months");b.innerHTML=a.innerHTML;b.addEventListener("click",x);h.classList.add("hide")}).catch(function(){d.exception(new Error("Failed to calendar."))})},z=function(a){var b=a.year,c=a.metric,d=a.modules,e=document.getElementById("local-assessfreq-heatmap-form"),f=e.elements,g=[];if(0==d.length){d=["all"]}for(var l=0;l<f.length;l++){if(f[l]===void 0){continue}if("hidden"===f[l].type&&"year"===f[l].name){f[l].value=b;continue}if("hidden"===f[l].type&&"metric"===f[l].name){f[l].value=c;continue}if("hidden"===f[l].type&&f[l].name.startsWith("modules")){g.push(f[l]);continue}}for(var h=0,j=g,k;h<j.length;h++){k=j[h];k.remove()}for(var i=0,m;i<d.length;i++){m=document.createElement("input");m.type="hidden";m.name="modules["+d[i]+"]";m.value=d[i];e.appendChild(m)}},A=function(){for(var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],d=0;d<b.length;d++){if(b[d].classList.contains("active")){var g=b[d].dataset.module;c.push(g)}}if(p!==JSON.stringify(c)){p=JSON.stringify(c);t("local_assessfreq_heatmap_modules_preference",p)}var e={year:m,metric:n,modules:c},f=JSON.stringify(e);if(f!==q){q=f;y();z(e)}},B=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=m){m=b.dataset.year;t("local_assessfreq_heatmap_year_preference",m);var c=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=m;w()}},C=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.metric!=n){n=b.dataset.metric;t("local_assessfreq_heatmap_metric_preference",n);w()}},D=function(a){for(var b=a.getElementsByTagName("a"),c=b[0],d=0,e;d<b.length;d++){e=b[d].dataset.module;if("all"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();for(var c=0;c<b.length;c++){b[c].classList.remove("active")}w()})}else if("close"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");w()})}else{b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");w()})}}},E=function(a){var e=a.target.parentElement.dataset.title,f=a.target.parentElement.dataset.call,g={data:JSON.stringify({year:l,call:f})};b.loadFragment("local_assessfreq","get_chart",k,g).done(function(a){r.setTitle(e);r.setBody(c.render("core/chart",{withtable:!0,chartdata:a}));r.show()}).fail(function(){d.exception(new Error("Failed to load card year filter"))})},F=function(){return new Promise(function(a,b){f.get_string("loading","core").then(function(b){g.create({type:h.TYPE,title:b,body:"<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>"}).done(function(b){r=b;a()})}).catch(function(){b(new Error("Failed to load string: loading"))})})};j.init=function(a){k=a;var b=document.getElementById("local-assessfreq-cards-year");l=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",v);var c=document.getElementById("local-assessfreq-heatmap-year");m=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",B);var d=document.getElementById("local-assessfreq-heatmap-metrics");n=d.getElementsByClassName("active")[0].dataset.metric;d.addEventListener("click",C);var e=document.getElementById("local-assessfreq-heatmap-modules");D(e);var f=document.getElementById("local-assessfreq-assess-due-month-zoom");f.addEventListener("click",E);var g=document.getElementById("local-assessfreq-assess-by-activity-zoom");g.addEventListener("click",E);var h=document.getElementById("local-assessfreq-assess-due-month-student-zoom");h.addEventListener("click",E);F();i.init();u();A()};return j});
//# sourceMappingURL=dashboard_quiz.min.js.map
