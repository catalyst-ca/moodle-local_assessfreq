define ("local_assessfreq/dashboard_quiz",["local_assessfreq/form_modal","core/ajax","core/notification","core/str","core/fragment","core/templates","core/modal_factory","local_assessfreq/modal_large"],function(a,b,c,d,e,f,g,h){var i={},j="",k,l=0,m=60,n,o,p=[{cardId:"local-assessfreq-quiz-summary-graph",call:"participant_summary",aspect:!0},{cardId:"local-assessfreq-quiz-summary-trend",call:"participant_trend",aspect:!1}],q=function(a){var b=document.getElementById("local-assessfreq-period-progress");if(!0==a){clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(n){return}n=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/m;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);x(l);q()}},1e3)},r=function(){p.forEach(function(a){var b=document.getElementById(a.cardId),d=b.getElementsByClassName("overlay-icon-container")[0],g=b.getElementsByClassName("chart-body")[0],h={data:JSON.stringify({quiz:l,call:a.call})};d.classList.remove("hide");e.loadFragment("local_assessfreq","get_quiz_chart",k,h).done(function(b){var e={withtable:!0,chartdata:b,aspect:a.aspect};f.render("local_assessfreq/chart",e).done(function(a,b){d.classList.add("hide");f.replaceNodeContents(g,a,b)}).fail(function(){c.exception(new Error("Failed to load chart template."))})}).fail(function(){c.exception(new Error("Failed to load card."))})})},s=function(a){a.preventDefault();var c={},d=a.target.dataset.sortby,e=a.target.dataset.sortorder;if(""===e){e="4"}c[d]=e;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){w()})},t=function(a){a.preventDefault();for(var c={},d=document.getElementById("local-assessfreq-quiz-table"),e=a.target.closest("a").dataset.action,f=a.target.closest("a").dataset.column,g=d.querySelectorAll("[data-action]"),h=0;h<g.length;h++){var j=g[h].dataset.action,k=g[h].dataset.column;c[k]="hide"===j?0:1}c[f]="hide"===e?1:0;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){w()})},u=function(a){a.preventDefault();b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){w()})},v=function(){for(var a=document.getElementById("local-assessfreq-quiz-table"),b=a.querySelectorAll("[data-sortable=\"1\"]"),c=a.querySelectorAll("[data-action]"),d=a.getElementsByClassName("resettable")[0],e=0;e<b.length;e++){b[e].addEventListener("click",s)}for(var f=0;f<c.length;f++){c[f].addEventListener("click",t)}d.addEventListener("click",u)},w=function(){var a=document.getElementById("local-assessfreq-quiz-table"),b=a.getElementsByClassName("overlay-icon-container")[0],d=a.getElementsByClassName("table-body")[0],f={data:JSON.stringify({quiz:l})};b.classList.remove("hide");e.loadFragment("local_assessfreq","get_student_table",k,f).done(function(a){d.innerHTML=a;b.classList.add("hide");v()}).fail(function(){c.exception(new Error("Failed to update table."))})},x=function(a){l=a;var d=document.getElementById("local-assessfreq-quiz-title");d.innerHTML=j;b.call([{methodname:"local_assessfreq_get_quiz_data",args:{quizid:a}}])[0].then(function(a){var b=JSON.parse(a),c=document.getElementById("local-assessfreq-quiz-dashboard-cards-deck"),e=document.getElementById("local-assessfreq-quiz-dashboard-participant-trend-deck"),f=document.getElementById("local-assessfreq-quiz-summary-card"),g=f.getElementsByClassName("overlay-icon-container")[0],h=document.getElementById("local-assessfreq-quiz-table"),i=document.getElementById("local-assessfreq-period-container"),j=document.createElement("a");j.href=b.url;j.innerHTML="<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>";d.innerHTML=b.name+"&nbsp;";d.appendChild(j);var k=new URL(window.location.href),m=k.origin+k.pathname+"?id="+l;history.pushState({},"",m);document.getElementById("quiz-time-open").innerHTML=b.timeopen;document.getElementById("quiz-time-close").innerHTML=b.timeclose;document.getElementById("quiz-time-limit").innerHTML=b.timelimit;document.getElementById("quiz-time-earlyopen").innerHTML=b.earlyopen;document.getElementById("quiz-time-lateclose").innerHTML=b.lateclose;document.getElementById("quiz-participants").innerHTML=b.participants;document.getElementById("quiz-participants-override").innerHTML=b.overrideparticipants;document.getElementById("quiz-question-number").innerHTML=b.questioncount;document.getElementById("quiz-question-types").innerHTML=b.typecount;c.classList.remove("hide");e.classList.remove("hide");h.classList.remove("hide");i.classList.remove("hide");g.classList.add("hide");r();w();q()}).fail(function(){c.exception(new Error("Failed to get quiz data"))})},y=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"==b.closest("button").id){q(!0);x(l)}else if("a"===b.tagName.toLowerCase()){m=b.dataset.period;q(!0)}},z=function(a){var b=a.target.parentElement.dataset.title,d=a.target.parentElement.dataset.call,g={data:JSON.stringify({quiz:l,call:d})};e.loadFragment("local_assessfreq","get_quiz_chart",k,g).done(function(a){o.setTitle(b);o.setBody(f.render("local_assessfreq/chart",{withtable:!1,chartdata:a,aspect:!1}));o.show()}).fail(function(){c.exception(new Error("Failed to load zoomed graph"))})},A=function(){return new Promise(function(a,b){d.get_string("loading","core").then(function(b){g.create({type:h.TYPE,title:b,body:"<p class=\"text-center\"><i class=\"fa fa-circle-o-notch fa-spin fa-3x fa-fw\"></i></p>"}).done(function(b){o=b;a()})}).catch(function(){b(new Error("Failed to load string: loading"))})})};i.init=function(b,e){k=b;a.init(b,x);d.get_string("loadingquiztitle","local_assessfreq").then(function(a){j=a}).catch(function(){c.exception(new Error("Failed to load string: loadingquiz"))}).then(function(){if(0<e){l=e;x(e)}});var f=document.getElementById("local-assessfreq-period-container");f.addEventListener("click",y);var g=document.getElementById("local-assessfreq-quiz-summary-graph-zoom");g.addEventListener("click",z);var h=document.getElementById("local-assessfreq-quiz-summary-trend-zoom");h.addEventListener("click",z);A()};return i});
//# sourceMappingURL=dashboard_quiz.min.js.map
