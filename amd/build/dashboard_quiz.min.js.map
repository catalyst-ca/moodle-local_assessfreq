{"version":3,"sources":["../src/dashboard_quiz.js"],"names":["define","FormModal","Ajax","Notification","Str","Fragment","Templates","DashboardQuiz","selectQuizStr","contextid","quizId","counterid","cards","cardId","call","aspect","refreshCounter","window","console","log","setInterval","progressElement","document","getElementById","progressWidth","getAttribute","progressWidthAria","progressStep","setAttribute","clearInterval","getCardCharts","forEach","cardData","cardElement","spinner","getElementsByClassName","chartbody","params","JSON","stringify","classList","remove","loadFragment","done","response","context","render","html","js","add","replaceNodeContents","fail","exception","Error","tableSort","event","preventDefault","sortArray","targetSortBy","target","dataset","sortby","targetSortOrder","sortorder","methodname","args","tableid","preference","values","then","getStudentTable","tableHide","hideArray","tableElement","targetAction","closest","action","targetColumn","column","hideLinks","querySelectorAll","i","length","tableReset","tableEventListeners","sortLinks","resetlink","addEventListener","tableBody","innerHTML","processDashboard","quiz","titleElement","quizid","quizArray","parse","cardsElement","trendElement","summaryElement","summarySpinner","periodElement","name","currentdUrl","URL","location","href","newUrl","origin","pathname","history","pushState","timeopen","timeclose","timelimit","earlyopen","lateclose","participants","overrideparticipants","questioncount","typecount","init","get_string","str","catch","refreshElement"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['local_assessfreq/form_modal', 'core/ajax', 'core/notification', 'core/str', 'core/fragment', 'core/templates'],\nfunction(FormModal, Ajax, Notification, Str, Fragment, Templates) {\n\n    /**\n     * Module level variables.\n     */\n    var DashboardQuiz = {};\n    var selectQuizStr = '';\n    var contextid;\n    var quizId = 0;\n    var refreshPeriod = 60;\n    var counterid;\n\n    const cards = [\n        {cardId: 'local-assessfreq-quiz-summary-graph', call: 'participant_summary', aspect: true},\n        {cardId: 'local-assessfreq-quiz-summary-trend', call: 'participant_trend', aspect: false}\n    ];\n\n    /**\n     *\n     */\n    const refreshCounter = function() {\n        window.console.log(counterid);\n        counterid = setInterval(() => {\n            let progressElement = document.getElementById('local-assessfreq-period-progress');\n            let progressWidth = progressElement.getAttribute('width');\n            let progressWidthAria = progressElement.getAttribute('aria-valuenow');\n            const progressStep = 100 / refreshPeriod;\n\n            if ((progressWidth - progressStep) > 0) {\n                progressElement.setAttribute('width', (progressWidth - progressStep));\n                progressElement.setAttribute('aria-valuenow', (progressWidthAria - progressStep));\n            } else {\n                clearInterval(counterid);\n                progressElement.setAttribute('width', 100);\n                progressElement.setAttribute('aria-valuenow', 100);\n                refreshCounter();\n            }\n        }, (1000));\n    };\n\n    /**\n     * For each of the cards on the dashbaord get their corresponding chart data.\n     * Data is based on the year variable from the corresponding dropdown.\n     * Chart data is loaded via ajax.\n     *\n     */\n    const getCardCharts = function() {\n        cards.forEach((cardData) => {\n            let cardElement = document.getElementById(cardData.cardId);\n            let spinner = cardElement.getElementsByClassName('overlay-icon-container')[0];\n            let chartbody = cardElement.getElementsByClassName('chart-body')[0];\n            let params = {'data': JSON.stringify({'quiz' : quizId, 'call': cardData.call})};\n\n            spinner.classList.remove('hide'); // Show sinner if not already shown.\n            Fragment.loadFragment('local_assessfreq', 'get_quiz_chart', contextid, params)\n            .done((response) => {\n                var context = { 'withtable' : true, 'chartdata' : response, 'aspect' :  cardData.aspect};\n                Templates.render('local_assessfreq/chart', context).done((html, js) => {\n                    spinner.classList.add('hide'); // Hide spinner if not already hidden.\n                    // Load card body.\n                    Templates.replaceNodeContents(chartbody, html, js);\n                }).fail(() => {\n                    Notification.exception(new Error('Failed to load chart template.'));\n                    return;\n                });\n                return;\n            }).fail(() => {\n                Notification.exception(new Error('Failed to load card.'));\n                return;\n            });\n        });\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     */\n    const tableSort = function(event) {\n        event.preventDefault();\n\n        let sortArray = {};\n        const targetSortBy = event.target.dataset.sortby;\n        let targetSortOrder = event.target.dataset.sortorder;\n\n        // We want to flip the clicked column.\n        if (targetSortOrder === '') {\n            targetSortOrder = \"4\";\n        }\n\n        sortArray[targetSortBy] = targetSortOrder;\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'sortby',\n                values: JSON.stringify(sortArray)\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     */\n    const tableHide = function(event) {\n        event.preventDefault();\n\n        let hideArray = {};\n        const tableElement = document.getElementById('local-assessfreq-quiz-table');\n        const targetAction = event.target.closest('a').dataset.action;\n        const targetColumn = event.target.closest('a').dataset.column;\n\n        const hideLinks = tableElement.querySelectorAll('[data-action]');\n        for (let i = 0; i < hideLinks.length; i++) {\n            let action = hideLinks[i].dataset.action;\n            let column = hideLinks[i].dataset.column;\n\n            hideArray[column] = (action === 'hide') ? 0 : 1;\n        }\n\n        hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'collapse',\n                values: JSON.stringify(hideArray)\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the reset click event from the student table.\n     */\n    const tableReset = function(event) {\n        event.preventDefault();\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'reset',\n                values: JSON.stringify({})\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Re-add event listeners when the student table is updated.\n     */\n    const tableEventListeners = function() {\n        const tableElement = document.getElementById('local-assessfreq-quiz-table');\n        const sortLinks = tableElement.querySelectorAll(`[data-sortable=\"1\"]`);\n        const hideLinks = tableElement.querySelectorAll('[data-action]');\n        const resetlink = tableElement.getElementsByClassName('resettable')[0];\n\n        for (let i = 0; i < sortLinks.length; i++) {\n            sortLinks[i].addEventListener('click', tableSort);\n        }\n\n        for (let i = 0; i < hideLinks.length; i++) {\n            hideLinks[i].addEventListener('click', tableHide);\n        }\n\n        resetlink.addEventListener('click', tableReset);\n    };\n\n    /**\n     * Display the table that contains all the students in the exam as well as their attempts.\n     */\n    const getStudentTable = function() {\n        let tableElement = document.getElementById('local-assessfreq-quiz-table');\n        let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n        let tableBody = tableElement.getElementsByClassName('table-body')[0];\n        let params = {'data': JSON.stringify({'quiz' : quizId})};\n\n        spinner.classList.remove('hide'); // Show spinner if not already shown.\n        Fragment.loadFragment('local_assessfreq', 'get_student_table', contextid, params)\n        .done((response) => {\n            tableBody.innerHTML = response;\n            spinner.classList.add('hide');\n            tableEventListeners(); // Re-add table event listeners.\n\n        }).fail(() => {\n            Notification.exception(new Error('Failed to update table.'));\n        });\n    };\n\n    /**\n     * Callback function that is called when a quiz is selected from the form.\n     * Starts the processing of the dashbaord.\n     */\n    const processDashboard = function(quiz) {\n        quizId = quiz;\n        let titleElement = document.getElementById('local-assessfreq-quiz-title');\n        titleElement.innerHTML = selectQuizStr;\n        // Get quiz data.\n        Ajax.call([{\n            methodname: 'local_assessfreq_get_quiz_data',\n            args: {\n                quizid: quiz\n            },\n        }])[0].then((response) => {\n\n            let quizArray = JSON.parse(response);\n            let cardsElement = document.getElementById('local-assessfreq-quiz-dashboard-cards-deck');\n            let trendElement = document.getElementById('local-assessfreq-quiz-dashboard-participant-trend-deck');\n            let summaryElement = document.getElementById('local-assessfreq-quiz-summary-card');\n            let summarySpinner = summaryElement.getElementsByClassName('overlay-icon-container')[0];\n            let tableElement = document.getElementById('local-assessfreq-quiz-table');\n            let periodElement = document.getElementById('local-assessfreq-period-container');\n\n            titleElement.innerHTML = quizArray.name;\n\n            // Update page URL with quiz ID, without reloading page so that page navigation and bookmarking works.\n            const currentdUrl = new URL(window.location.href);\n            const newUrl = currentdUrl.origin + currentdUrl.pathname + '?id=' + quizId;\n            history.pushState({}, '', newUrl);\n\n            // Populate quiz summary card with details.\n            document.getElementById('quiz-time-open').innerHTML = quizArray.timeopen;\n            document.getElementById('quiz-time-close').innerHTML = quizArray.timeclose;\n            document.getElementById('quiz-time-limit').innerHTML = quizArray.timelimit;\n            document.getElementById('quiz-time-earlyopen').innerHTML = quizArray.earlyopen;\n            document.getElementById('quiz-time-lateclose').innerHTML = quizArray.lateclose;\n            document.getElementById('quiz-participants').innerHTML = quizArray.participants;\n            document.getElementById('quiz-participants-override').innerHTML = quizArray.overrideparticipants;\n            document.getElementById('quiz-question-number').innerHTML = quizArray.questioncount;\n            document.getElementById('quiz-question-types').innerHTML = quizArray.typecount;\n\n            // Show the cards.\n            cardsElement.classList.remove('hide');\n            trendElement.classList.remove('hide');\n            tableElement.classList.remove('hide');\n            periodElement.classList.remove('hide');\n            summarySpinner.classList.add('hide');\n            getCardCharts();\n            getStudentTable();\n            refreshCounter();\n            // TODO: Cancel autorefresh of cards while quiz in changing.\n\n            return;\n        }).fail(() => {\n            Notification.exception(new Error('Failed to get quiz data'));\n        });\n    };\n\n    /**\n     * Initialise method for quiz dashboard rendering.\n     */\n    DashboardQuiz.init = function(context, quiz) {\n        contextid = context;\n        FormModal.init(context, processDashboard);\n\n        Str.get_string('loadingquiztitle', 'local_assessfreq').then((str) => {\n            selectQuizStr = str;\n        }).catch(() => {\n            Notification.exception(new Error('Failed to load string: loadingquiz'));\n        }).then(() => {\n            if (quiz > 0) {\n                quizId = quiz;\n                processDashboard(quiz);\n            }\n        });\n\n        // Event handling for refresh button.\n        let refreshElement = document.getElementById('local-assessfreq-refresh-quiz-dashboard');\n        refreshElement.addEventListener('click', () => {\n            processDashboard(quizId);\n        });\n    };\n\n    return DashboardQuiz;\n});\n"],"file":"dashboard_quiz.min.js"}