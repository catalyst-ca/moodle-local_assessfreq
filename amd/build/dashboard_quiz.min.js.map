{"version":3,"sources":["../src/dashboard_quiz.js"],"names":["define","$","FormModal","Ajax","Notification","Str","Fragment","Templates","ZoomModal","OverrideModal","DashboardQuiz","selectQuizStr","contextid","quizId","refreshPeriod","counterid","cards","cardId","call","aspect","setUserPreference","type","value","methodname","args","preferences","getUserPreference","name","debounceTable","debouncer","func","wait","timeout","later","clearTimeout","setTimeout","getStudentTable","refreshCounter","reset","progressElement","document","getElementById","clearInterval","setAttribute","setInterval","progressWidthAria","getAttribute","progressStep","processDashboard","getCardCharts","forEach","cardData","cardElement","spinner","getElementsByClassName","chartbody","params","JSON","stringify","classList","remove","loadFragment","done","response","resObj","parse","hasdata","context","chart","render","html","js","add","replaceNodeContents","fail","exception","Error","get_string","then","str","noDatastr","createElement","innerHTML","outerHTML","catch","tableSort","event","preventDefault","sortArray","linkUrl","URL","target","closest","href","targetSortBy","searchParams","get","targetSortOrder","tableid","preference","values","tableHide","hideArray","tableElement","links","querySelectorAll","targetAction","targetColumn","action","column","search","indexOf","i","hideLinkUrl","length","tableReset","tableSearch","key","ctrlKey","tableSearchReset","tableSearchInputElement","focus","tableSearchRowSet","tagName","toLowerCase","rows","dataset","metric","activeoptions","tableNav","page","tableEventListeners","tableCardElement","resetlink","overrideLinks","disabledLinks","tableNavElement","addEventListener","triggerOverrideModal","navElement","trim","tableBody","tooltip","quiz","titleElement","quizid","quizArray","cardsElement","trendElement","summaryElement","summarySpinner","periodElement","tableSearchResetElement","tableSearchRowsElement","quizLink","url","appendChild","currentdUrl","window","location","newUrl","origin","pathname","history","pushState","courseshortname","title","contentcontainer","refreshAction","element","id","refreshElement","actionButton","textContent","period","triggerZoomGraph","zoomGraph","userid","substring","displayModalForm","init","summaryZoom","trendZoom"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'local_assessfreq/form_modal', 'core/ajax', 'core/notification', 'core/str', 'core/fragment', 'core/templates',\n    'local_assessfreq/zoom_modal', 'local_assessfreq/override_modal'],\nfunction($, FormModal, Ajax, Notification, Str, Fragment, Templates, ZoomModal, OverrideModal) {\n\n    /**\n     * Module level variables.\n     */\n    var DashboardQuiz = {};\n    var selectQuizStr = '';\n    var contextid;\n    var quizId = 0;\n    var refreshPeriod = 60;\n    var counterid;\n\n    const cards = [\n        {cardId: 'local-assessfreq-quiz-summary-graph', call: 'participant_summary', aspect: true},\n        {cardId: 'local-assessfreq-quiz-summary-trend', call: 'participant_trend', aspect: false}\n    ];\n\n    /**\n     * Generic handler to persist user preferences.\n     *\n     * @param {string} type The name of the attribute you're updating\n     * @param {string} value The value of the attribute you're updating\n     * @return {object} jQuery promise\n     */\n    const setUserPreference = function(type, value) {\n        var request = {\n            methodname: 'core_user_update_user_preferences',\n            args: {\n                preferences: [{type: type, value: value}]\n            }\n        };\n\n        return Ajax.call([request])[0];\n    };\n\n    /**\n     * Generic handler to get user preference.\n     *\n     * @param {string} name The name of the attribute you're getting.\n     * @return {object} jQuery promise\n     */\n    const getUserPreference = function(name) {\n        var request = {\n            methodname: 'local_assessfreq_get_user_preferences',\n            args: {\n                'name': name\n            }\n        };\n\n        return Ajax.call([request])[0];\n    };\n\n    /**\n     * Quick and dirty debounce method for the settings.\n     * This stops the ajax method that updates the table from being updated\n     * while the user is still checking options.\n     *\n     */\n    const debouncer = function (func, wait) {\n        let timeout;\n\n        return function executedFunction(...args) {\n            const later = () => {\n                clearTimeout(timeout);\n                func(...args);\n            };\n\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n        };\n    };\n\n    const debounceTable = debouncer(() => {\n        getStudentTable();\n    }, 750);\n\n    /**\n     *\n     */\n    const refreshCounter = function(reset) {\n        let progressElement = document.getElementById('local-assessfreq-period-progress');\n\n        // Reset the current count process.\n        if (reset == true) {\n            clearInterval(counterid);\n            counterid = null;\n            progressElement.setAttribute('style', 'width: 100%');\n            progressElement.setAttribute('aria-valuenow', 100);\n        }\n\n        // Exit early if there is already a counter running.\n        if (counterid) {\n            return;\n        }\n\n        counterid = setInterval(() => {\n            let progressWidthAria = progressElement.getAttribute('aria-valuenow');\n            const progressStep = 100 / refreshPeriod;\n\n            if ((progressWidthAria - progressStep) > 0) {\n                progressElement.setAttribute('style', 'width: ' + (progressWidthAria - progressStep) + '%');\n                progressElement.setAttribute('aria-valuenow', (progressWidthAria - progressStep));\n            } else {\n                clearInterval(counterid);\n                counterid = null;\n                progressElement.setAttribute('style', 'width: 100%');\n                progressElement.setAttribute('aria-valuenow', 100);\n                processDashboard(quizId);\n                refreshCounter();\n            }\n        }, (1000));\n    };\n\n    /**\n     * For each of the cards on the dashboard get their corresponding chart data.\n     * Data is based on the year variable from the corresponding dropdown.\n     * Chart data is loaded via ajax.\n     *\n     */\n    const getCardCharts = function() {\n        cards.forEach((cardData) => {\n            let cardElement = document.getElementById(cardData.cardId);\n            let spinner = cardElement.getElementsByClassName('overlay-icon-container')[0];\n            let chartbody = cardElement.getElementsByClassName('chart-body')[0];\n            let params = {'data': JSON.stringify({'quiz' : quizId, 'call': cardData.call})};\n\n            spinner.classList.remove('hide'); // Show sinner if not already shown.\n            Fragment.loadFragment('local_assessfreq', 'get_quiz_chart', contextid, params)\n            .done((response) => {\n                let resObj = JSON.parse(response);\n                if (resObj.hasdata == true) {\n                    let context = { 'withtable' : true, 'chartdata' : JSON.stringify(resObj.chart), 'aspect' :  cardData.aspect};\n                    Templates.render('local_assessfreq/chart', context).done((html, js) => {\n                        spinner.classList.add('hide'); // Hide spinner if not already hidden.\n                        // Load card body.\n                        Templates.replaceNodeContents(chartbody, html, js);\n                    }).fail(() => {\n                        Notification.exception(new Error('Failed to load chart template.'));\n                        return;\n                    });\n                    return;\n                } else {\n                    Str.get_string('nodata', 'local_assessfreq').then((str) => {\n                        const noDatastr = document.createElement('h3');\n                        noDatastr.innerHTML = str;\n                        chartbody.innerHTML = noDatastr.outerHTML;\n                        spinner.classList.add('hide'); // Hide spinner if not already hidden.\n                        return;\n                    }).catch(() => {\n                        Notification.exception(new Error('Failed to load string: nodata'));\n                    });\n                }\n            }).fail(() => {\n                Notification.exception(new Error('Failed to load card.'));\n                return;\n            });\n        });\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     */\n    const tableSort = function(event) {\n        event.preventDefault();\n\n        let sortArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const targetSortBy = linkUrl.searchParams.get('tsort');\n        let targetSortOrder = linkUrl.searchParams.get('tdir');\n\n        // We want to flip the clicked column.\n        if (!targetSortOrder) {\n            targetSortOrder = \"4\";\n        }\n\n        sortArray[targetSortBy] = targetSortOrder;\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'sortby',\n                values: JSON.stringify(sortArray)\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the sort click events from the student table.\n     */\n    const tableHide = function(event) {\n        event.preventDefault();\n\n        let hideArray = {};\n        const linkUrl = new URL(event.target.closest('a').href);\n        const tableElement = document.getElementById('local-assessfreq-quiz-table');\n        const links = tableElement.querySelectorAll('a');\n        let targetAction;\n        let targetColumn;\n        let action;\n        let column;\n\n        if (linkUrl.search.indexOf('thide') !== -1) {\n            targetAction = 'hide';\n            targetColumn = linkUrl.searchParams.get('thide');\n        } else {\n            targetAction = 'show';\n            targetColumn = linkUrl.searchParams.get('tshow');\n        }\n\n        for (let i = 0; i < links.length; i++) {\n            let hideLinkUrl = new URL(links[i].href);\n            if (hideLinkUrl.search.indexOf('thide') !== -1) {\n                action = 'hide';\n                column = hideLinkUrl.searchParams.get('thide');\n            } else {\n                action = 'show';\n                column = hideLinkUrl.searchParams.get('tshow');\n            }\n\n            if (action === 'show') {\n                hideArray[column] = 1;\n            }\n\n        }\n\n        hideArray[targetColumn] = (targetAction === 'hide') ? 1 : 0; // We want to flip the clicked column.\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'collapse',\n                values: JSON.stringify(hideArray)\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the reset click event from the student table.\n     */\n    const tableReset = function(event) {\n        event.preventDefault();\n\n        // Set option via ajax.\n        Ajax.call([{\n            methodname: 'local_assessfreq_set_table_preference',\n            args: {\n                tableid: 'local_assessfreq_student_table',\n                preference: 'reset',\n                values: JSON.stringify({})\n            },\n        }])[0].then(() => {\n            getStudentTable(); // Reload the table.\n        });\n\n    };\n\n    /**\n     * Process the search events from the student table.\n     */\n    const tableSearch = function(event) {\n        if (event.key === 'Meta' || event.ctrlKey) {\n            return false;\n        }\n\n        if (event.target.value.length === 0 || event.target.value.length > 2) {\n            debounceTable();\n        }\n    };\n\n    /**\n     * Process the search reset click event from the student table.\n     */\n    const tableSearchReset = function() {\n        let tableSearchInputElement = document.getElementById('local-assessfreq-quiz-student-table-search');\n        tableSearchInputElement.value = '';\n        tableSearchInputElement.focus();\n        getStudentTable();\n    };\n\n    /**\n     * Process the row set event from the student table.\n     */\n    const tableSearchRowSet = function(event) {\n        event.preventDefault();\n        if (event.target.tagName.toLowerCase() === 'a') {\n            let rows = event.target.dataset.metric;\n            let activeoptions = document.getElementById('local-assessfreq-quiz-student-table-rows-filter')\n                .getElementsByClassName('active');\n\n            // Fix active classes.\n            for (var i = 0; i < activeoptions.length; i++) {\n                activeoptions[i].classList.remove('active');\n            }\n            event.target.classList.add('active');\n\n            setUserPreference('local_assessfreq_quiz_table_rows_preference', rows)\n            .then(() => {\n                getStudentTable(); // Reload the table.\n            })\n            .fail(() => {\n                Notification.exception(new Error('Failed to update user preference: rows'));\n            });\n        }\n    };\n\n    /**\n     * Process the nav event from the student table.\n     */\n    const tableNav = function(event) {\n        event.preventDefault();\n\n        const linkUrl = new URL(event.target.closest('a').href);\n        const page = linkUrl.searchParams.get('page');\n\n        if (page) {\n            getStudentTable(page);\n        }\n    };\n\n    /**\n     * Re-add event listeners when the student table is updated.\n     */\n    const tableEventListeners = function() {\n        const tableElement = document.getElementById('local-assessfreq-quiz-table');\n        const tableCardElement = document.getElementById('local-assessfreq-quiz-student-table');\n        const links = tableElement.querySelectorAll('a');\n        const resetlink = tableElement.getElementsByClassName('resettable');\n        const overrideLinks = tableElement.getElementsByClassName('action-icon override');\n        const disabledLinks = tableElement.getElementsByClassName('action-icon disabled');\n        const tableNavElement = tableCardElement.querySelectorAll('nav'); // There are two nav paging elements per table.\n\n        for (let i = 0; i < links.length; i++) {\n            let linkUrl = new URL(links[i].href);\n            if (linkUrl.search.indexOf('thide') !== -1 || linkUrl.search.indexOf('tshow') !== -1) {\n                links[i].addEventListener('click', tableHide);\n            } else if (linkUrl.search.indexOf('tsort') !== -1) {\n                links[i].addEventListener('click', tableSort);\n            }\n\n        }\n\n        if (resetlink.length > 0) {\n            resetlink[0].addEventListener('click', tableReset);\n        }\n\n        for (let i = 0; i < overrideLinks.length; i++) {\n            overrideLinks[i].addEventListener('click', triggerOverrideModal);\n        }\n\n        for (let i = 0; i < disabledLinks.length; i++) {\n            disabledLinks[i].addEventListener('click', (event) => {\n                event.preventDefault();\n            });\n        }\n\n        tableNavElement.forEach((navElement) => {\n            navElement.addEventListener('click', tableNav);\n        });\n    };\n\n    /**\n     * Display the table that contains all the students in the exam as well as their attempts.\n     */\n    const getStudentTable = function(page) {\n        if (typeof page === \"undefined\") {\n            page = 0;\n        }\n\n        let search = document.getElementById('local-assessfreq-quiz-student-table-search').value.trim();\n        let tableElement = document.getElementById('local-assessfreq-quiz-table');\n        let spinner = tableElement.getElementsByClassName('overlay-icon-container')[0];\n        let tableBody = tableElement.getElementsByClassName('table-body')[0];\n        let params = {'data': JSON.stringify({'quiz' : quizId, 'search': search, 'page': page})};\n\n        spinner.classList.remove('hide'); // Show spinner if not already shown.\n        Fragment.loadFragment('local_assessfreq', 'get_student_table', contextid, params)\n        .done((response) => {\n            tableBody.innerHTML = response;\n            spinner.classList.add('hide');\n            tableEventListeners(); // Re-add table event listeners.\n            $('[data-toggle=\"tooltip\"]').tooltip();\n\n        }).fail(() => {\n            Notification.exception(new Error('Failed to update table.'));\n        });\n    };\n\n    /**\n     * Callback function that is called when a quiz is selected from the form.\n     * Starts the processing of the dashbaord.\n     */\n    const processDashboard = function(quiz) {\n        quizId = quiz;\n        let titleElement = document.getElementById('local-assessfreq-quiz-title');\n        titleElement.innerHTML = selectQuizStr;\n        // Get quiz data.\n        Ajax.call([{\n            methodname: 'local_assessfreq_get_quiz_data',\n            args: {\n                quizid: quiz\n            },\n        }])[0].then((response) => {\n\n            let quizArray = JSON.parse(response);\n            let cardsElement = document.getElementById('local-assessfreq-quiz-dashboard-cards-deck');\n            let trendElement = document.getElementById('local-assessfreq-quiz-dashboard-participant-trend-deck');\n            let summaryElement = document.getElementById('local-assessfreq-quiz-summary-card');\n            let summarySpinner = summaryElement.getElementsByClassName('overlay-icon-container')[0];\n            let tableElement = document.getElementById('local-assessfreq-quiz-table');\n            let periodElement = document.getElementById('local-assessfreq-period-container');\n            let tableSearchInputElement = document.getElementById('local-assessfreq-quiz-student-table-search');\n            let tableSearchResetElement = document.getElementById('local-assessfreq-quiz-student-table-search-reset');\n            let tableSearchRowsElement = document.getElementById('local-assessfreq-quiz-student-table-rows');\n\n            let quizLink = document.createElement('a');\n            quizLink.href = quizArray.url;\n            quizLink.innerHTML = '<i class=\"fa fa-link fa-flip-vertical fa-fw\"></i>';\n            titleElement.innerHTML = quizArray.name + '&nbsp;';\n            titleElement.appendChild(quizLink);\n\n            // Update page URL with quiz ID, without reloading page so that page navigation and bookmarking works.\n            const currentdUrl = new URL(window.location.href);\n            const newUrl = currentdUrl.origin + currentdUrl.pathname + '?id=' + quizId;\n            history.pushState({}, '', newUrl);\n\n            // Update page title with quiz name.\n            Str.get_string('dashboard:quiztitle', 'local_assessfreq', {'quiz': quizArray.name, 'course': quizArray.courseshortname})\n            .then((str) => {\n                document.title = str;\n            }).catch(() => {\n                Notification.exception(new Error('Failed to load string: dashboard:quiztitle'));\n            });\n\n            // Populate quiz summary card with details.\n            Templates.render('local_assessfreq/quiz-summary-card-content', quizArray).done((html) => {\n                summarySpinner.classList.add('hide');\n                let contentcontainer = document.getElementById('local-assessfreq-quiz-summary-card-content');\n                Templates.replaceNodeContents(contentcontainer, html, '');\n                $('[data-toggle=\"tooltip\"]').tooltip();\n            }).fail(() => {\n                Notification.exception(new Error('Failed to load quiz summary template.'));\n                return;\n            });\n\n            // Show the cards.\n            cardsElement.classList.remove('hide');\n            trendElement.classList.remove('hide');\n            tableElement.classList.remove('hide');\n            periodElement.classList.remove('hide');\n\n            getCardCharts();\n            getStudentTable();\n            refreshCounter();\n\n            tableSearchInputElement.addEventListener('keyup', tableSearch);\n            tableSearchInputElement.addEventListener('paste', tableSearch);\n            tableSearchResetElement.addEventListener('click', tableSearchReset);\n            tableSearchRowsElement.addEventListener('click', tableSearchRowSet);\n\n            $('[data-toggle=\"tooltip\"]').tooltip();\n\n            return;\n        }).fail(() => {\n            Notification.exception(new Error('Failed to get quiz data'));\n        });\n    };\n\n    /**\n     * Handle processing of refresh and period button actions.\n     */\n    const refreshAction = function(event) {\n        event.preventDefault();\n        var element = event.target;\n\n        if (element.closest('button') !== null && element.closest('button').id == 'local-assessfreq-refresh-quiz-dashboard') {\n            refreshCounter(true);\n            processDashboard(quizId);\n        } else if (element.tagName.toLowerCase() === 'a') {\n            let refreshElement = document.getElementById('local-assessfreq-period-container');\n            let actionButton = refreshElement.getElementsByClassName('dropdown-toggle')[0];\n            actionButton.textContent = element.innerHTML;\n\n            let activeoptions = refreshElement.getElementsByClassName('active');\n\n            // Fix active classes.\n            for (var i = 0; i < activeoptions.length; i++) {\n                activeoptions[i].classList.remove('active');\n            }\n            element.classList.add('active');\n\n            refreshPeriod = element.dataset.period;\n            refreshCounter(true);\n            setUserPreference('local_assessfreq_quiz_refresh_preference', refreshPeriod);\n        }\n    };\n\n    /**\n     * Trigger the zoom graph. Thin wrapper to add extra data to click event.\n     */\n    const triggerZoomGraph = function(event) {\n        let call = event.target.closest('div').dataset.call;\n        let params = {'data': JSON.stringify({'quiz' : quizId, 'call': call})};\n        let method = 'get_quiz_chart';\n\n        ZoomModal.zoomGraph(event, params, method);\n    };\n\n    /**\n     * Trigger the override modal form. Thin wrapper to add extra data to click event.\n     */\n    const triggerOverrideModal = function(event) {\n        event.preventDefault();\n        const userid = event.target.closest('a').id.substring(25);\n\n        OverrideModal.displayModalForm(quizId, userid);\n    };\n\n    /**\n     * Initialise method for quiz dashboard rendering.\n     */\n    DashboardQuiz.init = function(context, quiz) {\n        contextid = context;\n        FormModal.init(context, processDashboard); // Create modal for quiz selection modal.\n        ZoomModal.init(context); // Create the zoom modal.\n        OverrideModal.init(context, processDashboard);\n\n        Str.get_string('loadingquiztitle', 'local_assessfreq').then((str) => {\n            selectQuizStr = str;\n        }).catch(() => {\n            Notification.exception(new Error('Failed to load string: loadingquiz'));\n        }).then(() => {\n            if (quiz > 0) {\n                quizId = quiz;\n                processDashboard(quiz);\n            }\n        });\n\n        getUserPreference('local_assessfreq_quiz_refresh_preference')\n        .then((response) => {\n            refreshPeriod = response.preferences[0].value ? response.preferences[0].value : 60;\n        })\n        .fail(() => {\n            Notification.exception(new Error('Failed to get use preference: refresh'));\n        });\n\n        // Event handling for refresh and period buttons.\n        let refreshElement = document.getElementById('local-assessfreq-period-container');\n        refreshElement.addEventListener('click', refreshAction);\n\n        // Set up zoom event listeners.\n        let summaryZoom = document.getElementById('local-assessfreq-quiz-summary-graph-zoom');\n        summaryZoom.addEventListener('click', triggerZoomGraph);\n\n        let trendZoom = document.getElementById('local-assessfreq-quiz-summary-trend-zoom');\n        trendZoom.addEventListener('click', triggerZoomGraph);\n\n    };\n\n    return DashboardQuiz;\n});\n"],"file":"dashboard_quiz.min.js"}