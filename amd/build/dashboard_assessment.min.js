define ("local_assessfreq/dashboard_assessment",["jquery","core/ajax","core/fragment","core/templates","core/notification","local_assessfreq/calendar","core/str","local_assessfreq/zoom_modal","local_assessfreq/dayview","local_assessfreq/user_preferences","local_assessfreq/chart_data"],function(a,b,c,d,e,f,g,h,i,j,k){var l={},m,n,o,p,q,r="",s="",t=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}],u=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!==n){n=b.dataset.year;for(var c=document.getElementById("local-assessfreq-cards-year-filter").getElementsByClassName("active"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");j.setUserPreference("local_assessfreq_overview_year_preference",n);var e=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];e.innerHTML=n;k.getCardCharts(0,null,n)}},v=function(){clearTimeout(q);q=setTimeout(z(),750)},w=function(a){var b=a.target;if("td"===b.tagName.toLowerCase()&&"true"===b.dataset.event){i.display(b.dataset.date)}},x=function(){var b=JSON.parse(s),c=parseInt(b.year),d=b.metric,g=b.modules,h=document.getElementById("local-assessfreq-report-heatmap"),i=h.getElementsByClassName("overlay-icon-container")[0];i.classList.remove("hide");f.generate(c,0,11,d,g).then(function(b){var c=document.getElementById("local-assessfreq-report-heatmap-months");c.innerHTML=b.innerHTML;c.addEventListener("click",w);a("[data-toggle=\"tooltip\"]").tooltip()}).then(f.createHeatScale).then(function(a){var b=document.getElementById("local-assessfreq-report-heatmap-scale");b.innerHTML=a.outerHTML;i.classList.add("hide")}).catch(function(){e.exception(new Error("Failed to calendar."))})},y=function(a){var b=a.year,c=a.metric,d=a.modules,e=document.getElementById("local-assessfreq-heatmap-form"),f=e.elements,g=[];if(0===d.length){d=["all"]}for(var l=0;l<f.length;l++){if(f[l]===void 0){continue}if("hidden"===f[l].type&&"year"===f[l].name){f[l].value=b;continue}if("hidden"===f[l].type&&"metric"===f[l].name){f[l].value=c;continue}if("hidden"===f[l].type&&f[l].name.startsWith("modules")){g.push(f[l]);continue}}for(var h=0,j=g,k;h<j.length;h++){k=j[h];k.remove()}for(var i=0,m;i<d.length;i++){m=document.createElement("input");m.type="hidden";m.name="modules["+d[i]+"]";m.value=d[i];e.appendChild(m)}},z=function(){for(var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],d=0;d<b.length;d++){if(b[d].classList.contains("active")){var g=b[d].dataset.module;c.push(g)}}if(r!==JSON.stringify(c)){r=JSON.stringify(c);j.setUserPreference("local_assessfreq_heatmap_modules_preference",r)}var e={year:o,metric:p,modules:c},f=JSON.stringify(e);if(f!==s){s=f;x();y(e)}},A=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!==o){o=b.dataset.year;for(var c=document.getElementById("local-assessfreq-cards-year-heat-filter").getElementsByClassName("active"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");j.setUserPreference("local_assessfreq_heatmap_year_preference",o);var e=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];e.innerHTML=o;v()}},B=function(a){a.preventDefault();var b=a.target,c=document.getElementById("local-assessfreq-heatmap-metrics-filter").getElementsByClassName("active");if("a"===b.tagName.toLowerCase()&&b.dataset.metric!==p){p=b.dataset.metric;for(var d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");j.setUserPreference("local_assessfreq_heatmap_metric_preference",p);v()}},C=function(a){for(var b=a.getElementsByTagName("a"),c=b[0],d=0,e;d<b.length;d++){e=b[d].dataset.module;if("all"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();for(var c=0;c<b.length;c++){b[c].classList.remove("active")}v()})}else if("close"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");v()})}else{b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");v()})}}},D=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({year:n,call:b})};h.zoomGraph(a,c,"get_chart")};l.init=function(a){m=a;var b=document.getElementById("local-assessfreq-cards-year");n=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",u);var c=document.getElementById("local-assessfreq-heatmap-year");o=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",A);var d=document.getElementById("local-assessfreq-heatmap-metrics");p=d.getElementsByClassName("active")[0].dataset.metric;d.addEventListener("click",B);var e=document.getElementById("local-assessfreq-heatmap-modules");C(e);var f=document.getElementById("local-assessfreq-assess-due-month-zoom");f.addEventListener("click",D);var g=document.getElementById("local-assessfreq-assess-by-activity-zoom");g.addEventListener("click",D);var j=document.getElementById("local-assessfreq-assess-due-month-student-zoom");j.addEventListener("click",D);h.init(a);i.init();k.init(t,m,"get_chart","core/chart");k.getCardCharts(0,null,n);z()};return l});
//# sourceMappingURL=dashboard_assessment.min.js.map
