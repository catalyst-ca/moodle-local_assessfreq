function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_assessfreq/dashboard_assessment",["exports","core/notification","local_assessfreq/calendar","local_assessfreq/chart_data","local_assessfreq/dayview","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=j(b);c=j(c);d=i(d);e=j(e);f=i(f);g=j(g);function h(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;h=function(){return a};return a}function i(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=h();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function j(a){return a&&a.__esModule?a:{default:a}}var k,l,m,n,o,p="",q="",r=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}],s=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!==l){l=b.dataset.year;f.setUserPreference("local_assessfreq_overview_year_preference",l);var c=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=l;d.getCardCharts(0,null,l)}},t=function(){clearTimeout(o);o=setTimeout(x(),750)},u=function(a){var b=a.target;if("td"===b.tagName.toLowerCase()&&"true"===b.dataset.event){e.default.display(b.dataset.date)}},v=function(){var a=JSON.parse(q),d=parseInt(a.year),e=a.metric,f=a.modules,g=document.getElementById("local-assessfreq-report-heatmap"),h=g.getElementsByClassName("overlay-icon-container")[0];h.classList.remove("hide");c.default.generate(d,0,11,e,f).then(function(a){var b=document.getElementById("local-assessfreq-report-heatmap-months");b.innerHTML=a.innerHTML;b.addEventListener("click",u)}).then(c.default.createHeatScale).then(function(a){var b=document.getElementById("local-assessfreq-report-heatmap-scale");b.innerHTML=a.outerHTML;h.classList.add("hide")}).catch(function(){b.default.exception(new Error("Failed to calendar."))})},w=function(a){var b=a.year,c=a.metric,d=a.modules,e=document.getElementById("local-assessfreq-heatmap-form"),f=e.elements,g=[];if(0===d.length){d=["all"]}for(var l=0;l<f.length;l++){if(f[l]===void 0){continue}if("hidden"===f[l].type&&"year"===f[l].name){f[l].value=b;continue}if("hidden"===f[l].type&&"metric"===f[l].name){f[l].value=c;continue}if("hidden"===f[l].type&&f[l].name.startsWith("modules")){g.push(f[l]);continue}}for(var h=0,j=g,k;h<j.length;h++){k=j[h];k.remove()}for(var i=0,m;i<d.length;i++){m=document.createElement("input");m.type="hidden";m.name="modules["+d[i]+"]";m.value=d[i];e.appendChild(m)}},x=function(){for(var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],d=0;d<b.length;d++){if(b[d].classList.contains("active")){var h=b[d].dataset.module;c.push(h)}}if(p!==JSON.stringify(c)){p=JSON.stringify(c);f.setUserPreference("local_assessfreq_heatmap_modules_preference",p)}var e={year:m,metric:n,modules:c},g=JSON.stringify(e);if(g!==q){q=g;v();w(e)}},y=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!==m){m=b.dataset.year;f.setUserPreference("local_assessfreq_heatmap_year_preference",m);var c=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=m;t()}},z=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.metric!==n){n=b.dataset.metric;f.setUserPreference("local_assessfreq_heatmap_metric_preference",n);t()}},A=function(a){for(var b=a.getElementsByTagName("a"),c=b[0],d=0,e;d<b.length;d++){e=b[d].dataset.module;if("all"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();for(var c=0;c<b.length;c++){b[c].classList.remove("active")}t()})}else if("close"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");t()})}else{b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");t()})}}},B=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({year:l,call:b})};g.default.zoomGraph(a,c,"get_chart")},C=function(a){k=a;var b=document.getElementById("local-assessfreq-cards-year");l=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",s);var c=document.getElementById("local-assessfreq-heatmap-year");m=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",y);var f=document.getElementById("local-assessfreq-heatmap-metrics");n=f.getElementsByClassName("active")[0].dataset.metric;f.addEventListener("click",z);var h=document.getElementById("local-assessfreq-heatmap-modules");A(h);var i=document.getElementById("local-assessfreq-assess-due-month-zoom");i.addEventListener("click",B);var j=document.getElementById("local-assessfreq-assess-by-activity-zoom");j.addEventListener("click",B);var o=document.getElementById("local-assessfreq-assess-due-month-student-zoom");o.addEventListener("click",B);g.default.init(a);e.default.init();d.init(r,k,"get_chart","core/chart");d.getCardCharts(0,null,l);x()};a.init=C});
//# sourceMappingURL=dashboard_assessment.min.js.map
