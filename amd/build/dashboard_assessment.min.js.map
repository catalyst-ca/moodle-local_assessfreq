{"version":3,"sources":["../src/dashboard_assessment.js"],"names":["contextid","yearselect","yearselectheatmap","metricselectheatmap","timeout","modulesJson","heatmapOptionsJson","cards","cardId","call","yearButtonAction","event","preventDefault","element","target","tagName","toLowerCase","dataset","year","UserPreference","setUserPreference","yeartitle","document","getElementById","getElementsByClassName","innerHTML","ChartData","getCardCharts","updateHeatmapDebounce","clearTimeout","setTimeout","updateHeatmap","detailView","Dayview","display","date","generateHeatmap","heatmapOptions","JSON","parse","parseInt","metric","modules","heatmapContainer","spinner","classList","remove","Calendar","generate","then","calendar","calendarContainer","addEventListener","createHeatScale","heatScale","heatScaleContainer","outerHTML","add","catch","Notification","exception","Error","updateDownload","downloadForm","formElements","elements","toRemove","length","i","type","name","value","startsWith","push","input","createElement","appendChild","cardsModulesSelectHeatmapElement","links","getElementsByTagName","contains","module","stringify","optionsObj","optionsJson","yearHeatmapButtonAction","metricHeatmapButtonAction","moduleListChildrenEvents","all","j","stopPropagation","dropdownmenu","toggle","triggerZoomGraph","closest","params","ZoomModal","zoomGraph","init","context","cardsYearSelectElement","cardsYearSelectHeatmapElement","cardsMetricSelectHeatmapElement","dueMonthZoom","dueActivityZoom","dueStudentZoom"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @module     local_assessfreq/dashboard_assessment\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport Calendar from 'local_assessfreq/calendar';\nimport * as ChartData from 'local_assessfreq/chart_data';\nimport Dayview from 'local_assessfreq/dayview';\nimport * as UserPreference from 'local_assessfreq/user_preferences';\nimport ZoomModal from 'local_assessfreq/zoom_modal';\n\n/**\n * Module level variables.\n */\nvar contextid;\nvar yearselect;\nvar yearselectheatmap;\nvar metricselectheatmap;\nvar timeout;\nvar modulesJson = '';\nvar heatmapOptionsJson = '';\n\nconst cards = [\n    {cardId: 'local-assessfreq-assess-due-month', call: 'assess_by_month'},\n    {cardId: 'local-assessfreq-assess-by-activity', call: 'assess_by_activity'},\n    {cardId: 'local-assessfreq-assess-due-month-student', call: 'assess_by_month_student'}\n];\n\n/**\n * Get and process the selected year from the dropdown,\n * and update the corresponding user perference.\n *\n * @param {event} event The triggered event for the element.\n */\nconst yearButtonAction = (event) => {\n    event.preventDefault();\n    var element = event.target;\n\n    if (element.tagName.toLowerCase() === 'a' && element.dataset.year !== yearselect) { // Only act on certain elements.\n        yearselect = element.dataset.year;\n\n        // Save selection as a user preference.\n        UserPreference.setUserPreference('local_assessfreq_overview_year_preference', yearselect);\n\n        // Update card data based on selected year.\n        var yeartitle = document.getElementById('local-assessfreq-report-overview')\n            .getElementsByClassName('local-assessfreq-year')[0];\n        yeartitle.innerHTML = yearselect;\n\n        ChartData.getCardCharts(0, null, yearselect); // Process loading for the assessment cards.\n    }\n};\n\n/**\n * Quick and dirty debounce method for the heatmap settings menu.\n * This stops the ajax method that updates the heatmap from being updated\n * while the user is still checking options.\n *\n */\nconst updateHeatmapDebounce = () => {\n    clearTimeout(timeout);\n    timeout = setTimeout(updateHeatmap(), 750);\n};\n\n/**\n * Display heatmap calendar.\n *\n * @param {event} event The triggered event for the element.\n */\nconst detailView = (event) => {\n    let element = event.target;\n    if (element.tagName.toLowerCase() === 'td' && element.dataset.event === 'true') { // Only act on certain elements.\n        Dayview.display(element.dataset.date);\n    }\n};\n\n/**\n * Start heatmap generation.\n *\n */\nconst generateHeatmap = () => {\n    let heatmapOptions = JSON.parse(heatmapOptionsJson);\n    let year = parseInt(heatmapOptions.year);\n    let metric = heatmapOptions.metric;\n    let modules = heatmapOptions.modules;\n    let heatmapContainer = document.getElementById('local-assessfreq-report-heatmap');\n    let spinner = heatmapContainer.getElementsByClassName('overlay-icon-container')[0];\n\n    spinner.classList.remove('hide'); // Show spinner if not already shown.\n\n    Calendar.generate(year, 0, 11, metric, modules)\n    .then(calendar => {\n        let calendarContainer = document.getElementById('local-assessfreq-report-heatmap-months');\n        calendarContainer.innerHTML = calendar.innerHTML;\n        calendarContainer.addEventListener('click', detailView);\n    })\n    .then(Calendar.createHeatScale)\n    .then((heatScale) => {\n        let heatScaleContainer = document.getElementById('local-assessfreq-report-heatmap-scale');\n        heatScaleContainer.innerHTML = heatScale.outerHTML;\n        spinner.classList.add('hide'); // Hide sinner if not already hidden.\n    })\n    .catch(() => {\n        Notification.exception(new Error('Failed to calendar.'));\n        return;\n    });\n};\n\nconst updateDownload = ({year, metric, modules}) => {\n    let downloadForm = document.getElementById('local-assessfreq-heatmap-form');\n    let formElements = downloadForm.elements;\n    let toRemove = new Array();\n\n    if (modules.length === 0) {\n        modules = ['all'];\n    }\n\n    for (let i = 0; i < formElements.length; i++) {\n        if (formElements[i] === undefined) {\n            continue;\n        }\n        // Update year field.\n        if ((formElements[i].type === 'hidden') && (formElements[i].name === 'year')) {\n            formElements[i].value = year;\n            continue;\n        }\n\n        // Update metric field.\n        if ((formElements[i].type === 'hidden') && (formElements[i].name === 'metric')) {\n            formElements[i].value = metric;\n            continue;\n        }\n\n        // Update module fields.\n        if ((formElements[i].type === 'hidden') && (formElements[i].name.startsWith('modules'))) {\n            toRemove.push(formElements[i]);\n            continue;\n        }\n    }\n\n    for (const element of toRemove) {\n        element.remove();\n    }\n\n    for (let i = 0; i < modules.length; i++) {\n        let input = document.createElement('input');\n        input.type = 'hidden';\n        input.name = 'modules[' + modules[i] + ']';\n        input.value = modules[i];\n\n        downloadForm.appendChild(input);\n    }\n};\n\n/**\n * Update the heatmap based on the current filter settings.\n *\n */\nconst updateHeatmap = () => {\n    // Get current state of select menu items.\n    var cardsModulesSelectHeatmapElement = document.getElementById('local-assessfreq-heatmap-modules');\n    var links = cardsModulesSelectHeatmapElement.getElementsByTagName('a');\n    var modules = [];\n\n    for (var i = 0; i < links.length; i++) {\n        if (links[i].classList.contains('active')) {\n            let module = links[i].dataset.module;\n            modules.push(module);\n        }\n    }\n\n    // Save selection as a user preference.\n    if (modulesJson !== JSON.stringify(modules)) {\n        modulesJson = JSON.stringify(modules);\n        UserPreference.setUserPreference('local_assessfreq_heatmap_modules_preference', modulesJson);\n    }\n\n    // Build settings object.\n    var optionsObj = {\n        'year': yearselectheatmap,\n        'metric': metricselectheatmap,\n        'modules': modules\n    };\n\n    var optionsJson = JSON.stringify(optionsObj);\n\n    if (optionsJson !== heatmapOptionsJson) { // Compare to global to see if there are any changes.\n        // If list has changed fetch heatmap and update user preference.\n        heatmapOptionsJson = optionsJson;\n        generateHeatmap();\n\n        // Update the download options.\n        updateDownload(optionsObj);\n    }\n};\n\n/**\n * Get and process the selected year from the dropdown for the heatmap display,\n * and update the corresponding user preference.\n *\n * @param {event} event The triggered event for the element.\n */\nconst yearHeatmapButtonAction = (event) => {\n    event.preventDefault();\n    var element = event.target;\n\n    if (element.tagName.toLowerCase() === 'a' && element.dataset.year !== yearselectheatmap) { // Only act on certain elements.\n        yearselectheatmap = element.dataset.year;\n\n        // Save selection as a user preference.\n        UserPreference.setUserPreference('local_assessfreq_heatmap_year_preference', yearselectheatmap);\n\n        // Update card data based on selected year.\n        var yeartitle = document.getElementById('local-assessfreq-report-heatmap')\n            .getElementsByClassName('local-assessfreq-year')[0];\n        yeartitle.innerHTML = yearselectheatmap;\n\n        updateHeatmapDebounce(); // Call function to update heatmap.\n    }\n};\n\n/**\n * Get and process the selected assessment metric from the dropdown for the heatmap display,\n * and update the corresponding user preference.\n *\n * @param {event} event The triggered event for the element.\n */\nconst metricHeatmapButtonAction = (event) => {\n    event.preventDefault();\n    var element = event.target;\n\n    if (element.tagName.toLowerCase() === 'a' && element.dataset.metric !== metricselectheatmap) {\n        metricselectheatmap = element.dataset.metric;\n\n        // Save selection as a user preference.\n        UserPreference.setUserPreference('local_assessfreq_heatmap_metric_preference', metricselectheatmap);\n\n        updateHeatmapDebounce(); // Call function to update heatmap.\n    }\n};\n\n/**\n * Add the event listeners to the modules in the module select dropdown.\n *\n * @param {Object} element The dropdown HTML element that contains the list of modules as links.\n */\nconst moduleListChildrenEvents = (element) => {\n    var links = element.getElementsByTagName('a');\n    var all = links[0];\n\n    for (var i = 0; i < links.length; i++) {\n        let module = links[i].dataset.module;\n\n        if (module.toLowerCase() === 'all') {\n            links[i].addEventListener('click', function(event){\n                event.preventDefault();\n                // Remove active class from all other links.\n                for (var j = 0; j < links.length; j++) {\n                    links[j].classList.remove('active');\n                }\n                updateHeatmapDebounce(); // Call function to update heatmap.\n            });\n        } else if (module.toLowerCase() === 'close') {\n            links[i].addEventListener('click', function(event){\n                event.preventDefault();\n                event.stopPropagation();\n\n                var dropdownmenu = document.getElementById('local-assessfreq-heatmap-modules-filter');\n                dropdownmenu.classList.remove('show');\n\n                updateHeatmapDebounce(); // Call function to update heatmap.\n            });\n\n        } else {\n            links[i].addEventListener('click', function(event){\n                event.preventDefault();\n                event.stopPropagation();\n\n                all.classList.remove('active');\n\n                event.target.classList.toggle('active');\n                updateHeatmapDebounce();\n            });\n        }\n\n    }\n};\n\n/**\n * Thin wrapper to add extra data to click event.\n *\n * @param {Event} event The triggered event for the element.\n */\nconst triggerZoomGraph = (event) => {\n    let call = event.target.closest('div').dataset.call;\n    let params = {'data': JSON.stringify({'year': yearselect, 'call': call})};\n    let method = 'get_chart';\n\n    ZoomModal.zoomGraph(event, params, method);\n};\n\n/**\n * Initialise method for report card rendering.\n *\n * @param {integer} context The current context id.\n */\nexport const init = (context) => {\n    contextid = context;\n\n    // Set up event listener and related actions for year dropdown on report cards.\n    let cardsYearSelectElement = document.getElementById('local-assessfreq-cards-year');\n    yearselect = cardsYearSelectElement.getElementsByClassName('active')[0].dataset.year;\n    cardsYearSelectElement.addEventListener('click', yearButtonAction);\n\n    // Set up event listener and related actions for year dropdown on heatmp.\n    let cardsYearSelectHeatmapElement = document.getElementById('local-assessfreq-heatmap-year');\n    yearselectheatmap = cardsYearSelectHeatmapElement.getElementsByClassName('active')[0].dataset.year;\n    cardsYearSelectHeatmapElement.addEventListener('click', yearHeatmapButtonAction);\n\n    // Set up event listener and related actions for metric dropdown on heatmp.\n    let cardsMetricSelectHeatmapElement = document.getElementById('local-assessfreq-heatmap-metrics');\n    metricselectheatmap = cardsMetricSelectHeatmapElement.getElementsByClassName('active')[0].dataset.metric;\n    cardsMetricSelectHeatmapElement.addEventListener('click', metricHeatmapButtonAction);\n\n    // Set up event listener and related actions for module dropdown on heatmp.\n    let cardsModulesSelectHeatmapElement = document.getElementById('local-assessfreq-heatmap-modules');\n    moduleListChildrenEvents(cardsModulesSelectHeatmapElement);\n\n    // Set up zoom event listeners.\n    let dueMonthZoom = document.getElementById('local-assessfreq-assess-due-month-zoom');\n    dueMonthZoom.addEventListener('click', triggerZoomGraph);\n\n    let dueActivityZoom = document.getElementById('local-assessfreq-assess-by-activity-zoom');\n    dueActivityZoom.addEventListener('click', triggerZoomGraph);\n\n    let dueStudentZoom = document.getElementById('local-assessfreq-assess-due-month-student-zoom');\n    dueStudentZoom.addEventListener('click', triggerZoomGraph);\n\n    // Create the zoom modal.\n    ZoomModal.init(context);\n\n    // Setup the dayview modal.\n    Dayview.init();\n\n    // Setup the chart data for each card.\n    ChartData.init(cards, contextid, 'get_chart', 'core/chart');\n\n    // Process loading for the assessment cards.\n    ChartData.getCardCharts(0, null, yearselect);\n\n    // Get the data for the heatmap.\n    updateHeatmap();\n\n};\n"],"file":"dashboard_assessment.min.js"}