function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_assessfreq/dashboard_quiz_inprogress",["exports","core/ajax","core/notification","core/templates","local_assessfreq/chart_data","local_assessfreq/table_handler","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=k(b);c=k(c);d=k(d);e=j(e);f=j(f);g=j(g);h=j(h);function i(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;i=function(){return a};return a}function j(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=i();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function k(a){return a&&a.__esModule?a:{default:a}}var l,m=60,n,o="name_asc",p=0,q=0,r,s=[{cardId:"local-assessfreq-quiz-summary-upcomming-graph",call:"upcomming_quizzes",aspect:!0},{cardId:"local-assessfreq-quiz-summary-inprogress-graph",call:"all_participants_inprogress",aspect:!0}],t=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,b=document.getElementById("local-assessfreq-period-progress");if(!0===a){clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(n){return}n=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/m;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(n);n=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);u();t()}},1e3)},u=function(){b.default.call([{methodname:"local_assessfreq_get_inprogress_counts",args:{}}])[0].then(function(a){var b=JSON.parse(a),g=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card"),h=g.getElementsByClassName("overlay-icon-container")[0],i=document.getElementById("local-assessfreq-quiz-inprogress-table-search"),j=document.getElementById("local-assessfreq-quiz-inprogress-table-search-reset"),k=document.getElementById("local-assessfreq-quiz-inprogress-table-rows"),l=document.getElementById("local-assessfreq-inprogress-table-sort");g.classList.remove("hide");d.default.render("local_assessfreq/quiz-dashboard-inprogress-summary-card-content",b).done(function(a){h.classList.add("hide");var b=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card-content");d.default.replaceNodeContents(b,a,"")}).fail(function(){c.default.exception(new Error("Failed to load quiz counts template."))});r=[p,q];e.getCardCharts(0,r);f.getTable(0,r,o);t();i.addEventListener("keyup",f.tableSearch);i.addEventListener("paste",f.tableSearch);j.addEventListener("click",f.tableSearchReset);k.addEventListener("click",f.tableSearchRowSet);l.addEventListener("click",f.tableSortButtonAction)}).fail(function(){c.default.exception(new Error("Failed to get quiz summary counts"))})},v=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"===b.closest("button").id){t(!0);u()}else if("a"===b.tagName.toLowerCase()){m=b.dataset.period;t(!0);g.setUserPreference("local_assessfreq_quiz_refresh_preference",m)}},w=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({call:b,hoursahead:p,hoursbehind:q})};h.zoomGraph(a,c,"get_quiz_inprogress_chart")},x=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;g.setUserPreference("local_assessfreq_quizzes_inprogress_table_hoursahead_preference",b).then(function(){p=b;u()}).fail(function(){c.default.exception(new Error("Failed to update user preference: hours ahead"))})}},y=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;g.setUserPreference("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference",b).then(function(){q=b;u()}).fail(function(){c.default.exception(new Error("Failed to update user preference: hours behind"))})}},z=function(a){l=a;h.init(a);f.init(0,l,null,"local-assessfreq-quiz-inprogress-table","get_quizzes_inprogress_table","local_assessfreq_quiz_table_inprogress_preference","local-assessfreq-quiz-inprogress-table-search");e.init(s,a,"get_quiz_inprogress_chart","local_assessfreq/chart");g.getUserPreference("local_assessfreq_quiz_refresh_preference").then(function(a){m=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){c.default.exception(new Error("Failed to get use preference: refresh"))});g.getUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference").then(function(a){o=a.preferences[0].value?a.preferences[0].value:"name_asc"}).fail(function(){c.default.exception(new Error("Failed to get use preference: tablesort"))});g.getUserPreference("local_assessfreq_quizzes_inprogress_table_hoursahead_preference").then(function(a){p=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){c.default.exception(new Error("Failed to get use preference: hoursahead"))});g.getUserPreference("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference").then(function(a){q=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){c.default.exception(new Error("Failed to get use preference: hoursbehind"))});var b=document.getElementById("local-assessfreq-period-container");b.addEventListener("click",v);var d=document.getElementById("local-assessfreq-quiz-summary-inprogress-graph-zoom");d.addEventListener("click",w);var i=document.getElementById("local-assessfreq-quiz-summary-upcomming-graph-zoom");i.addEventListener("click",w);var j=document.getElementById("local-assessfreq-quiz-student-table-hoursahead");j.addEventListener("click",x);var k=document.getElementById("local-assessfreq-quiz-student-table-hoursbehind");k.addEventListener("click",y);u()};a.init=z});
//# sourceMappingURL=dashboard_quiz_inprogress.min.js.map
