define ("local_assessfreq/dashboard_quiz_inprogress",["core/ajax","core/templates","core/fragment","local_assessfreq/zoom_modal","core/str","core/notification"],function(a,b,c,d,e,f){var g={},h,i=60,j,k="name_asc",l,m=[{cardId:"local-assessfreq-quiz-summary-upcomming-graph",call:"upcomming_quizzes",aspect:!0},{cardId:"local-assessfreq-quiz-summary-inprogress-graph",call:"all_participants_inprogress",aspect:!0}],n=function(b,c){return a.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:b,value:c}]}}])[0]},o=function(b){return a.call([{methodname:"local_assessfreq_get_user_preferences",args:{name:b}}])[0]},p=function(a){clearTimeout(l);l=setTimeout(a(),750)},q=function(a){var b=document.getElementById("local-assessfreq-period-progress");if(!0==a){clearInterval(j);j=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(j){return}j=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/i;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(j);j=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);z();q()}},1e3)},r=function(a){if(2<a.target.value.length){y()}if(0==a.target.value.length){y()}},s=function(){var a=document.getElementById("local-assessfreq-quiz-inprogress-table-search");a.value="";a.focus();y()},t=function(){m.forEach(function(a){var d=document.getElementById(a.cardId),g=d.getElementsByClassName("overlay-icon-container")[0],i=d.getElementsByClassName("chart-body")[0],j={data:JSON.stringify({call:a.call})};g.classList.remove("hide");c.loadFragment("local_assessfreq","get_quiz_inprogress_chart",h,j).done(function(c){var d=JSON.parse(c);if(!0==d.hasdata){var h={withtable:!0,chartdata:JSON.stringify(d.chart),aspect:a.aspect};b.render("local_assessfreq/chart",h).done(function(a,c){g.classList.add("hide");b.replaceNodeContents(i,a,c)}).fail(function(){f.exception(new Error("Failed to load chart template."))})}else{e.get_string("nodata","local_assessfreq").then(function(a){var b=document.createElement("h3");b.innerHTML=a;i.innerHTML=b.outerHTML;g.classList.add("hide")}).catch(function(){f.exception(new Error("Failed to load string: nodata"))})}}).fail(function(){f.exception(new Error("Failed to load card."))})})},u=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){y(c)}},v=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;n("local_assessfreq_quiz_table_inprogress_preference",b).then(function(){y()}).fail(function(){f.exception(new Error("Failed to update user preference: rows"))})}},w=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!=k){k=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");n("local_assessfreq_quiz_table_inprogress_sort_preference",k);p(y)}},x=function(){var a=document.getElementById("local-assessfreq-quiz-inprogress-table"),b=a.querySelectorAll("nav");b.forEach(function(a){a.addEventListener("click",u)})},y=function(a){if("undefined"==typeof a){a=0}var d=document.getElementById("local-assessfreq-quiz-inprogress-table"),e=d.getElementsByClassName("overlay-icon-container")[0],g=d.getElementsByClassName("table-body")[0],i=document.getElementById("local-assessfreq-quiz-inprogress-table-search").value.trim(),j=k.split("_"),l=j[0],m=j[1],n={data:JSON.stringify({search:i,page:a,sorton:l,direction:m})};e.classList.remove("hide");c.loadFragment("local_assessfreq","get_quizzes_inprogress_table",h,n).done(function(a,c){g.innerHTML=a;b.runTemplateJS(c);e.classList.add("hide");x()}).fail(function(){f.exception(new Error("Failed to update table."))})},z=function(){a.call([{methodname:"local_assessfreq_get_inprogress_counts",args:{}}])[0].then(function(a){var c=JSON.parse(a),d=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card"),e=d.getElementsByClassName("overlay-icon-container")[0],g=document.getElementById("local-assessfreq-quiz-inprogress-table-search"),h=document.getElementById("local-assessfreq-quiz-inprogress-table-search-reset"),i=document.getElementById("local-assessfreq-quiz-inprogress-table-rows"),j=document.getElementById("local-assessfreq-inprogress-table-sort");d.classList.remove("hide");b.render("local_assessfreq/quiz-dashboard-inprogress-summary-card-content",c).done(function(a){e.classList.add("hide");var c=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card-content");b.replaceNodeContents(c,a)}).fail(function(){f.exception(new Error("Failed to load quiz counts template."))});t();y();q();g.addEventListener("keyup",r);g.addEventListener("paste",r);h.addEventListener("click",s);i.addEventListener("click",v);j.addEventListener("click",w)}).fail(function(){f.exception(new Error("Failed to get quiz summary counts"))})},A=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"==b.closest("button").id){q(!0);z()}else if("a"===b.tagName.toLowerCase()){i=b.dataset.period;q(!0);n("local_assessfreq_quiz_refresh_preference",i)}},B=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({call:b})};d.zoomGraph(a,c,"get_quiz_inprogress_chart")};g.init=function(a){h=a;d.init(a);o("local_assessfreq_quiz_refresh_preference").then(function(a){i=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){f.exception(new Error("Failed to get use preference: refresh"))});o("local_assessfreq_quiz_table_inprogress_sort_preference").then(function(a){k=a.preferences[0].value?a.preferences[0].value:"name_asc"}).fail(function(){f.exception(new Error("Failed to get use preference: tablesort"))});var b=document.getElementById("local-assessfreq-period-container");b.addEventListener("click",A);var c=document.getElementById("local-assessfreq-quiz-summary-inprogress-graph-zoom");c.addEventListener("click",B);var e=document.getElementById("local-assessfreq-quiz-summary-upcomming-graph-zoom");e.addEventListener("click",B);z()};return g});
//# sourceMappingURL=dashboard_quiz_inprogress.min.js.map
