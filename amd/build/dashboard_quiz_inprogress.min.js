define ("local_assessfreq/dashboard_quiz_inprogress",["jquery","core/ajax","core/fragment","core/notification","core/str","core/templates","local_assessfreq/chart_data","local_assessfreq/table_handler","local_assessfreq/user_preferences","local_assessfreq/zoom_modal"],function(a,b,c,d,e,f,g,h,j,k){var l={},m,n=60,o,p="name_asc",q=0,r=0,s,t=[{cardId:"local-assessfreq-quiz-summary-upcomming-graph",call:"upcomming_quizzes",aspect:!0},{cardId:"local-assessfreq-quiz-summary-inprogress-graph",call:"all_participants_inprogress",aspect:!0}],u=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,b=document.getElementById("local-assessfreq-period-progress");if(!0===a){clearInterval(o);o=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(o){return}o=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/n;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(o);o=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);v();u()}},1e3)},v=function(){b.call([{methodname:"local_assessfreq_get_inprogress_counts",args:{}}])[0].then(function(b){var c=JSON.parse(b),e=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card"),i=e.getElementsByClassName("overlay-icon-container")[0],j=document.getElementById("local-assessfreq-quiz-inprogress-table-search"),k=document.getElementById("local-assessfreq-quiz-inprogress-table-search-reset"),l=document.getElementById("local-assessfreq-quiz-inprogress-table-rows"),m=document.getElementById("local-assessfreq-inprogress-table-sort");e.classList.remove("hide");f.render("local_assessfreq/quiz-dashboard-inprogress-summary-card-content",c).done(function(a){i.classList.add("hide");var b=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card-content");f.replaceNodeContents(b,a,"")}).fail(function(){d.exception(new Error("Failed to load quiz counts template."))});s=[q,r];g.getCardCharts(0,s);h.getTable(0,s,p);u();j.addEventListener("keyup",h.tableSearch);j.addEventListener("paste",h.tableSearch);k.addEventListener("click",h.tableSearchReset);l.addEventListener("click",h.tableSearchRowSet);m.addEventListener("click",h.tableSortButtonAction);a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){d.exception(new Error("Failed to get quiz summary counts"))})},w=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"===b.closest("button").id){u(!0);v()}else if("a"===b.tagName.toLowerCase()){var c=document.getElementById("local-assessfreq-period-container"),d=c.getElementsByClassName("dropdown-toggle")[0];d.textContent=b.innerHTML;for(var e=c.getElementsByClassName("active"),f=0;f<e.length;f++){e[f].classList.remove("active")}b.classList.add("active");n=b.dataset.period;u(!0);j.setUserPreference("local_assessfreq_quiz_refresh_preference",n)}},x=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({call:b,hoursahead:q,hoursbehind:r})};k.zoomGraph(a,c,"get_quiz_inprogress_chart")},y=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById("local-assessfreq-quiz-student-table-hoursahead").getElementsByClassName("active"),e=0;e<c.length;e++){c[e].classList.remove("active")}a.target.classList.add("active");j.setUserPreference("local_assessfreq_quizzes_inprogress_table_hoursahead_preference",b).then(function(){q=b;v()}).fail(function(){d.exception(new Error("Failed to update user preference: hours ahead"))})}},z=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById("local-assessfreq-quiz-student-table-hoursbehind").getElementsByClassName("active"),e=0;e<c.length;e++){c[e].classList.remove("active")}a.target.classList.add("active");j.setUserPreference("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference",b).then(function(){r=b;v()}).fail(function(){d.exception(new Error("Failed to update user preference: hours behind"))})}};l.init=function(a){m=a;k.init(a);h.init(0,m,null,"local-assessfreq-quiz-inprogress-table","get_quizzes_inprogress_table","local_assessfreq_quiz_table_inprogress_preference","local-assessfreq-quiz-inprogress-table-search",null,null,"local-assessfreq-quiz-inprogress-table-rows");g.init(t,a,"get_quiz_inprogress_chart","local_assessfreq/chart");j.getUserPreference("local_assessfreq_quiz_refresh_preference").then(function(a){n=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){d.exception(new Error("Failed to get use preference: refresh"))});j.getUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference").then(function(a){p=a.preferences[0].value?a.preferences[0].value:"name_asc"}).fail(function(){d.exception(new Error("Failed to get use preference: tablesort"))});j.getUserPreference("local_assessfreq_quizzes_inprogress_table_hoursahead_preference").then(function(a){q=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){d.exception(new Error("Failed to get use preference: hoursahead"))});j.getUserPreference("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference").then(function(a){r=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){d.exception(new Error("Failed to get use preference: hoursbehind"))});var b=document.getElementById("local-assessfreq-period-container");b.addEventListener("click",w);var c=document.getElementById("local-assessfreq-quiz-summary-inprogress-graph-zoom");c.addEventListener("click",x);var e=document.getElementById("local-assessfreq-quiz-summary-upcomming-graph-zoom");e.addEventListener("click",x);var f=document.getElementById("local-assessfreq-quiz-student-table-hoursahead");f.addEventListener("click",y);var i=document.getElementById("local-assessfreq-quiz-student-table-hoursbehind");i.addEventListener("click",z);v()};return l});
//# sourceMappingURL=dashboard_quiz_inprogress.min.js.map
