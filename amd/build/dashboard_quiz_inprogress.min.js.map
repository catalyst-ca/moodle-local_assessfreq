{"version":3,"sources":["../src/dashboard_quiz_inprogress.js"],"names":["define","Ajax","Templates","Fragment","ZoomModal","Str","Notification","DashboardQuizInprogress","contextid","cards","cardId","call","aspect","getCardCharts","forEach","cardData","cardElement","document","getElementById","spinner","getElementsByClassName","chartbody","params","JSON","stringify","classList","remove","loadFragment","done","response","resObj","parse","hasdata","context","chart","render","html","js","add","replaceNodeContents","fail","exception","Error","get_string","then","str","noDatastr","createElement","innerHTML","outerHTML","catch","processDashboard","methodname","args","quizSummary","summaryElement","summarySpinner","contentcontainer","init","window","console","log"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for quizzes in progress display and processing.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/ajax', 'core/templates', 'core/fragment', 'local_assessfreq/zoom_modal', 'core/str', 'core/notification'],\nfunction(Ajax, Templates, Fragment, ZoomModal, Str, Notification) {\n\n    /**\n     * Module level variables.\n     */\n    var DashboardQuizInprogress = {};\n    var contextid;\n\n    const cards = [\n        {cardId: 'local-assessfreq-quiz-summary-upcomming-graph', call: 'upcomming_quizzes', aspect: false},\n        {cardId: 'local-assessfreq-quiz-summary-inprogress-graph', call: 'all_participants_inprogress', aspect: true}\n    ];\n\n    /**\n     * For each of the cards on the dashbaord get their corresponding chart data.\n     * Data is based on the year variable from the corresponding dropdown.\n     * Chart data is loaded via ajax.\n     *\n     */\n    const getCardCharts = function() {\n        cards.forEach((cardData) => {\n            let cardElement = document.getElementById(cardData.cardId);\n            let spinner = cardElement.getElementsByClassName('overlay-icon-container')[0];\n            let chartbody = cardElement.getElementsByClassName('chart-body')[0];\n            let params = {'data': JSON.stringify({'call': cardData.call})};\n\n            spinner.classList.remove('hide'); // Show sinner if not already shown.\n            Fragment.loadFragment('local_assessfreq', 'get_quiz_inprogress_chart', contextid, params)\n            .done((response) => {\n                let resObj = JSON.parse(response);\n                if (resObj.hasdata == true) {\n                    let context = { 'withtable' : true, 'chartdata' : JSON.stringify(resObj.chart), 'aspect' :  cardData.aspect};\n                    Templates.render('local_assessfreq/chart', context).done((html, js) => {\n                        spinner.classList.add('hide'); // Hide spinner if not already hidden.\n                        // Load card body.\n                        Templates.replaceNodeContents(chartbody, html, js);\n                    }).fail(() => {\n                        Notification.exception(new Error('Failed to load chart template.'));\n                        return;\n                    });\n                    return;\n                } else {\n                    Str.get_string('nodata', 'local_assessfreq').then((str) => {\n                        const noDatastr = document.createElement('h3');\n                        noDatastr.innerHTML = str;\n                        chartbody.innerHTML = noDatastr.outerHTML;\n                        spinner.classList.add('hide'); // Hide spinner if not already hidden.\n                        return;\n                    }).catch(() => {\n                        Notification.exception(new Error('Failed to load string: nodata'));\n                    });\n                }\n            }).fail(() => {\n                Notification.exception(new Error('Failed to load card.'));\n                return;\n            });\n        });\n    };\n\n    /**\n     * Starts the processing of the dashboard.\n     */\n    const processDashboard = function() {\n        // Get summary quiz data.\n        Ajax.call([{\n            methodname: 'local_assessfreq_get_inprogress_counts',\n            args: {},\n        }])[0].then((response) => {\n            let quizSummary = JSON.parse(response);\n            let summaryElement = document.getElementById('local-assessfreq-quiz-dashboard-inprogress-summary-card');\n            let summarySpinner = summaryElement.getElementsByClassName('overlay-icon-container')[0];\n\n            summaryElement.classList.remove('hide'); // Show the card.\n\n            // Populate summary card with details.\n            Templates.render('local_assessfreq/quiz-dashboard-inprogress-summary-card-content', quizSummary)\n            .done((html) => {\n                summarySpinner.classList.add('hide');\n\n                let contentcontainer = document.getElementById('local-assessfreq-quiz-dashboard-inprogress-summary-card-content');\n                Templates.replaceNodeContents(contentcontainer, html);\n            }).fail(() => {\n                Notification.exception(new Error('Failed to load quiz counts template.'));\n                return;\n            });\n\n            getCardCharts();\n\n            return;\n        }).fail(() => {\n            Notification.exception(new Error('Failed to get quiz summary counts'));\n        });\n    };\n\n    /**\n     * Initialise method for quizzes in progress dashboard rendering.\n     */\n    DashboardQuizInprogress.init = function(context) {\n        contextid = context;\n        window.console.log(contextid);\n        ZoomModal.init(context); // Create the zoom modal.\n\n        processDashboard();\n\n    };\n\n    return DashboardQuizInprogress;\n});\n"],"file":"dashboard_quiz_inprogress.min.js"}