{"version":3,"sources":["../src/zoom_modal.js"],"names":["define","Str","ModalFactory","Fragment","Ajax","Templates","ModalLarge","Notification","ZoomModal","contextid","modalObj","zoomGraph","event","params","method","title","target","parentElement","dataset","loadFragment","done","response","resObj","JSON","parse","hasdata","context","stringify","chart","aspect","setTitle","setBody","render","show","get_string","then","str","noDatastr","document","createElement","innerHTML","outerHTML","catch","exception","Error","fail","createModal","Promise","resolve","reject","create","type","TYPE","body","modal","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/str', 'core/modal_factory', 'core/fragment', 'core/ajax', 'core/templates', 'local_assessfreq/modal_large',\n    'core/notification'],\nfunction(Str, ModalFactory, Fragment, Ajax, Templates, ModalLarge, Notification) {\n\n    /**\n     * Module level variables.\n     */\n    var ZoomModal = {};\n    var contextid;\n    var modalObj;\n    const spinner = '<p class=\"text-center\">'\n        + '<i class=\"fa fa-circle-o-notch fa-spin fa-3x fa-fw\"></i>'\n        + '</p>';\n\n    /**\n     * Provides zoom functionality for card graphs.\n     */\n    ZoomModal.zoomGraph = function(event, params, method) {\n        let title = event.target.parentElement.dataset.title;\n\n        Fragment.loadFragment('local_assessfreq', method, contextid, params)\n        .done((response) => {\n            let resObj = JSON.parse(response);\n            if (resObj.hasdata == true) {\n                var context = { 'withtable' : false, 'chartdata' : JSON.stringify(resObj.chart), aspect: false};\n                modalObj.setTitle(title);\n                modalObj.setBody(Templates.render('local_assessfreq/chart', context));\n                modalObj.show();\n                return;\n            } else {\n                Str.get_string('nodata', 'local_assessfreq').then((str) => {\n                    const noDatastr = document.createElement('h3');\n                    noDatastr.innerHTML = str;\n                    modalObj.setTitle(title);\n                    modalObj.setBody(noDatastr.outerHTML);\n                    modalObj.show();\n                    return;\n                }).catch(() => {\n                    Notification.exception(new Error('Failed to load string: nodata'));\n                });\n            }\n        }).fail(() => {\n            Notification.exception(new Error('Failed to load zoomed graph'));\n            return;\n        });\n\n    };\n\n    /**\n     * Create the modal window for graph zooming.\n     *\n     * @private\n     */\n    const createModal = function() {\n        return new Promise((resolve, reject) => {\n            Str.get_string('loading', 'core').then((title) => {\n                // Create the Modal.\n                ModalFactory.create({\n                    type: ModalLarge.TYPE,\n                    title: title,\n                    body: spinner\n                })\n                .done((modal) => {\n                    modalObj = modal;\n                    resolve();\n                });\n            }).catch(() => {\n                reject(new Error('Failed to load string: loading'));\n            });\n        });\n    };\n\n    /**\n     * Initialise method for quiz dashboard rendering.\n     */\n    ZoomModal.init = function(context) {\n        contextid = context;\n        createModal();\n    };\n\n    return ZoomModal;\n});\n"],"file":"zoom_modal.min.js"}