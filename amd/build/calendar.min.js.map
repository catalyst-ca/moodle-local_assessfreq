{"version":3,"sources":["../src/calendar.js"],"names":["define","Str","Notification","Ajax","Calendar","eventArray","stringArr","key","component","stringResult","today","Date","daysInMonth","month","year","getDate","getEvents","metric","modules","Promise","resolve","reject","args","window","console","log","jsonArgs","JSON","stringify","call","methodname","jsondata","done","response","parse","fail","Error","createTables","startMonth","endMonth","calendarContainer","document","createElement","i","container","classList","add","table","thead","tbody","id","monthRow","dayrow","monthHeader","colSpan","innerHTML","j","dayHeader","appendChild","populateCalendarDays","firstDay","getDay","date","row","cell","cellText","createTextNode","parseInt","getFullYear","getMonth","populateCalendar","tables","getElementsByTagName","length","generate","dateObj","get_strings","catch","exception","then","stringReturn","calendarHTML"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/str', 'core/notification', 'core/ajax'], function(Str, Notification, Ajax) {\n\n    /**\n     * Module level variables.\n     */\n    var Calendar = {};\n    var eventArray = [];\n    const stringArr = [\n        {key: 'sun', component: 'calendar'},\n        {key: 'mon', component: 'calendar'},\n        {key: 'tue', component: 'calendar'},\n        {key: 'wed', component: 'calendar'},\n        {key: 'thu', component: 'calendar'},\n        {key: 'fri', component: 'calendar'},\n        {key: 'sat', component: 'calendar'},\n        {key: 'jan', component: 'local_assessfreq'},\n        {key: 'feb', component: 'local_assessfreq'},\n        {key: 'mar', component: 'local_assessfreq'},\n        {key: 'apr', component: 'local_assessfreq'},\n        {key: 'may', component: 'local_assessfreq'},\n        {key: 'jun', component: 'local_assessfreq'},\n        {key: 'jul', component: 'local_assessfreq'},\n        {key: 'aug', component: 'local_assessfreq'},\n        {key: 'sep', component: 'local_assessfreq'},\n        {key: 'oct', component: 'local_assessfreq'},\n        {key: 'nov', component: 'local_assessfreq'},\n        {key: 'dec', component: 'local_assessfreq'},\n    ];\n    var stringResult;\n    const today = new Date();\n\n    /**\n     * Check how many days in a month code.\n     * from https://dzone.com/articles/determining-number-days-month.\n     */\n    const daysInMonth = (month, year) => {\n        return 32 - new Date(year, month, 32).getDate();\n    };\n\n    /**\n     *\n     */\n    const getEvents = (year, metric, modules) => {\n        return new Promise((resolve, reject) => {\n            let args = {\n                    year: year,\n                    metric: metric,\n                    modules: modules\n                };\n            window.console.log(args);\n            let jsonArgs = JSON.stringify(args);\n\n            // Get the events to use in the mapping.\n            Ajax.call([{\n                methodname: 'local_assessfreq_get_frequency',\n                args: {\n                    jsondata: jsonArgs\n                },\n            }])[0].done(function(response) {\n                eventArray = JSON.parse(response);\n                resolve(eventArray);\n            }).fail(function() {\n                reject(new Error('Failed to get events'));\n            });\n        });\n    };\n\n    /**\n     *\n     */\n    const createTables = ({year, startMonth, endMonth}) => {\n        return new Promise((resolve, reject) => {\n            let calendarContainer = document.createElement('div');\n            let month = startMonth;\n\n            // Itterate through and build are tables.\n            for (let i = startMonth; i <= endMonth; i++) {\n                // Setup some elements.\n                let container = document.createElement('div');\n                container.classList.add('local-assessfreq-month');\n                let table = document.createElement('table');\n                let thead = document.createElement('thead');\n                let tbody = document.createElement('tbody');\n                tbody.id = 'calendar-body-' + i;\n                let monthRow = document.createElement('tr');\n                let dayrow = document.createElement('tr');\n                let monthHeader = document.createElement('th');\n                monthHeader.colSpan = 7;\n                monthHeader.innerHTML = stringResult[(7 + month)];\n\n                for (let j = 0; j < 7; j++) {\n                    let dayHeader = document.createElement('th');\n                    dayHeader.innerHTML = stringResult[j];\n                    dayrow.appendChild(dayHeader);\n                }\n\n                // Construct the table.\n                monthRow.appendChild(monthHeader);\n\n                thead.appendChild(monthRow);\n                thead.appendChild(dayrow);\n\n                table.appendChild(thead);\n                table.appendChild(tbody);\n\n                container.appendChild(table);\n\n                // Add to parent.\n                calendarContainer.appendChild(container);\n\n                // Increment variables.\n                month++;\n            }\n\n            if ((typeof year === 'undefined') || (typeof startMonth === 'undefined') || (typeof endMonth === 'undefined')) {\n                reject(Error('Failed to create calendar tables.'));\n            } else {\n                const resultObj = {\n                        calendarContainer : calendarContainer,\n                        year : year,\n                        startMonth : startMonth\n                };\n                resolve(resultObj);\n            }\n        });\n    };\n\n    /**\n     * Generate calendar markup for the month.\n     */\n    const populateCalendarDays = (table, year, month) => {\n        let firstDay = (new Date(year, month)).getDay();  // Get the starting day of the month.\n        let date = 1;  // Creating all cells.\n\n        for (let i = 0; i < 6; i++) {\n            let row = document.createElement(\"tr\"); // Creates a table row.\n\n            // Creating individual cells, filing them up with data.\n            for (let j = 0; j < 7; j++) {\n                if (i === 0 && j < firstDay) {\n                    var cell = document.createElement(\"td\");\n                    var cellText = document.createTextNode(\"\");\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                }\n                else if (date > daysInMonth(month, year)) { // Break if we have generated all the days for this month.\n                    break;\n                }\n                else {\n                    cell = document.createElement(\"td\");\n                    cellText = document.createTextNode(date);\n                    if (date === today.getDate()\n                            && parseInt(year) === today.getFullYear() && parseInt(month) === today.getMonth()) {\n\n                        cell.classList.add(\"bg-info\");\n                    } // Color today's date.\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                    date++;\n                }\n\n            }\n            table.appendChild(row); // Appending each row into calendar body.\n        }\n    };\n\n    /**\n     *\n     */\n    const populateCalendar = ({calendarContainer, year, startMonth}) => {\n        return new Promise((resolve, reject) => {\n            // Get the table boodies.\n            let tables = calendarContainer.getElementsByTagName(\"tbody\");\n            let month = startMonth;\n\n            // For each table body populate with calendar.\n            for (var i = 0; i < tables.length; i++) {\n                let table = tables[i];\n                populateCalendarDays(table, year, month);\n                month++;\n            }\n\n\n            if (typeof calendarContainer === 'undefined') {\n                reject(Error('Failed to populate calendar tables.'));\n            } else {\n                resolve(calendarContainer);\n            }\n        });\n    };\n\n    /**\n     * Initialise method for report card rendering.\n     *\n     * @param {integer} context The current context id.\n     */\n    Calendar.generate = (year, startMonth, endMonth, metric, modules) => {\n        return new Promise((resolve, reject) => {\n            const dateObj = {\n                    year : year,\n                    startMonth : startMonth,\n                    endMonth : endMonth\n            };\n\n            Str.get_strings(stringArr).catch(() => { // Get required strings.\n                Notification.exception(new Error('Failed to load strings'));\n                return;\n            }).then(stringReturn => { // Save string to global to be used later.\n                stringResult = stringReturn;\n                return;\n            })\n            .then(getEvents(year, metric, modules))\n            .then(() => { // Get events for settings\n                window.console.log(eventArray);\n                return dateObj;\n            })\n            .then(createTables) // Create tables for calendar.\n            .then(populateCalendar)\n            .then((calendarHTML) => { // Return the result of the generate function.\n                if (typeof calendarHTML !== 'undefined') {\n                    resolve(calendarHTML);\n                } else {\n                    reject(Error('Could not generate calendar'));\n                }\n            });\n        });\n\n    };\n\n    return Calendar;\n});\n"],"file":"calendar.min.js"}