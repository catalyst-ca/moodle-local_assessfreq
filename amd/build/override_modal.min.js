/**
 * Javascript for report card display and processing.
 *
 * @package
 * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_assessfreq/override_modal",["jquery","core/str","core/modal","core/modal_factory","core/modal_events","core/fragment","core/ajax"],(function($,Str,Modal,ModalFactory,ModalEvents,Fragment,Ajax){let contextid,activitytype,modalObj,activityid,userid,tableHandler,OverrideModal={};const spinner='<p class="text-center"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></p>',createModal=function(){Str.get_string("loading").then((title=>{Modal.create({type:ModalFactory.types.DEFAULT,title:title,body:spinner,large:!0}).then((modal=>{modalObj=modal,modalObj.getRoot().on("click","#id_submitbutton",processModalForm),modalObj.getRoot().on("click","#id_cancel",(function(e){e.preventDefault(),modalObj.setBody(spinner),modalObj.hide()}))}))}))},updateModalBody=function(activity,user,formdata){void 0===formdata&&(formdata={});let params={jsonformdata:JSON.stringify(formdata),activitytype:activitytype,activityid:activity,userid:user};modalObj.setBody(spinner),Str.get_string("modal:useroverride","local_assessfreq").then((title=>{modalObj.setTitle(title),modalObj.setBody(Fragment.loadFragment("local_assessfreq","new_override_form",contextid,params))}))};function processModalForm(e){e.preventDefault();let overrideform=modalObj.getRoot().find("form").serialize(),formjson=JSON.stringify(overrideform),invalid=$.merge(modalObj.getRoot().find('[aria-invalid="true"]'),modalObj.getRoot().find(".error"));invalid.length?invalid.first().focus():Ajax.call([{methodname:"local_assessfreq_process_override_form",args:{jsonformdata:formjson,activityid:activityid,activitytype:activitytype}}])[0].done((()=>{modalObj.setBody(spinner),modalObj.hide(),void 0!==tableHandler&&tableHandler.getTable()})).fail((()=>{updateModalBody(activityid,userid,overrideform)}))}return OverrideModal.displayModalForm=function(activity,user){activityid=activity,userid=user,updateModalBody(activityid,user),modalObj.show()},OverrideModal.init=function(context,module){let tablehandler=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;activitytype=module,contextid=context,tableHandler=tablehandler,createModal()},OverrideModal}));

//# sourceMappingURL=override_modal.min.js.map