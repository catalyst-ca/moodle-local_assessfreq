function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function _iterableToArrayLimit(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("local_assessfreq/calendar",["core/str","core/notification","core/ajax"],function(a,b,c){var d={},e=[],f=[{key:"sun",component:"calendar"},{key:"mon",component:"calendar"},{key:"tue",component:"calendar"},{key:"wed",component:"calendar"},{key:"thu",component:"calendar"},{key:"fri",component:"calendar"},{key:"sat",component:"calendar"},{key:"jan",component:"local_assessfreq"},{key:"feb",component:"local_assessfreq"},{key:"mar",component:"local_assessfreq"},{key:"apr",component:"local_assessfreq"},{key:"may",component:"local_assessfreq"},{key:"jun",component:"local_assessfreq"},{key:"jul",component:"local_assessfreq"},{key:"aug",component:"local_assessfreq"},{key:"sep",component:"local_assessfreq"},{key:"oct",component:"local_assessfreq"},{key:"nov",component:"local_assessfreq"},{key:"dec",component:"local_assessfreq"}],g,h,k,l,m,n={1:0,2:0,3:0,4:0,5:0,6:0},o=function(a){if("#"===a.slice(0,1)){a=a.slice(1)}var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return 128<=(299*c+587*d+114*e)/1e3?"#000000":"#FFFFFF"},p=function(a,b){return 32-new Date(b,a,32).getDate()},q=function(){return new Promise(function(a,b){c.call([{methodname:"local_assessfreq_get_heat_colors",args:{}}],!0,!1)[0].done(function(b){l=JSON.parse(b);a(l)}).fail(function(){b(new Error("Failed to get heat colors"))})})},r=function(){return new Promise(function(a,b){c.call([{methodname:"local_assessfreq_get_process_modules",args:{}}],!0,!1)[0].done(function(b){m=JSON.parse(b);a(m)}).fail(function(){b(new Error("Failed to get process events"))})})},s=function(a,b){return new Promise(function(c){if("undefined"!==a[b.year]){for(var d=[],e=a[b.year],f=0;12>f;f++){if("undefined"!=typeof e[f]){for(var g=e[f],l=0;32>l;l++){if("undefined"!=typeof g[l]){d.push(g[l].number)}}}}h=Math.max.apply(Math,d);k=Math.min.apply(Math,d)}else{h=0;k=0}c(a)})},t=function(a){if(a==k){return 1}var b=h-k,c=(a-k)/b,d=Math.round(c*5+1);if(1>d){d=1}if(6<d){d=6}return d},u=function(a){var b=a.year,d=a.metric,f=a.modules;return new Promise(function(a,g){var h=JSON.stringify({year:b,metric:d,modules:f});c.call([{methodname:"local_assessfreq_get_frequency",args:{jsondata:h}}])[0].done(function(b){e=JSON.parse(b);a(e)}).fail(function(){g(new Error("Failed to get events"))})})},v=function(a,b){var c;if("undefined"!=typeof e[a]&&"undefined"!=typeof e[a][b]){c=e[a][b]}return c},w=function(a){var b=a.year,c=a.startMonth,d=a.endMonth;return new Promise(function(a,e){for(var f=document.createElement("div"),h=c,k=c,l;k<=d;k++){l=document.createElement("div");l.classList.add("local-assessfreq-month");var r=document.createElement("table");r.classList.add("table-striped");var m=document.createElement("thead"),n=document.createElement("tbody");n.id="calendar-body-"+k;var o=document.createElement("tr"),p=document.createElement("tr"),q=document.createElement("th");q.colSpan=7;q.innerHTML=g[7+h];for(var s=0,j;7>s;s++){j=document.createElement("th");j.innerHTML=g[s];p.appendChild(j)}o.appendChild(q);m.appendChild(o);m.appendChild(p);r.appendChild(m);r.appendChild(n);l.appendChild(r);f.appendChild(l);h++}if("undefined"==typeof b||"undefined"==typeof c||"undefined"==typeof d){e(Error("Failed to create calendar tables."))}else{a({calendarContainer:f,year:b,startMonth:c})}})},x=function(a){for(var b="",c=0,d=Object.entries(a);c<d.length;c++){var e=_slicedToArray(d[c],2),f=e[0],g=e[1];b+="<strong>"+m[f]+":</strong> "+g+"<br/>"}return b},y=function(a,b,c){for(var d=new Date(b,c).getDay(),e=v(b,c+1),f=1,g=0,h;6>g;g++){h=document.createElement("tr");for(var q=0;7>q;q++){if(0===g&&q<d){var k=document.createElement("td"),m=document.createTextNode("");k.dataset.event="false"}else if(f>p(c,b)){break}else{k=document.createElement("td");m=document.createTextNode(f);if("undefined"!=typeof e&&e.hasOwnProperty(f)){var j=t(e[f].number);if(0==n[j]||n[j]>e[f].number){n[j]=e[f].number}k.style.backgroundColor=l[j];k.style.color=o(l[j]);k.dataset.toggle="tooltip";k.dataset.html="true";k.dataset.event="true";k.dataset.date=b+"-"+(c+1)+"-"+f;k.title=x(e[f]);k.style.cursor="pointer"}f++}k.appendChild(m);h.appendChild(k)}a.appendChild(h)}},z=function(a){var b=a.calendarContainer,c=a.year,d=a.startMonth;return new Promise(function(a,e){for(var f=b.getElementsByTagName("tbody"),g=d,h=0,j;h<f.length;h++){j=f[h];y(j,c,g);g++}if("undefined"==typeof b){e(Error("Failed to populate calendar tables."))}else{a(b)}})};d.createHeatScale=function(){return new Promise(function(a){for(var b=document.createElement("table"),c=document.createElement("tbody"),d=document.createElement("tr"),e=1;7>e;e++){if(0!==n[e]){var f=document.createElement("td"),g=document.createTextNode(n[e]+"+");f.appendChild(g);f.style.backgroundColor=l[e];f.style.color=o(l[e]);d.appendChild(f)}}c.appendChild(d);b.appendChild(c);n={1:0,2:0,3:0,4:0,5:0,6:0};a(b)})};d.generate=function(c,d,e,h,i){return new Promise(function(j,k){var l={year:c,startMonth:d,endMonth:e},m={year:c,metric:h,modules:i};a.get_strings(f).catch(function(){b.exception(new Error("Failed to load strings"))}).then(function(a){g=a;return m}).then(u).then(function(a){s(a,l)}).then(q).then(r).then(function(){return l}).then(w).then(z).then(function(a){if("undefined"!=typeof a){j(a)}else{k(Error("Could not generate calendar"))}})})};return d});
//# sourceMappingURL=calendar.min.js.map
