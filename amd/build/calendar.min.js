define ("local_assessfreq/calendar",["core/str","core/notification","core/ajax"],function(a,b,c){var d={},e=[],f=[{key:"sun",component:"calendar"},{key:"mon",component:"calendar"},{key:"tue",component:"calendar"},{key:"wed",component:"calendar"},{key:"thu",component:"calendar"},{key:"fri",component:"calendar"},{key:"sat",component:"calendar"},{key:"jan",component:"local_assessfreq"},{key:"feb",component:"local_assessfreq"},{key:"mar",component:"local_assessfreq"},{key:"apr",component:"local_assessfreq"},{key:"may",component:"local_assessfreq"},{key:"jun",component:"local_assessfreq"},{key:"jul",component:"local_assessfreq"},{key:"aug",component:"local_assessfreq"},{key:"sep",component:"local_assessfreq"},{key:"oct",component:"local_assessfreq"},{key:"nov",component:"local_assessfreq"},{key:"dec",component:"local_assessfreq"}],g,h=new Date,k,l,m,n=function(a,b){return 32-new Date(b,a,32).getDate()},o=function(){return new Promise(function(a,b){c.call([{methodname:"local_assessfreq_get_heat_colors",args:{}}],!0,!1)[0].done(function(b){m=JSON.parse(b);a(m)}).fail(function(){b(new Error("Failed to get heat colors"))})})},p=function(a,b){return new Promise(function(c){for(var d=[],e=a[b.year],f=0;12>f;f++){if("undefined"!=typeof e[f]){for(var g=e[f],h=0;32>h;h++){if("undefined"!=typeof g[h]){d.push(g[h].number)}}}}k=Math.max.apply(Math,d);l=Math.min.apply(Math,d);c(a)})},q=function(a){if(a==l){return 1}var b=k-l,c=(a-l)/b,d=Math.round(c*6);return d},r=function(a){var b=a.year,d=a.metric,f=a.modules;return new Promise(function(a,g){var h=JSON.stringify({year:b,metric:d,modules:f});c.call([{methodname:"local_assessfreq_get_frequency",args:{jsondata:h}}])[0].done(function(b){e=JSON.parse(b);a(e)}).fail(function(){g(new Error("Failed to get events"))})})},s=function(a,b){var c;if("undefined"!=typeof e[a]&&"undefined"!=typeof e[a][b]){c=e[a][b]}return c},t=function(a){var b=a.year,c=a.startMonth,d=a.endMonth;return new Promise(function(a,e){for(var f=document.createElement("div"),h=c,k=c,l;k<=d;k++){l=document.createElement("div");l.classList.add("local-assessfreq-month");var m=document.createElement("table"),n=document.createElement("thead"),o=document.createElement("tbody");o.id="calendar-body-"+k;var p=document.createElement("tr"),q=document.createElement("tr"),r=document.createElement("th");r.colSpan=7;r.innerHTML=g[7+h];for(var s=0,j;7>s;s++){j=document.createElement("th");j.innerHTML=g[s];q.appendChild(j)}p.appendChild(r);n.appendChild(p);n.appendChild(q);m.appendChild(n);m.appendChild(o);l.appendChild(m);f.appendChild(l);h++}if("undefined"==typeof b||"undefined"==typeof c||"undefined"==typeof d){e(Error("Failed to create calendar tables."))}else{a({calendarContainer:f,year:b,startMonth:c})}})},u=function(a,b,c){for(var d=new Date(b,c).getDay(),e=s(b,c+1),f=1,g=0,k;6>g;g++){k=document.createElement("tr");for(var p=0;7>p;p++){if(0===g&&p<d){var l=document.createElement("td"),o=document.createTextNode("");l.appendChild(o);k.appendChild(l)}else if(f>n(c,b)){break}else{l=document.createElement("td");o=document.createTextNode(f);if("undefined"!=typeof e&&e.hasOwnProperty(f)){var j=q(e[f].number);l.style.backgroundColor=m[j]}if(f===h.getDate()&&parseInt(b)===h.getFullYear()&&parseInt(c)===h.getMonth()){l.classList.add("bg-info")}l.appendChild(o);k.appendChild(l);f++}}a.appendChild(k)}},v=function(a){var b=a.calendarContainer,c=a.year,d=a.startMonth;return new Promise(function(a,e){for(var f=b.getElementsByTagName("tbody"),g=d,h=0,j;h<f.length;h++){j=f[h];u(j,c,g);g++}if("undefined"==typeof b){e(Error("Failed to populate calendar tables."))}else{a(b)}})};d.generate=function(c,d,e,h,i){return new Promise(function(j,k){var l={year:c,startMonth:d,endMonth:e},m={year:c,metric:h,modules:i};a.get_strings(f).catch(function(){b.exception(new Error("Failed to load strings"))}).then(function(a){g=a;return m}).then(r).then(function(a){p(a,l)}).then(o).then(function(){return l}).then(t).then(v).then(function(a){if("undefined"!=typeof a){j(a)}else{k(Error("Could not generate calendar"))}})})};return d});
//# sourceMappingURL=calendar.min.js.map
