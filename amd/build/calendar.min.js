function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function _iterableToArrayLimit(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _readOnlyError(a){throw new Error("\""+a+"\" is read-only")}define ("local_assessfreq/calendar",["core/str","core/notification","core/ajax"],function(a,b,c){var d={},e=[],f=[{key:"sun",component:"calendar"},{key:"mon",component:"calendar"},{key:"tue",component:"calendar"},{key:"wed",component:"calendar"},{key:"thu",component:"calendar"},{key:"fri",component:"calendar"},{key:"sat",component:"calendar"},{key:"jan",component:"local_assessfreq"},{key:"feb",component:"local_assessfreq"},{key:"mar",component:"local_assessfreq"},{key:"apr",component:"local_assessfreq"},{key:"may",component:"local_assessfreq"},{key:"jun",component:"local_assessfreq"},{key:"jul",component:"local_assessfreq"},{key:"aug",component:"local_assessfreq"},{key:"sep",component:"local_assessfreq"},{key:"oct",component:"local_assessfreq"},{key:"nov",component:"local_assessfreq"},{key:"dec",component:"local_assessfreq"}],g,h,k,l,m,n=function(a,b){return 32-new Date(b,a,32).getDate()},o=function(){return new Promise(function(a,b){window.console.log("getting heat colors");c.call([{methodname:"local_assessfreq_get_heat_colors",args:{}}],!0,!1)[0].done(function(b){l=JSON.parse(b);a(l)}).fail(function(){b(new Error("Failed to get heat colors"))})})},p=function(){return new Promise(function(a,b){window.console.log("get process modules");c.call([{methodname:"local_assessfreq_get_process_modules",args:{}}],!0,!1)[0].done(function(b){m=JSON.parse(b);a(m)}).fail(function(){b(new Error("Failed to get process events"))})})},q=function(a,b){return new Promise(function(c){if("undefined"!==a[b.year]){for(var d=[],e=a[b.year],f=0;12>f;f++){if("undefined"!=typeof e[f]){for(var g=e[f],l=0;32>l;l++){if("undefined"!=typeof g[l]){d.push(g[l].number)}}}}h=Math.max.apply(Math,d);k=Math.min.apply(Math,d)}else{h=1;k=1}c(a)})},r=function(a){window.console.log("getting heat");window.console.log(a);window.console.log(k);window.console.log(h);if(a==k){return 1}var b=h-k,c=(a-k)/b,d=Math.round(c*6);if(1>d){d=(_readOnlyError("heat"),1)}if(6<d){d=(_readOnlyError("heat"),6)}return d},s=function(a){var b=a.year,d=a.metric,f=a.modules;return new Promise(function(a,g){window.console.log("getting events");var h=JSON.stringify({year:b,metric:d,modules:f});c.call([{methodname:"local_assessfreq_get_frequency",args:{jsondata:h}}])[0].done(function(b){e=JSON.parse(b);a(e)}).fail(function(){g(new Error("Failed to get events"))})})},t=function(a,b){var c;if("undefined"!=typeof e[a]&&"undefined"!=typeof e[a][b]){c=e[a][b]}return c},u=function(a){var b=a.year,c=a.startMonth,d=a.endMonth;return new Promise(function(a,e){window.console.log("creating tables");for(var f=document.createElement("div"),h=c,k=c,l;k<=d;k++){l=document.createElement("div");l.classList.add("local-assessfreq-month");var m=document.createElement("table"),n=document.createElement("thead"),o=document.createElement("tbody");o.id="calendar-body-"+k;var p=document.createElement("tr"),q=document.createElement("tr"),r=document.createElement("th");r.colSpan=7;r.innerHTML=g[7+h];for(var s=0,j;7>s;s++){j=document.createElement("th");j.innerHTML=g[s];q.appendChild(j)}p.appendChild(r);n.appendChild(p);n.appendChild(q);m.appendChild(n);m.appendChild(o);l.appendChild(m);f.appendChild(l);h++}if("undefined"==typeof b||"undefined"==typeof c||"undefined"==typeof d){e(Error("Failed to create calendar tables."))}else{a({calendarContainer:f,year:b,startMonth:c})}})},v=function(a,b,c){var d=new Date(b,c).getDay(),e=t(b,c+1),f=1;window.console.log("populating calendar days");window.console.log(e);for(var k=0,i;6>k;k++){i=document.createElement("tr");for(var m=0;7>m;m++){if(0===k&&m<d){var g=document.createElement("td"),h=document.createTextNode("");g.dataset.event="false"}else if(f>n(c,b)){break}else{g=document.createElement("td");h=document.createTextNode(f);if("undefined"!=typeof e&&e.hasOwnProperty(f)){var j=r(e[f].number);g.style.backgroundColor=l[j]}f++}g.appendChild(h);i.appendChild(g)}a.appendChild(i)}},w=function(a){var b=a.calendarContainer,c=a.year,d=a.startMonth;return new Promise(function(a,e){window.console.log("populating calendar");window.console.log(b);window.console.log(c);window.console.log(d);var f=b.getElementsByTagName("tbody"),g=d;window.console.log(f);for(var h=0,j;h<f.length;h++){j=f[h];v(j,c,g);g++}window.console.log("finished populating calendar");if("undefined"==typeof b){e(Error("Failed to populate calendar tables."))}else{a(b)}})};d.generate=function(c,d,e,h,i){return new Promise(function(j,k){var l={year:c,startMonth:d,endMonth:e},m={year:c,metric:h,modules:i};a.get_strings(f).catch(function(){b.exception(new Error("Failed to load strings"))}).then(function(a){g=a;window.console.log("strings loaded");return m}).then(s).then(function(a){window.console.log("calc heat range");q(a,l)}).then(o).then(p).then(function(){window.console.log("got process modules");return l}).then(u).then(w).then(function(a){if("undefined"!=typeof a){window.console.log("returning calendar html");j(a)}else{k(Error("Could not generate calendar"))}})})};return d});
//# sourceMappingURL=calendar.min.js.map
