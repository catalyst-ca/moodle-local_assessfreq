define ("local_assessfreq/reportcard",["core/ajax","core/fragment","core/templates","core/notification","local_assessfreq/calendar"],function(a,b,c,d,e){var o={},p,q,r,s,t,u="",v="",w=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}];function f(b,c){a.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:b,value:c}]}}])[0].fail(function(){d.exception(new Error("Failed to update user preference"))})}function g(){w.forEach(function(a){var e=document.getElementById(a.cardId),f=e.getElementsByClassName("overlay-icon-container")[0],g=e.getElementsByClassName("chart-body")[0],h={data:JSON.stringify({year:q,call:a.call})};f.classList.remove("hide");b.loadFragment("local_assessfreq","get_chart",p,h).done(function(a){c.render("core/chart",{withtable:!0,chartdata:a}).done(function(a,b){f.classList.add("hide");c.replaceNodeContents(g,a,b)}).fail(function(){d.exception(new Error("Failed to load chart template."))})}).fail(function(){d.exception(new Error("Failed to load card year filter"))})})}function h(a){var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=q){q=b.dataset.year;f("local_assessfreq_overview_year_preference",q);var c=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=q;g()}}function i(){clearTimeout(t);t=setTimeout(k(),750)}function j(){e.generate(r).then(function(a){window.console.log(a)}).catch(function(){d.exception(new Error("Failed to load calendar"))})}function k(){for(var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],d=0;d<b.length;d++){if(b[d].classList.contains("active")){var h=b[d].dataset.module;c.push(h)}}if(u!==JSON.stringify(c)){u=JSON.stringify(c);f("local_assessfreq_heatmap_modules_preference",u)}var e={year:r,metric:s,modules:c},g=JSON.stringify(e);if(g!==v){v=g;j()}}function l(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=r){r=b.dataset.year;f("local_assessfreq_heatmap_year_preference",r);var c=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=r;i()}}function m(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.metric!=s){s=b.dataset.metric;f("local_assessfreq_heatmap_metric_preference",s);i()}}function n(a){for(var b=a.getElementsByTagName("a"),c=b[0],d=0,e;d<b.length;d++){e=b[d].dataset.module;if("all"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();for(var c=0;c<b.length;c++){b[c].classList.remove("active")}i()})}else if("close"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");i()})}else{b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");i()})}}}o.init=function(a){p=a;var b=document.getElementById("local-assessfreq-cards-year");q=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",h);var c=document.getElementById("local-assessfreq-heatmap-year");r=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",l);var d=document.getElementById("local-assessfreq-heatmap-metrics");s=d.getElementsByClassName("active")[0].dataset.metric;d.addEventListener("click",m);var e=document.getElementById("local-assessfreq-heatmap-modules");n(e);g();k()};return o});
//# sourceMappingURL=reportcard.min.js.map
