function _createForOfIteratorHelper(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("local_assessfreq/reportcard",["core/fragment","core/templates","core/notification","core/ajax"],function(a,b,c,d){var m={},n,o,p,q,r="",s="",t,u=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}];function e(a,b){d.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:a,value:b}]}}])[0].fail(function(){c.exception(new Error("Failed to update user preference"))})}function f(){u.forEach(function(d){var e=document.getElementById(d.cardId),f=e.getElementsByClassName("overlay-icon-container")[0],g=e.getElementsByClassName("chart-body")[0],h={data:JSON.stringify({year:o,call:d.call})};f.classList.remove("hide");a.loadFragment("local_assessfreq","get_chart",n,h).done(function(a){b.render("core/chart",{withtable:!0,chartdata:a}).done(function(a,c){f.classList.add("hide");b.replaceNodeContents(g,a,c)}).fail(function(){c.exception(new Error("Failed to load chart template."))})}).fail(function(){c.exception(new Error("Failed to load card year filter"))})})}function g(a){var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=o){o=b.dataset.year;e("local_assessfreq_overview_year_preference",o);var c=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=o;j()}}function h(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=p){p=b.dataset.year;e("local_assessfreq_heatmap_year_preference",p);var c=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=p;j()}}function i(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.metric!=q){q=b.dataset.metric;e("local_assessfreq_heatmap_metric_preference",q);j()}}function j(){clearTimeout(t);t=setTimeout(k(),750)}function k(){var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],d=_createForOfIteratorHelper(b),f;try{for(d.s();!(f=d.n()).done;){var i=f.value;if(i.classList.contains("active")){var j=i.dataset.module;c.push(j)}}}catch(a){d.e(a)}finally{d.f()}if(r!==JSON.stringify(c)){r=JSON.stringify(c);e("local_assessfreq_heatmap_modules_preference",r)}var g={year:p,metric:q,modules:c},h=JSON.stringify(g);if(h!==s){s=h;window.console.log("getting heatmap data")}}function l(a){var b=a.getElementsByTagName("a"),c=b[0],d=_createForOfIteratorHelper(b),e;try{for(d.s();!(e=d.n()).done;){var f=e.value,g=f.dataset.module;if("all"===g.toLowerCase()){f.addEventListener("click",function(a){a.preventDefault();var c=_createForOfIteratorHelper(b),d;try{for(c.s();!(d=c.n()).done;){var e=d.value;e.classList.remove("active")}}catch(a){c.e(a)}finally{c.f()}j()})}else if("close"===g.toLowerCase()){f.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");j()})}else{f.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");j()})}}}catch(a){d.e(a)}finally{d.f()}}m.init=function(a){n=a;var b=document.getElementById("local-assessfreq-cards-year");o=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",g);var c=document.getElementById("local-assessfreq-heatmap-year");p=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",h);var d=document.getElementById("local-assessfreq-heatmap-metrics");q=d.getElementsByClassName("active")[0].dataset.metric;d.addEventListener("click",i);var e=document.getElementById("local-assessfreq-heatmap-modules");l(e);f()};return m});
//# sourceMappingURL=reportcard.min.js.map
