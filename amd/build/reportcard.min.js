define ("local_assessfreq/reportcard",["core/ajax","core/fragment","core/templates"],function(a,b,c){var l={},m,n,o,p,q,r="",s="",t=[{cardId:"local-assessfreq-assess-due-month",call:"assess_by_month"},{cardId:"local-assessfreq-assess-by-activity",call:"assess_by_activity"},{cardId:"local-assessfreq-assess-due-month-student",call:"assess_by_month_student"}];function d(b,c){a.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:b,value:c}]}}])[0].fail(function(){Notification.exception(new Error("Failed to update user preference"))})}function e(){t.forEach(function(a){var d=document.getElementById(a.cardId),e=d.getElementsByClassName("overlay-icon-container")[0],f=d.getElementsByClassName("chart-body")[0],g={data:JSON.stringify({year:n,call:a.call})};e.classList.remove("hide");b.loadFragment("local_assessfreq","get_chart",m,g).done(function(a){c.render("core/chart",{withtable:!0,chartdata:a}).done(function(a,b){e.classList.add("hide");c.replaceNodeContents(f,a,b)}).fail(function(){Notification.exception(new Error("Failed to load chart template."))})}).fail(function(){Notification.exception(new Error("Failed to load card year filter"))})})}function f(a){var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=n){n=b.dataset.year;d("local_assessfreq_overview_year_preference",n);var c=document.getElementById("local-assessfreq-report-overview").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=n;e()}}function g(){clearTimeout(q);q=setTimeout(h(),750)}function h(){for(var a=document.getElementById("local-assessfreq-heatmap-modules"),b=a.getElementsByTagName("a"),c=[],e=0;e<b.length;e++){if(b[e].classList.contains("active")){var h=b[e].dataset.module;c.push(h)}}if(r!==JSON.stringify(c)){r=JSON.stringify(c);d("local_assessfreq_heatmap_modules_preference",r)}var f={year:o,metric:p,modules:c},g=JSON.stringify(f);if(g!==s){s=g;window.console.log("getting heatmap data.")}}function i(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.year!=o){o=b.dataset.year;d("local_assessfreq_heatmap_year_preference",o);var c=document.getElementById("local-assessfreq-report-heatmap").getElementsByClassName("local-assessfreq-year")[0];c.innerHTML=o;g()}}function j(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.metric!=p){p=b.dataset.metric;d("local_assessfreq_heatmap_metric_preference",p);g()}}function k(a){for(var b=a.getElementsByTagName("a"),c=b[0],d=0,e;d<b.length;d++){e=b[d].dataset.module;if("all"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();for(var c=0;c<b.length;c++){b[c].classList.remove("active")}g()})}else if("close"===e.toLowerCase()){b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();var b=document.getElementById("local-assessfreq-heatmap-modules-filter");b.classList.remove("show");g()})}else{b[d].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.classList.remove("active");a.target.classList.toggle("active");g()})}}}l.init=function(a){m=a;var b=document.getElementById("local-assessfreq-cards-year");n=b.getElementsByClassName("active")[0].dataset.year;b.addEventListener("click",f);var c=document.getElementById("local-assessfreq-heatmap-year");o=c.getElementsByClassName("active")[0].dataset.year;c.addEventListener("click",i);var d=document.getElementById("local-assessfreq-heatmap-metrics");p=d.getElementsByClassName("active")[0].dataset.metric;d.addEventListener("click",j);var g=document.getElementById("local-assessfreq-heatmap-modules");k(g);e();h()};return l});
//# sourceMappingURL=reportcard.min.js.map
