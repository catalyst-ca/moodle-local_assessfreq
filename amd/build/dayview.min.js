function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("local_assessfreq/dayview",["core/str","core/notification","core/modal_factory","local_assessfreq/modal_large","core/templates","core/ajax"],function(a,b,c,d,e,f){var g={},h,i="<p class=\"text-center\"><i class=\"fa fa-circle-o-notch fa-spin fa-3x fa-fw\"></i></p>",j=[{key:"sun",component:"calendar"},{key:"mon",component:"calendar"},{key:"tue",component:"calendar"},{key:"wed",component:"calendar"},{key:"thu",component:"calendar"},{key:"fri",component:"calendar"},{key:"sat",component:"calendar"},{key:"jan",component:"local_assessfreq"},{key:"feb",component:"local_assessfreq"},{key:"mar",component:"local_assessfreq"},{key:"apr",component:"local_assessfreq"},{key:"may",component:"local_assessfreq"},{key:"jun",component:"local_assessfreq"},{key:"jul",component:"local_assessfreq"},{key:"aug",component:"local_assessfreq"},{key:"sep",component:"local_assessfreq"},{key:"oct",component:"local_assessfreq"},{key:"nov",component:"local_assessfreq"},{key:"dec",component:"local_assessfreq"}],k,l="Australia/Melbourne",m=function(a,b){return new Promise(function(c){var d=new Date(1e3*a).toLocaleString("en-US",{timeZone:d}),e=new Date(d),f=e.getFullYear(),g=k[7+e.getMonth()],h=e.getDate(),i=e.getHours(),j="0"+e.getMinutes(),l=i+":"+j.substr(-2);if("strftimetime"===b){c(l)}else{c(h+" "+g+" "+f+", "+l)}})},n=function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,j,k,n,o,p,q,r,s;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=JSON.parse(b);d=5/72;e=0;case 3:if(!(e<c.length)){a.next=37;break}f=c[e].endyear;g=c[e].endmonth-1;h=c[e].endday;j=new Date(f,g,h).getTime()/1e3;k=new Date(1e3*c[e].timestart).toLocaleString("en-US",{timeZone:l});n=new Date(k).getTime()/1e3;o=new Date(1e3*c[e].timeend).toLocaleString("en-US",{timeZone:l});p=new Date(o).getTime()/1e3;q=n-j;r=0;s=0;if(!(0>=q)){a.next=23;break}q=0;s=(p-j)/60*d;a.next=20;return m(c[e].timestart,"strftimedatetime");case 20:c[e].start=a.sent;a.next=28;break;case 23:r=q/60*d;s=(p-n)/60*d;a.next=27;return m(c[e].timestart,"strftimetime");case 27:c[e].start=a.sent;case 28:if(100<r+s){s=100-r}c[e].leftmargin=r;c[e].width=s;a.next=33;return m(c[e].timeend,"strftimetime");case 33:c[e].end=a.sent;case 34:e++;a.next=3;break;case 37:return a.abrupt("return",new Promise(function(a){a(c)}));case 38:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();g.display=function(a){h.setBody(i);h.show();var c=JSON.stringify({date:a,modules:["all"]});f.call([{methodname:"local_assessfreq_get_day_events",args:{jsondata:c}}])[0].then(n).then(function(a){h.setBody(e.render("local_assessfreq/dayview",{rows:a}))}).fail(function(){b.exception(new Error("Failed to load day view"))})};g.init=function(){a.get_strings(j).catch(function(){b.exception(new Error("Failed to load strings"))}).then(function(a){k=a});f.call([{methodname:"local_assessfreq_get_system_timezone",args:{}}],!0,!1)[0].then(function(a){l=a}).fail(function(){b.exception(new Error("Failed to get system timezone"))});a.get_string("schedule","local_assessfreq").then(function(a){c.create({type:d.TYPE,title:a,body:i}).done(function(a){h=a})}).catch(function(){b.exception(new Error("Failed to load string: loading"))})};return g});
//# sourceMappingURL=dayview.min.js.map
