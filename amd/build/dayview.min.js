define ("local_assessfreq/dayview",["core/str","core/notification","core/modal_factory","local_assessfreq/modal_large","core/templates","core/ajax"],function(a,b,c,d,e,f){var g={},h,i="<p class=\"text-center\"><i class=\"fa fa-circle-o-notch fa-spin fa-3x fa-fw\"></i></p>",j=[{key:"sun",component:"calendar"},{key:"mon",component:"calendar"},{key:"tue",component:"calendar"},{key:"wed",component:"calendar"},{key:"thu",component:"calendar"},{key:"fri",component:"calendar"},{key:"sat",component:"calendar"},{key:"jan",component:"local_assessfreq"},{key:"feb",component:"local_assessfreq"},{key:"mar",component:"local_assessfreq"},{key:"apr",component:"local_assessfreq"},{key:"may",component:"local_assessfreq"},{key:"jun",component:"local_assessfreq"},{key:"jul",component:"local_assessfreq"},{key:"aug",component:"local_assessfreq"},{key:"sep",component:"local_assessfreq"},{key:"oct",component:"local_assessfreq"},{key:"nov",component:"local_assessfreq"},{key:"dec",component:"local_assessfreq"}],k,l="Australia/Melbourne",m=function(a,b){return new Promise(function(c){var d=new Date(1e3*a).toLocaleString("en-US",{timeZone:l}),e=new Date(d),f=e.getFullYear(),g=k[7+e.getMonth()],h=e.getDate(),i=e.getHours(),j="0"+e.getMinutes(),m=i+":"+j.substr(-2);if("strftimetime"===b){c(m)}else{c(h+" "+g+" "+f+", "+m)}})},n=function(a){var b=JSON.parse(a);return new Promise(function(a){for(var c=[],d=5/72,e=function(a){var e=[],f=b[a].endyear,g=b[a].endmonth-1,h=b[a].endday,i=new Date(f,g,h).getTime()/1e3,j=new Date(1e3*b[a].timestart).toLocaleString("en-US",{timeZone:l}),k=new Date(j).getTime()/1e3,n=new Date(1e3*b[a].timeend).toLocaleString("en-US",{timeZone:l}),o=new Date(n).getTime()/1e3,p=k-i,q=0,r=0;if(0>=p){p=0;r=(o-i)/60*d;var t=m(b[a].timestart,"strftimedatetime");c.push(t);e.push(t)}else{q=p/60*d;r=(o-k)/60*d;var u=m(b[a].timestart,"strftimetime");c.push(u);e.push(u)}if(100<q+r){r=100-q}b[a].leftmargin=q;b[a].width=r;var s=m(b[a].timeend,"strftimetime");c.push(s);e.push(s);Promise.all(e).then(function(c){b[a].start=c[0];b[a].end=c[1]})},f=0;f<b.length;f++){e(f)}Promise.all(c).then(function(){a(b)})})};g.display=function(a){h.setBody(i);h.show();var c=JSON.stringify({date:a,modules:["all"]});f.call([{methodname:"local_assessfreq_get_day_events",args:{jsondata:c}}])[0].then(n).then(function(a){h.setBody(e.render("local_assessfreq/dayview",{rows:a}))}).fail(function(){b.exception(new Error("Failed to load day view"))})};g.init=function(){a.get_strings(j).catch(function(){b.exception(new Error("Failed to load strings"))}).then(function(a){k=a});f.call([{methodname:"local_assessfreq_get_system_timezone",args:{}}],!0,!1)[0].then(function(a){l=a}).fail(function(){b.exception(new Error("Failed to get system timezone"))});a.get_string("schedule","local_assessfreq").then(function(a){c.create({type:d.TYPE,title:a,body:i}).done(function(a){h=a})}).catch(function(){b.exception(new Error("Failed to load string: loading"))})};return g});
//# sourceMappingURL=dayview.min.js.map
