{"version":3,"sources":["../src/chart_output_chartjs.js"],"names":["define","Output","ChartOutput","aspectRatio","rtLegendoptions","prototype","_makeConfig","config","type","_getChartType","data","labels","_cleanData","_chart","getLabels","datasets","_makeDatasetsConfig","options","title","display","getTitle","text","legend","getXAxes","forEach","axis","i","axisLabels","scales","xAxes","_makeAxisConfig","ticks","callback","value","index","stacked","_isStacked","bind","getYAxes","yAxes","parseInt","tooltips","callbacks","label","_makeTooltip","maintainAspectRatio","init","chartImage","ChartInst","aspect"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Chart output for chart.js with custom override for aspect config.\n *\n * @package    local_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/chart_output_chartjs'], function(Output) {\n\n    /**\n     * Module level variables.\n     */\n    var ChartOutput = {};\n    var aspectRatio = false;\n    var rtLegendoptions = false;\n\n    /**\n     * Overrride the config.\n     *\n     * @protected\n     * @param {module:core/chart_axis} axis The axis.\n     * @return {Object} The axis config.\n     */\n    Output.prototype._makeConfig = function() {\n        var config = {\n            type: this._getChartType(),\n            data: {\n                labels: this._cleanData(this._chart.getLabels()),\n                datasets: this._makeDatasetsConfig()\n            },\n            options: {\n                title: {\n                    display: this._chart.getTitle() !== null,\n                    text: this._cleanData(this._chart.getTitle())\n                }\n            }\n        };\n\n        // Override legend options with those provided at run time.\n        if (rtLegendoptions)  {\n            config.options.legend = rtLegendoptions;\n        }\n\n        this._chart.getXAxes().forEach(function(axis, i) {\n            var axisLabels = axis.getLabels();\n\n            config.options.scales = config.options.scales || {};\n            config.options.scales.xAxes = config.options.scales.xAxes || [];\n            config.options.scales.xAxes[i] = this._makeAxisConfig(axis, 'x', i);\n\n            if (axisLabels !== null) {\n                config.options.scales.xAxes[i].ticks.callback = function(value, index) {\n                    return axisLabels[index] || '';\n                };\n            }\n            config.options.scales.xAxes[i].stacked = this._isStacked();\n        }.bind(this));\n\n        this._chart.getYAxes().forEach(function(axis, i) {\n            var axisLabels = axis.getLabels();\n\n            config.options.scales = config.options.scales || {};\n            config.options.scales.yAxes = config.options.scales.yAxes || [];\n            config.options.scales.yAxes[i] = this._makeAxisConfig(axis, 'y', i);\n\n            if (axisLabels !== null) {\n                config.options.scales.yAxes[i].ticks.callback = function(value) {\n                    return axisLabels[parseInt(value, 10)] || '';\n                };\n            }\n            config.options.scales.yAxes[i].stacked = this._isStacked();\n        }.bind(this));\n\n        config.options.tooltips = {\n            callbacks: {\n                label: this._makeTooltip.bind(this)\n            }\n        };\n\n        config.options.maintainAspectRatio = aspectRatio;\n\n        return config;\n    };\n\n    /**\n     * Get the aspect ratio setting and initialise the chart.\n     */\n    ChartOutput.init = function(chartImage, ChartInst, aspect, legend) {\n        aspectRatio = aspect;\n        rtLegendoptions = legend;\n        new Output(chartImage, ChartInst);\n    };\n\n    return ChartOutput;\n\n});\n"],"file":"chart_output_chartjs.min.js"}