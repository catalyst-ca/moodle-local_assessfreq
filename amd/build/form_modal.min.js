define ("local_assessfreq/form_modal",["core/str","core/modal_factory","core/fragment","core/ajax"],function(a,b,c,d){var e={},f,g,h=[],i="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>",j=new MutationObserver(function ObserverCallback(a){for(var b=function(b){var c=a[b].target;if("span"===c.tagName.toLowerCase()&&c.classList.contains("badge")){c.addEventListener("click",n);document.getElementById("id_courses").dataset.course=c.dataset.value;document.getElementById("id_quiz").value=-1;d.call([{methodname:"local_assessfreq_get_quizzes",args:{query:a[b].target.dataset.value}}])[0].done(function(a){for(var c=JSON.parse(a),d=document.getElementById("id_quiz"),e=d.options.length,f=e-1;0<=f;f--){d.options[b]=null}if(0<c.length){for(var l=0;l<c.length;l++){var g=c[b],i=document.createElement("option");i.textContent=g.name;i.value=g.id;d.appendChild(i)}d.removeAttribute("disabled");if(null!==document.getElementById("noquizwarning")){document.getElementById("noquizwarning").remove()}}else{h.forEach(function(a){d.appendChild(a)});document.getElementById("id_quiz").value=0;d.disabled=!0}}).fail(function(){Notification.exception(new Error("Failed to get quizzes"))});return"break"}},c=0,e;c<a.length;c++){e=b(c);if("break"===e)break}}),k={attributes:!0,childList:!1,subtree:!0},l=function(){a.get_string("loading","local_assessfreq").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:i,large:!0}).done(function(a){g=a;g.getRoot().on("click","#id_submitbutton",o);g.getRoot().on("click","#id_cancel",function(a){a.preventDefault();g.setBody(i);g.hide()})})}).catch(function(){Notification.exception(new Error("Failed to load string: loading"))})},m=function(){return new Promise(function(b,c){a.get_strings([{key:"selectcourse",component:"local_assessfreq"},{key:"loadingquiz",component:"local_assessfreq"}]).catch(function(){c(new Error("Failed to load strings"))}).then(function(a){for(var c=0,d;c<a.length;c++){d=document.createElement("option");d.textContent=a[c];d.value=0-c;h.push(d)}b()})})},n=function(b){if("undefined"==typeof b){b={}}var d={jsonformdata:JSON.stringify(b)};m().then(function(){a.get_string("searchquiz","local_assessfreq").then(function(a){g.setTitle(a);g.setBody(c.loadFragment("local_assessfreq","new_base_form",f,d));var b=document.querySelectorAll("[data-region*=\"modal-container\"]")[0];j.observe(b,k)}).catch(function(){Notification.exception(new Error("Failed to load string: searchquiz"))})})},o=function(a){a.preventDefault();var b=document.getElementById("id_quiz"),c=b.options[b.selectedIndex].value,d=document.getElementById("id_courses").dataset.course;if(d===void 0||1>c){if(null===document.getElementById("noquizwarning")){var e=document.createElement("div");e.innerHTML="oi dickhead";e.id="noquizwarning";e.classList.add("alert","alert-danger");g.getBody().prepend(e)}}else{g.hide();g.setBody("");j.disconnect()}},p=function(){n();g.show()};e.init=function(a){f=a;l();var b=document.getElementById("local-assessfreq-find-quiz");b.addEventListener("click",p)};return e});
//# sourceMappingURL=form_modal.min.js.map
