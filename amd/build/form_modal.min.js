define ("local_assessfreq/form_modal",["core/str","core/modal_factory","core/fragment","core/ajax"],function(a,b,c,d){var e={},f,g,h=[],i,j="<p class=\"text-center\"><i class=\"fa fa-circle-o-notch fa-spin fa-3x fa-fw\"></i></p>",k={attributes:!0,childList:!1,subtree:!0},l=new MutationObserver(function ObserverCallback(a){for(var b=function(b){var c=a[b].target;if("span"===c.tagName.toLowerCase()&&c.classList.contains("badge")){c.addEventListener("click",o);document.getElementById("id_courses").dataset.course=c.dataset.value;document.getElementById("id_quiz").value=-1;d.call([{methodname:"local_assessfreq_get_quizzes",args:{query:a[b].target.dataset.value}}])[0].done(function(a){var c=JSON.parse(a),d=document.getElementById("id_quiz"),e=d.options.length;if(null!==document.getElementById("noquizwarning")){document.getElementById("noquizwarning").remove()}for(var i=e-1;0<=i;i--){d.options[b]=null}if(0<c.length){for(var j=0;j<c.length;j++){var f=c[b],g=document.createElement("option");g.textContent=f.name;g.value=f.id;d.appendChild(g)}d.removeAttribute("disabled");if(null!==document.getElementById("noquizwarning")){document.getElementById("noquizwarning").remove()}}else{h.forEach(function(a){d.appendChild(a)});document.getElementById("id_quiz").value=0;d.disabled=!0}}).fail(function(){Notification.exception(new Error("Failed to get quizzes"))});return"break"}},c=0,e;c<a.length;c++){e=b(c);if("break"===e)break}}),m=function(){a.get_string("loading","local_assessfreq").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:j,large:!0}).done(function(a){g=a;g.getRoot().on("click","#id_submitbutton",p);g.getRoot().on("click","#id_cancel",function(a){a.preventDefault();g.setBody(j);g.hide()})})}).catch(function(){Notification.exception(new Error("Failed to load string: loading"))})},n=function(){return new Promise(function(b,c){a.get_strings([{key:"selectcourse",component:"local_assessfreq"},{key:"loadingquiz",component:"local_assessfreq"}]).catch(function(){c(new Error("Failed to load strings"))}).then(function(a){for(var c=0,d;c<a.length;c++){d=document.createElement("option");d.textContent=a[c];d.value=0-c;h.push(d)}b()})})},o=function(b){if("undefined"==typeof b){b={}}var d={jsonformdata:JSON.stringify(b)};n().then(function(){a.get_string("searchquiz","local_assessfreq").then(function(a){g.setTitle(a);g.setBody(c.loadFragment("local_assessfreq","new_base_form",f,d));var b=document.querySelectorAll("[data-region*=\"modal-container\"]")[0];l.observe(b,k)}).catch(function(){Notification.exception(new Error("Failed to load string: searchquiz"))})})},p=function(b){b.preventDefault();var c=document.getElementById("id_quiz"),d=c.options[c.selectedIndex].value,e=document.getElementById("id_courses").dataset.course;if(e===void 0||1>d){if(null===document.getElementById("noquizwarning")){a.get_string("noquizselected","local_assessfreq").then(function(a){var b=document.createElement("div");b.innerHTML=a;b.id="noquizwarning";b.classList.add("alert","alert-danger");g.getBody().prepend(b)}).catch(function(){Notification.exception(new Error("Failed to load string: searchquiz"))})}}else{g.hide();g.setBody("");l.disconnect();i(d,e)}},q=function(){o();g.show()};e.init=function(a,b){f=a;i=b;m();var c=document.getElementById("local-assessfreq-find-quiz");c.addEventListener("click",q)};return e});
//# sourceMappingURL=form_modal.min.js.map
