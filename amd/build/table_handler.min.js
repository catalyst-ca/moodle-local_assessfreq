define ("local_assessfreq/table_handler",["core/ajax","core/fragment","core/notification","core/templates","local_assessfreq/debouncer","local_assessfreq/override_modal","local_assessfreq/user_preferences"],function(a,b,c,d,e,f,g){var h={},j,k,l,m,n,o=0,p,q,r;h.getTable=function(a){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,g=3<arguments.length?arguments[3]:void 0;if("undefined"==typeof g){g=0}var i=document.getElementById(r).value.trim(),j=document.getElementById(l),p=j.getElementsByClassName("overlay-icon-container")[0],s=j.getElementsByClassName("table-body")[0],t={search:i,page:g};if(0<a){o=a;t.quiz=o}if(e){n=e;t.hoursahead=n[0];t.hoursbehind=n[1]}if(f){q=f;var u=q.split("_"),v=u[0],w=u[1];t.sorton=v;t.direction=w}var x={data:JSON.stringify(t)};p.classList.remove("hide");b.loadFragment("local_assessfreq",m,k,x).done(function(a,b){s.innerHTML=a;if(b){d.runTemplateJS(b)}p.classList.add("hide");h.tableEventListeners()}).fail(function(){c.exception(new Error("Failed to update table."))})};var s=e.debouncer(function(){h.getTable(o,n,q)},750);h.tableSort=function(b){b.preventDefault();var c={},d=new URL(b.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){h.getTable(o,n,q)})};h.tableHide=function(b){b.preventDefault();var c={},d=new URL(b.target.closest("a").href),e=document.getElementById(l),f=e.querySelectorAll("a"),g,j,k,m;if(-1!==d.search.indexOf("thide")){g="hide";j=d.searchParams.get("thide")}else{g="show";j=d.searchParams.get("tshow")}for(var p=0,i;p<f.length;p++){i=new URL(f[p].href);if(-1!==i.search.indexOf("thide")){k="hide";m=i.searchParams.get("thide")}else{k="show";m=i.searchParams.get("tshow")}if("show"===k){c[m]=1}}c[j]="hide"===g?1:0;a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){h.getTable(o,n,q)})};h.tableReset=function(b){b.preventDefault();a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){h.getTable(o,n,q)})};h.tableSearch=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){s()}};h.tableSearchReset=function(){var a=document.getElementById(r);a.value="";a.focus();h.getTable(o,n,q)};h.tableSearchRowSet=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;g.setUserPreference(p,b).then(function(){h.getTable(o,n,q)}).fail(function(){c.exception(new Error("Failed to update user preference: rows"))})}};h.tableNav=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){h.getTable(o,n,q,c)}};h.tableSortButtonAction=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!==q){q=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");g.setUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference",q);s()}};h.tableEventListeners=function(){var a=document.getElementById(l),b;if(j){var c=document.getElementById(j),d=a.querySelectorAll("a"),e=a.getElementsByClassName("resettable"),f=a.getElementsByClassName("action-icon override"),g=a.getElementsByClassName("action-icon disabled");b=c.querySelectorAll("nav");for(var k=0,i;k<d.length;k++){i=new URL(d[k].href);if(-1!==i.search.indexOf("thide")||-1!==i.search.indexOf("tshow")){d[k].addEventListener("click",h.tableHide)}else if(-1!==i.search.indexOf("tsort")){d[k].addEventListener("click",h.tableSort)}}if(0<e.length){e[0].addEventListener("click",h.tableReset)}for(var m=0;m<f.length;m++){f[m].addEventListener("click",h.triggerOverrideModal)}for(var n=0;n<g.length;n++){g[n].addEventListener("click",function(a){a.preventDefault()})}}else{b=a.querySelectorAll("nav")}b.forEach(function(a){a.addEventListener("click",h.tableNav)})};h.triggerOverrideModal=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);f.displayModalForm(o,b)};h.init=function(a,b,c,d,e,f,g){o=a;k=b;j=c;l=d;m=e;p=f;r=g};return h});
//# sourceMappingURL=table_handler.min.js.map
