function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_assessfreq/table_handler",["exports","core/ajax","core/fragment","core/notification","core/templates","local_assessfreq/debouncer","local_assessfreq/override_modal","local_assessfreq/user_preferences"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=a.tableSortButtonAction=a.tableSearchRowSet=a.tableSearchReset=a.tableSearch=a.getTable=void 0;b=k(b);c=k(c);d=k(d);e=k(e);f=j(f);g=k(g);h=j(h);function i(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;i=function(){return a};return a}function j(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=i();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function k(a){return a&&a.__esModule?a:{default:a}}var l,m,n,o,p,q=0,r=!1,s,t,u,v,w,x=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,g=3<arguments.length?arguments[3]:void 0;if("undefined"==typeof g||!0===r){g=0}r=!1;var h=document.getElementById(u).value.trim(),i=document.getElementById(n),j=i.getElementsByClassName("overlay-icon-container")[0],k=i.getElementsByClassName("table-body")[0],l={search:h,page:g};if(0<a){q=a;l.quiz=q}if(b){p=b;l.hoursahead=p[0];l.hoursbehind=p[1]}if(f){t=f;var s=t.split("_"),v=s[0],w=s[1];l.sorton=v;l.direction=w}var x={data:JSON.stringify(l)};j.classList.remove("hide");c.default.loadFragment("local_assessfreq",o,m,x).done(function(a,b){k.innerHTML=a;if(b){e.default.runTemplateJS(b)}j.classList.add("hide");G()}).fail(function(){d.default.exception(new Error("Failed to update table."))})};a.getTable=x;var y=f.debouncer(function(){x(q,p,t)},750),z=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;b.default.call([{methodname:w,args:{tableid:v,preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){x(q,p,t)})},A=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=document.getElementById(n),f=e.querySelectorAll("a"),g,h,j,k;if(-1!==d.search.indexOf("thide")){g="hide";h=d.searchParams.get("thide")}else{g="show";h=d.searchParams.get("tshow")}for(var l=0,i;l<f.length;l++){i=new URL(f[l].href);if(-1!==i.search.indexOf("thide")){j="hide";k=i.searchParams.get("thide")}else{j="show";k=i.searchParams.get("tshow")}if("show"===j){c[k]=1}}c[h]="hide"===g?1:0;b.default.call([{methodname:w,args:{tableid:v,preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){x(q,p,t)})},B=function(a){a.preventDefault();b.default.call([{methodname:w,args:{tableid:v,preference:"reset",values:JSON.stringify({})}}])[0].then(function(){x(q,p,t)})};a.tableSearch=function tableSearch(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){y()}};var C=function(){var a=document.getElementById(u);a.value="";a.focus();x(q,p,t)};a.tableSearchReset=C;var D=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;h.setUserPreference(s,b).then(function(){x(q,p,t)}).fail(function(){d.default.exception(new Error("Failed to update user preference: rows"))})}};a.tableSearchRowSet=D;var E=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){x(q,p,t,c)}},F=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!==t){t=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");h.setUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference",t);y()}};a.tableSortButtonAction=F;var G=function(){var a=document.getElementById(n),b;if(l){var c=document.getElementById(l),d=a.querySelectorAll("a"),e=a.getElementsByClassName("resettable"),f=a.getElementsByClassName("action-icon override"),g=a.getElementsByClassName("action-icon disabled");b=c.querySelectorAll("nav");for(var h=0,i;h<d.length;h++){i=new URL(d[h].href);if(-1!==i.search.indexOf("thide")||-1!==i.search.indexOf("tshow")){d[h].addEventListener("click",A)}else if(-1!==i.search.indexOf("tsort")){d[h].addEventListener("click",z)}}if(0<e.length){e[0].addEventListener("click",B)}for(var j=0;j<f.length;j++){f[j].addEventListener("click",H)}for(var k=0;k<g.length;k++){g[k].addEventListener("click",function(a){a.preventDefault()})}}else{b=a.querySelectorAll("nav")}b.forEach(function(a){a.addEventListener("click",E)})},H=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);if(b.includes("-")){var c=b.split("-");q=c.pop();b=c.pop()}g.default.displayModalForm(q,b,p)};a.init=function init(a,b,c,d,e,f,g){var h=7<arguments.length&&arguments[7]!==void 0?arguments[7]:null,i=8<arguments.length&&arguments[8]!==void 0?arguments[8]:null;q=a;m=b;l=c;n=d;o=e;s=f;u=g;v=h;w=i}});
//# sourceMappingURL=table_handler.min.js.map
