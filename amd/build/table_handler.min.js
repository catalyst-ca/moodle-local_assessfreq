define ("local_assessfreq/table_handler",["jquery","core/ajax","core/fragment","core/notification","core/templates","local_assessfreq/debouncer","local_assessfreq/override_modal","local_assessfreq/user_preferences"],function(a,b,c,d,e,f,g,h){var j={},k,l,m,n,o,p,q=0,r=!1,s,t,u,v,w;j.getTable=function(b){var f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,h=3<arguments.length?arguments[3]:void 0;if("undefined"==typeof h||!0===r){h=0}r=!1;var i=document.getElementById(u).value.trim(),k=document.getElementById(n),l=k.getElementsByClassName("overlay-icon-container")[0],s=k.getElementsByClassName("table-body")[0],v={search:i,page:h};if(0<b){q=b;v.quiz=q}if(f){p=f;v.hoursahead=p[0];v.hoursbehind=p[1]}if(g){t=g;var w=t.split("_"),x=w[0],y=w[1];v.sorton=x;v.direction=y}var z={data:JSON.stringify(v)};l.classList.remove("hide");c.loadFragment("local_assessfreq",o,m,z).done(function(b,c){s.innerHTML=b;if(c){e.runTemplateJS(c)}l.classList.add("hide");a("[data-toggle=\"tooltip\"]").tooltip();j.tableEventListeners()}).fail(function(){d.exception(new Error("Failed to update table."))})};var x=f.debouncer(function(){j.getTable(q,p,t)},750);j.tableSort=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;b.call([{methodname:w,args:{tableid:v,preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){j.getTable(q,p,t)})};j.tableHide=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=document.getElementById(n),f=e.querySelectorAll("a"),g,h,k,l;if(-1!==d.search.indexOf("thide")){g="hide";h=d.searchParams.get("thide")}else{g="show";h=d.searchParams.get("tshow")}for(var m=0,i;m<f.length;m++){i=new URL(f[m].href);if(-1!==i.search.indexOf("thide")){k="hide";l=i.searchParams.get("thide")}else{k="show";l=i.searchParams.get("tshow")}if("show"===k){c[l]=1}}c[h]="hide"===g?1:0;b.call([{methodname:w,args:{tableid:v,preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){j.getTable(q,p,t)})};j.tableReset=function(a){a.preventDefault();b.call([{methodname:w,args:{tableid:v,preference:"reset",values:JSON.stringify({})}}])[0].then(function(){j.getTable(q,p,t)})};j.tableSearch=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){x()}};j.tableSearchReset=function(){var a=document.getElementById(u);a.value="";a.focus();j.getTable(q,p,t)};j.tableSearchRowSet=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById(k).getElementsByClassName("active"),e=0;e<c.length;e++){c[e].classList.remove("active")}a.target.classList.add("active");h.setUserPreference(s,b).then(function(){j.getTable(q,p,t)}).fail(function(){d.exception(new Error("Failed to update user preference: rows"))})}};j.tableNav=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){j.getTable(q,p,t,c)}};j.tableSortButtonAction=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!==t){t=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");h.setUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference",t);x()}};j.tableEventListeners=function(){var a=document.getElementById(n),b;if(l){var c=document.getElementById(l),d=a.querySelectorAll("a"),e=a.getElementsByClassName("resettable"),f=a.getElementsByClassName("action-icon override"),g=a.getElementsByClassName("action-icon disabled");b=c.querySelectorAll("nav");for(var h=0,i;h<d.length;h++){i=new URL(d[h].href);if(-1!==i.search.indexOf("thide")||-1!==i.search.indexOf("tshow")){d[h].addEventListener("click",j.tableHide)}else if(-1!==i.search.indexOf("tsort")){d[h].addEventListener("click",j.tableSort)}}if(0<e.length){e[0].addEventListener("click",j.tableReset)}for(var k=0;k<f.length;k++){f[k].addEventListener("click",j.triggerOverrideModal)}for(var m=0;m<g.length;m++){g[m].addEventListener("click",function(a){a.preventDefault()})}}else{b=a.querySelectorAll("nav")}b.forEach(function(a){a.addEventListener("click",j.tableNav)})};j.triggerOverrideModal=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);if(b.includes("-")){var c=b.split("-");q=c.pop();b=c.pop()}g.displayModalForm(q,b,p)};j.init=function(a,b,c,d,e,f,g){var h=7<arguments.length&&arguments[7]!==void 0?arguments[7]:null,i=8<arguments.length&&arguments[8]!==void 0?arguments[8]:null,j=9<arguments.length&&arguments[9]!==void 0?arguments[9]:null;q=a;m=b;l=c;n=d;o=e;s=f;u=g;v=h;w=i;k=j};return j});
//# sourceMappingURL=table_handler.min.js.map
