define ("local_assessfreq/table_handler",["core/ajax","core/fragment","core/notification","core/templates","local_assessfreq/user_preferences","local_assessfreq/override_modal","local_assessfreq/debouncer"],function(a,b,c,d,e,f,g){var h={},i,j,k,l,m,n,o,p,q,r;h.getTable=function(a){if("undefined"==typeof a){a=0}var e=document.getElementById(m).value.trim(),f=document.getElementById(k),g=f.getElementsByClassName("overlay-icon-container")[0],l=f.getElementsByClassName("table-body")[0],n={search:e,page:a};if("inprogress"===o){var s=r.split("_"),t=s[0],u=s[1];n.sorton=t;n.direction=u;n.hoursahead=q[0];n.hoursbehind=q[1]}else if("quiz"===o){n.quiz=i}else if("student"===o){n.hoursahead=q[0];n.hoursbehind=q[1]}var v={data:JSON.stringify(n)};g.classList.remove("hide");b.loadFragment("local_assessfreq",p,j,v).done(function(a,b){l.innerHTML=a;if("inprogress"===o){d.runTemplateJS(b)}g.classList.add("hide");h.tableEventListeners()}).fail(function(){c.exception(new Error("Failed to update table."))})};var s=g.debouncer(function(){h.getTable()},750);h.tableSort=function(b){b.preventDefault();var c={},d=new URL(b.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){h.getTable()})};h.tableHide=function(b){b.preventDefault();var c={},d=new URL(b.target.closest("a").href),e=document.getElementById(k),f=e.querySelectorAll("a"),g,j,l,m;if(-1!==d.search.indexOf("thide")){g="hide";j=d.searchParams.get("thide")}else{g="show";j=d.searchParams.get("tshow")}for(var n=0,i;n<f.length;n++){i=new URL(f[n].href);if(-1!==i.search.indexOf("thide")){l="hide";m=i.searchParams.get("thide")}else{l="show";m=i.searchParams.get("tshow")}if("show"===l){c[m]=1}}c[j]="hide"===g?1:0;a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){h.getTable()})};h.tableReset=function(b){b.preventDefault();a.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){h.getTable()})};h.tableSearch=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){s()}};h.tableSearchReset=function(){var a=document.getElementById(m);a.value="";a.focus();h.getTable()};h.tableSearchRowSet=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;e.setUserPreference(n,b).then(function(){h.getTable()}).fail(function(){c.exception(new Error("Failed to update user preference: rows"))})}};h.tableNav=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){h.getTable(c)}};h.tableSortButtonAction=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!==r){r=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");e.setUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference",r);s()}};h.tableEventListeners=function(){var a=document.getElementById(k),b;if("inprogress"===o){b=a.querySelectorAll("nav")}else if("quiz"===o||"student"===o){var c=document.getElementById(l),d=a.querySelectorAll("a"),e=a.getElementsByClassName("resettable"),f=a.getElementsByClassName("action-icon override"),g=a.getElementsByClassName("action-icon disabled");b=c.querySelectorAll("nav");for(var j=0,i;j<d.length;j++){i=new URL(d[j].href);if(-1!==i.search.indexOf("thide")||-1!==i.search.indexOf("tshow")){d[j].addEventListener("click",h.tableHide)}else if(-1!==i.search.indexOf("tsort")){d[j].addEventListener("click",h.tableSort)}}if(0<e.length){e[0].addEventListener("click",h.tableReset)}for(var m=0;m<f.length;m++){f[m].addEventListener("click",h.triggerOverrideModal)}for(var n=0;n<g.length;n++){g[n].addEventListener("click",function(a){a.preventDefault()})}}b.forEach(function(a){a.addEventListener("click",h.tableNav)})};h.triggerOverrideModal=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);f.displayModalForm(i,b)};h.init=function(a,b,c,d,e,f,g,h){var s=8<arguments.length&&arguments[8]!==void 0?arguments[8]:null,t=9<arguments.length&&arguments[9]!==void 0?arguments[9]:null;i=a;j=b;o=c;k=d;l=e;m=f;n=g;p=h;q=s;r=t};return h});
//# sourceMappingURL=table_handler.min.js.map
