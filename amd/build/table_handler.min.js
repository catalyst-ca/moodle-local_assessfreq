define ("local_assessfreq/table_handler",["jquery","core/ajax","core/fragment","core/notification","core/templates","local_assessfreq/debouncer","local_assessfreq/override_modal","local_assessfreq/user_preferences"],function(a,b,c,d,e,f,g,h){var j={},k,l,m,n,o,p,q=0,r,s,t;j.getTable=function(b){var f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,h=3<arguments.length?arguments[3]:void 0;if("undefined"==typeof h){h=0}var i=document.getElementById(t).value.trim(),k=document.getElementById(n),l=k.getElementsByClassName("overlay-icon-container")[0],r=k.getElementsByClassName("table-body")[0],u={search:i,page:h};if(0<b){q=b;u.quiz=q}if(f){p=f;u.hoursahead=p[0];u.hoursbehind=p[1]}if(g){s=g;var v=s.split("_"),w=v[0],x=v[1];u.sorton=w;u.direction=x}var y={data:JSON.stringify(u)};l.classList.remove("hide");c.loadFragment("local_assessfreq",o,m,y).done(function(b,c){r.innerHTML=b;if(c){e.runTemplateJS(c)}l.classList.add("hide");a("[data-toggle=\"tooltip\"]").tooltip();j.tableEventListeners()}).fail(function(){d.exception(new Error("Failed to update table."))})};var u=f.debouncer(function(){j.getTable(q,p,s)},750);j.tableSort=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=d.searchParams.get("tsort"),f=d.searchParams.get("tdir");if(""===f){f="4"}c[e]=f;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"sortby",values:JSON.stringify(c)}}])[0].then(function(){j.getTable(q,p,s)})};j.tableHide=function(a){a.preventDefault();var c={},d=new URL(a.target.closest("a").href),e=document.getElementById(n),f=e.querySelectorAll("a"),g,h,k,l;if(-1!==d.search.indexOf("thide")){g="hide";h=d.searchParams.get("thide")}else{g="show";h=d.searchParams.get("tshow")}for(var m=0,i;m<f.length;m++){i=new URL(f[m].href);if(-1!==i.search.indexOf("thide")){k="hide";l=i.searchParams.get("thide")}else{k="show";l=i.searchParams.get("tshow")}if("show"===k){c[l]=1}}c[h]="hide"===g?1:0;b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"collapse",values:JSON.stringify(c)}}])[0].then(function(){j.getTable(q,p,s)})};j.tableReset=function(a){a.preventDefault();b.call([{methodname:"local_assessfreq_set_table_preference",args:{tableid:"local_assessfreq_student_table",preference:"reset",values:JSON.stringify({})}}])[0].then(function(){j.getTable(q,p,s)})};j.tableSearch=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){u()}};j.tableSearchReset=function(){var a=document.getElementById(t);a.value="";a.focus();j.getTable(q,p,s)};j.tableSearchRowSet=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById(k).getElementsByClassName("active"),e=0;e<c.length;e++){c[e].classList.remove("active")}a.target.classList.add("active");h.setUserPreference(r,b).then(function(){j.getTable(q,p,s)}).fail(function(){d.exception(new Error("Failed to update user preference: rows"))})}};j.tableNav=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){j.getTable(q,p,s,c)}};j.tableSortButtonAction=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!==s){s=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");h.setUserPreference("local_assessfreq_quiz_table_inprogress_sort_preference",s);u()}};j.tableEventListeners=function(){for(var a=document.getElementById(n),b=document.getElementById(l),c=a.querySelectorAll("a"),d=a.getElementsByClassName("resettable"),e=a.getElementsByClassName("action-icon override"),f=a.getElementsByClassName("action-icon disabled"),g=b.querySelectorAll("nav"),h=0,k;h<c.length;h++){k=new URL(c[h].href);if(-1!==k.search.indexOf("thide")||-1!==k.search.indexOf("tshow")){c[h].addEventListener("click",j.tableHide)}else if(-1!==k.search.indexOf("tsort")){c[h].addEventListener("click",j.tableSort)}}if(0<d.length){d[0].addEventListener("click",j.tableReset)}for(var m=0;m<e.length;m++){e[m].addEventListener("click",j.triggerOverrideModal)}for(var o=0;o<f.length;o++){f[o].addEventListener("click",function(a){a.preventDefault()})}g.forEach(function(a){a.addEventListener("click",j.tableNav)})};j.triggerOverrideModal=function(a){a.preventDefault();var b=a.target.closest("a").id.substring(25);g.displayModalForm(q,b)};j.init=function(a,b,c,d,e,f,g){var h=7<arguments.length&&arguments[7]!==void 0?arguments[7]:null;q=a;m=b;l=c;n=d;o=e;r=f;t=g;k=h};return j});
//# sourceMappingURL=table_handler.min.js.map
