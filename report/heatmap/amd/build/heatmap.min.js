define("assessfreqreport_heatmap/heatmap",["exports","core/ajax","core/modal","local_assessfreq/modal_large","core/notification","core/templates","local_assessfreq/user_preferences"],(function(_exports,_ajax,_modal,_modal_large,_notification,_templates,UserPreference){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Chart data JS module.
   *
   * @module     assessfreqreport/heatmap
   * @package
   * @copyright  Simon Thornett <simon.thornett@catalyst-eu.net>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.heatmapSelector=void 0,_ajax=_interopRequireDefault(_ajax),_modal=_interopRequireDefault(_modal),_modal_large=_interopRequireDefault(_modal_large),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),UserPreference=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(UserPreference);_exports.init=courseid=>{heatmapSelector(courseid),moduleDropdown(),yearDropdown(),metricDropdown()};const heatmapSelector=courseid=>{document.getElementsByClassName("show-dialog").forEach((el=>el.addEventListener("click",(event=>{let addBlockModal=null;_modal.default.create({type:_modal_large.default.TYPE,large:!0,body:""}).then((modal=>{addBlockModal=modal;let args={date:event.target.dataset.target,courseid:courseid},jsonArgs=JSON.stringify(args);_ajax.default.call([{methodname:"assessfreqreport_heatmap_external_get_day_events",args:{jsondata:jsonArgs}}])[0].then((responseArr=>{let context=JSON.parse(responseArr);modal.setBody(_templates.default.render("assessfreqreport_heatmap/dayview",{rows:context})),modal.setTitle(context[0].endday+" "+Intl.DateTimeFormat("en",{month:"long"}).format(new Date(context[0].endmonth))+" "+context[0].endyear)})).fail((()=>{_notification.default.exception(new Error("Failed to load day view"))})),modal.show()})).catch((()=>{addBlockModal.destroy()})),event.preventDefault()}))))};_exports.heatmapSelector=heatmapSelector;const moduleDropdown=()=>{let links=document.getElementsByClassName("local-assessfreq-report-heatmap-filter-type-option"),all=links[0],modules=[];for(let i=0;i<links.length;i++){let module=links[i].dataset.module;"all"===module.toLowerCase()?links[i].addEventListener("click",(event=>{event.preventDefault(),event.stopPropagation();for(let j=0;j<links.length;j++)links[j].classList.remove("active");event.target.classList.toggle("active")})):"close"===module.toLowerCase()?links[i].addEventListener("click",(event=>{event.preventDefault(),event.stopPropagation();document.getElementById("local-assessfreq-report-heatmap-filter-type-options").classList.remove("show");for(let i=0;i<links.length;i++)if(links[i].classList.contains("active")){let module=links[i].dataset.module;modules.push(module)}UserPreference.setUserPreference("assessfreqreport_heatmap_modules_preference",JSON.stringify(modules)),location.reload()})):links[i].addEventListener("click",(event=>{event.preventDefault(),event.stopPropagation(),all.classList.remove("active"),event.target.classList.toggle("active")}))}},yearDropdown=()=>{document.getElementsByClassName("local-assessfreq-report-heatmap-filter-year-option").forEach((el=>el.addEventListener("click",(event=>{event.preventDefault();let element=event.target;UserPreference.setUserPreference("assessfreqreport_heatmap_year_preference",element.dataset.year),location.reload()}))))},metricDropdown=()=>{document.getElementsByClassName("local-assessfreq-report-heatmap-filter-metric-option").forEach((el=>el.addEventListener("click",(event=>{event.preventDefault();let element=event.target;UserPreference.setUserPreference("assessfreqreport_heatmap_metric_preference",element.dataset.metric),location.reload()}))))}}));

//# sourceMappingURL=heatmap.min.js.map